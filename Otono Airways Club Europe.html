<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otono Airways | A320 Family Seat Map (Revised Occupancy)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f3f4f6;
        }

        .fuselage {
            border-radius: 50% 50% 50% 50% / 120px 120px 20px 20px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        /* Seat Shapes */
        .seat {
            height: 36px;
            width: 32px;
            border-radius: 6px 6px 12px 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border-bottom-width: 4px;
        }

        .seat:not(.seat-occupied):hover {
            transform: scale(1.1);
            z-index: 10;
        }

        /* NEW: Occupied Seat Style (Lighter Grey, no 'X') */
        .seat.seat-occupied {
            background-color: rgb(209, 213, 219); /* Gray 300 */
            border-color: rgb(107, 114, 128); /* Gray 500 */
            color: rgb(75, 85, 99); /* Gray 600 */
            cursor: not-allowed;
        }
        .seat.seat-occupied:hover {
            transform: none; /* No scaling on hover for occupied seats */
        }

        /* Selected Seat Style */
        .seat.seat-selected {
            background-color: rgb(34, 197, 94); /* Green 500 */
            border-color: rgb(21, 128, 61); /* Green 700 */
            color: white;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
            transform: scale(1.15);
        }

        /* Business Class Headrest Indicator */
        .seat.business::after {
            content: '';
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 4px;
            background-color: rgba(255,255,255,0.4);
            border-radius: 2px;
        }

        /* Aisle/Gap spacing */
        .aisle-gap { width: 30px; }
        .door-gap { height: 40px; }
        
        /* Slogan styling */
        .slogan {
            font-style: italic;
            font-weight: 700;
            text-align: center;
            margin-top: 0.75rem;
            color: #ef4444; /* red-500 */
            border-top: 1px solid #e5e7eb; /* gray-200 */
            padding-top: 0.75rem;
        }

    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col items-center p-4">

    <header class="w-full max-w-4xl bg-gradient-to-r from-purple-900 to-red-900 text-white p-6 rounded-xl shadow-lg mb-6 flex flex-col md:flex-row justify-between items-center">
        <div>
            <h1 class="text-3xl font-extrabold tracking-tight">OTONO AIRWAYS</h1>
            <p class="text-purple-200 text-sm mt-1">Short Haul Fleet | Club Europe & Euro Traveller</p>
        </div>
        <div class="mt-4 md:mt-0 text-right">
            <div class="bg-white/10 px-4 py-2 rounded-lg backdrop-blur-sm border border-white/20">
                <span class="block text-xs font-bold text-yellow-300">CURRENT AIRCRAFT</span>
                <span id="plane-name-display" class="text-xl font-bold">A321neo</span>
            </div>
        </div>
    </header>

    <div class="flex flex-col lg:flex-row gap-8 w-full max-w-6xl">
        
        <div class="w-full lg:w-1/3 flex flex-col gap-4">
            
            <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-purple-900">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Select Aircraft Variant</label>
                <select id="plane-selector" class="w-full p-3 border border-gray-300 rounded-lg font-bold text-slate-700 focus:ring-2 focus:ring-purple-900 outline-none bg-white">
                    <option value="a321neo">Airbus A321neo</option>
                    <option value="a321">Airbus A321</option>
                    <option value="a320neo">Airbus A320neo</option>
                    <option value="a320">Airbus A320</option>
                    <option value="a319">Airbus A319</option>
                </select>
                <p class="slogan">"NO MORE FEAR of economy class!"</p>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md">
                <h3 class="font-bold text-gray-800 mb-4 border-b pb-2">Seat Pricing</h3>
                
                <div class="space-y-3 text-sm">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 bg-red-900 border-b-4 border-red-700 rounded text-white flex items-center justify-center text-xs font-bold">★</div>
                            <span>Business (Extra Legroom)</span>
                        </div>
                        <span class="font-bold">£620</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 bg-red-900 border-b-4 border-red-700 rounded text-white flex items-center justify-center text-xs"></div>
                            <span>Business Standard</span>
                        </div>
                        <span class="font-bold">£550</span>
                    </div>

                    <hr class="border-dashed">

                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 bg-red-500 border-b-4 border-red-400 rounded text-white flex items-center justify-center text-xs font-bold">XL</div>
                            <span>Economy (Extra Legroom)</span>
                        </div>
                        <span class="font-bold">£300</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 bg-red-500 border-b-4 border-red-400 rounded"></div>
                            <span>Economy Standard</span>
                        </div>
                        <span class="font-bold">£250</span>
                    </div>
                    <div class="flex items-center justify-between text-gray-500">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 bg-red-400 border-b-4 border-red-300 opacity-80 rounded"></div>
                            <span>Economy (Back Rows)</span>
                        </div>
                        <span class="font-bold">£230</span>
                    </div>

                    <hr class="border-dashed">

                    <div class="flex items-center gap-2">
                        <div class="w-6 h-6 bg-green-500 border-b-4 border-green-700 rounded text-white flex items-center justify-center text-xs font-bold">✓</div>
                        <span>Selected Seat</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-6 h-6 bg-gray-300 border-b-4 border-gray-500 rounded text-gray-600 flex items-center justify-center text-xs font-bold">A</div>
                        <span>Occupied (Unavailable)</span>
                    </div>
                </div>
            </div>

            <div id="seat-info-panel" class="bg-white text-slate-800 p-6 rounded-xl shadow-md hidden opacity-0 transition-opacity duration-300 border-l-4 border-green-600">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800" id="info-seat-num">--</h2>
                        <p class="text-sm font-medium text-gray-500" id="info-class">--</p>
                    </div>
                    <div class="text-right">
                        <p class="text-3xl font-extrabold text-green-600" id="info-price">--</p>
                    </div>
                </div>
                <hr class="border-gray-200 my-2">
                <p id="info-features" class="text-sm text-gray-600 italic">Select a seat to see details.</p>
                <button id="select-button" class="mt-4 w-full bg-purple-900 hover:bg-purple-800 text-white font-bold py-2 rounded transition shadow-lg">
                    Select seat (---)
                </button>
            </div>
        </div>

        <div class="w-full lg:w-2/3 flex justify-center">
            <div class="relative bg-white border-4 border-gray-300 fuselage p-8 pb-20 pt-24 min-h-[800px] shadow-2xl">
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 mt-4 text-center">
                    <div class="w-16 h-1 bg-gray-200 mb-1 rounded-full mx-auto"></div>
                    <div class="text-[10px] font-bold text-gray-400">COCKPIT</div>
                </div>

                <div id="seat-map-container" class="flex flex-col gap-1 items-center">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const SEAT_OCCUPANCY_RATE = 0.30; 

        // --- Data Definitions ---
        const STYLES = {
            BUSINESS: 'bg-red-900 border-red-700 text-white business hover:bg-red-800 hover:border-red-600',
            ECONOMY: 'bg-red-500 border-red-400 text-white hover:bg-red-400 hover:border-red-300',
            ECONOMY_BACK: 'bg-red-400 border-red-300 text-white hover:bg-red-300 hover:border-red-200', 
            OCCUPIED: 'seat-occupied bg-gray-300 border-gray-500 text-gray-600' 
        };

        const SEAT_LETTERS = {
            BUSINESS: ['A', 'C', 'H', 'K'],
            ECONOMY: ['A', 'B', 'C', 'H', 'J', 'K']
        };

        let currentSelectedSeat = null;
        let occupiedSeatsMap = {}; // Stores occupied seats for the current plane

        // --- DOM Elements ---
        const container = document.getElementById('seat-map-container');
        const planeSelector = document.getElementById('plane-selector');
        const planeNameDisplay = document.getElementById('plane-name-display');
        const infoPanel = document.getElementById('seat-info-panel');
        const selectButton = document.getElementById('select-button');


        // Helper to generate range, skipping 13 and 14 for all variants
        const range = (start, end) => 
            Array.from({length: (end - start) + 1}, (_, i) => start + i)
            .filter(num => num !== 13 && num !== 14);

        // Function to create a standard row object
        const createRow = (num, type, missing = [], only = null) => ({ num, type, missing, only });
        
        // --- Plane Configurations (Based on Diagram and Revisions) ---
        const PLANES = {
            'a321neo': {
                name: 'Airbus A321neo',
                rows: [
                    ...range(11, 20).map(n => createRow(n, 'biz')),
                    { type: 'gap', size: 'door' }, // Gap 20-24
                    ...range(24, 27).map(n => createRow(n, 'eco')),
                    createRow(28, 'eco', ['A', 'K']), // Row 28: No A, K
                    { type: 'gap', size: 'door' }, // Gap 28-33
                    ...range(33, 44).map(n => createRow(n, 'eco')),
                    createRow(45, 'eco', ['A', 'K']), // Row 45: No A, K
                    { type: 'gap', size: 'door' }, // Gap 45-55
                    ...range(55, 62).map(n => createRow(n, 'eco')),
                    createRow(63, 'eco', [], ['H', 'J', 'K']) // Row 63: Only H, J, K
                ],
                exitRows: [24, 33, 55], 
                lastRows: [59, 60, 61, 62, 63] // Last 5 rows
            },
            'a321': {
                name: 'Airbus A321',
                rows: [
                    ...range(11, 20).map(n => createRow(n, 'biz')),
                    { type: 'gap', size: 'door' },
                    ...range(24, 27).map(n => createRow(n, 'eco')),
                    createRow(28, 'eco', ['A', 'K']), // Row 28: No A, K
                    { type: 'gap', size: 'door' },
                    ...range(33, 44).map(n => createRow(n, 'eco')),
                    createRow(45, 'eco', ['A', 'K']), // Row 45: No A, K
                    { type: 'gap', size: 'door' },
                    ...range(55, 62).map(n => createRow(n, 'eco')),
                    createRow(63, 'eco', [], ['H', 'J', 'K']) // Row 63: Only H, J, K
                ],
                exitRows: [24, 33, 55],
                lastRows: [59, 60, 61, 62, 63] // Last 5 rows
            },
            'a320neo': {
                name: 'Airbus A320neo',
                rows: [
                    ...range(11, 18).map(n => createRow(n, 'biz')),
                    { type: 'gap', size: 'small' },
                    createRow(20, 'eco'),
                    { type: 'gap', size: 'small' },
                    ...range(24, 26).map(n => createRow(n, 'eco')),
                    { type: 'gap', size: 'door' }, 
                    ...range(33, 55).map(n => createRow(n, 'eco'))
                ],
                exitRows: [20, 33, 34],
                lastRows: [51, 52, 53, 54, 55] // Last 5 rows
            },
            'a320': {
                name: 'Airbus A320',
                rows: [
                    ...range(11, 18).map(n => createRow(n, 'biz')),
                    { type: 'gap', size: 'small' }, 
                    ...range(23, 26).map(n => createRow(n, 'eco')),
                    { type: 'gap', size: 'door' }, 
                    ...range(33, 55).map(n => createRow(n, 'eco'))
                ],
                exitRows: [23, 33, 34], 
                lastRows: [51, 52, 53, 54, 55] // Last 5 rows
            },
            'a319': {
                name: 'Airbus A319',
                rows: [
                    ...range(11, 18).map(n => createRow(n, 'biz')),
                    { type: 'gap', size: 'small' }, 
                    ...range(21, 22).map(n => createRow(n, 'eco')),
                    createRow(23, 'eco', ['A', 'K']), // Row 23: No A, K
                    { type: 'gap', size: 'door' }, 
                    ...range(32, 51).map(n => createRow(n, 'eco'))
                ],
                exitRows: [21, 32], 
                lastRows: [47, 48, 49, 50, 51] // Last 5 rows
            }
        };

        // --- Logic & Rendering ---
        
        function getPrice(planeKey, rowNum, type) {
            const plane = PLANES[planeKey];

            if (type === 'biz') {
                if (rowNum === 11) return 620;  
                return 550;
            }

            if (type === 'eco') {
                // --- Special rows with £300 (Missing seats) ---
                if (((planeKey === 'a321' || planeKey === 'a321neo') && (rowNum === 28 || rowNum === 45)) ||
                    (planeKey === 'a319' && rowNum === 23)) {
                    return 300;
                }

                // --- Standard exit rows (£300) ---
                if (plane.exitRows.includes(rowNum)) return 300;

                // --- Last 5 rows cheaper (£230) ---
                if (plane.lastRows.includes(rowNum)) return 230;

                // --- Default economy price (£250) ---
                return 250;  
            }

            return 0;
        }

        // Function to randomly determine occupied seats
        function generateOccupancyMap(planeKey) {
            const occupied = {};
            const data = PLANES[planeKey];

            data.rows.forEach(row => {
                if (row.type !== 'gap') {
                    const allLetters = row.type === 'biz' ? SEAT_LETTERS.BUSINESS : SEAT_LETTERS.ECONOMY;
                    const lettersToRender = row.only || allLetters.filter(l => !row.missing.includes(l));

                    lettersToRender.forEach(letter => {
                        const seatId = `${row.num}${letter}`;
                        if (Math.random() < SEAT_OCCUPANCY_RATE) {
                            occupied[seatId] = true;
                        }
                    });
                }
            });
            return occupied;
        }

        function getSeatLabel(rowNum, type) {
            if (rowNum === 11) return "★";
            else if (type === 'eco' && PLANES[planeSelector.value].exitRows.includes(rowNum)) return "XL";
            return "";
        }

        function handleSeatClick(seatElement, rowNum, letter, type) {
            const seatNum = `${rowNum}${letter}`;
            
            // Check if the seat is occupied before proceeding
            if (seatElement.classList.contains('seat-occupied')) { // Check for class, not STYLES.OCCUPIED directly
                return; 
            }

            const planeKey = planeSelector.value;
            const price = getPrice(planeKey, rowNum, type);

            // 1. Deselect previous seat
            if (currentSelectedSeat) {
                currentSelectedSeat.classList.remove('seat-selected');
                // Reapply original styling to the previously selected seat if it's not occupied
                const prevSeatId = currentSelectedSeat.dataset.seatId;
                if (!occupiedSeatsMap[prevSeatId]) {
                    const prevRowNum = parseInt(prevSeatId.match(/\d+/)[0]);
                    const prevSeatLetter = prevSeatId.match(/[A-Z]/)[0];
                    const prevRow = PLANES[planeKey].rows.find(r => r.num === prevRowNum && r.type !== 'gap');
                    if (prevRow) {
                        let originalStyleClass = prevRow.type === 'biz' ? STYLES.BUSINESS : STYLES.ECONOMY;
                        if (prevRow.type !== 'biz' && PLANES[planeKey].lastRows.includes(prevRowNum)) originalStyleClass = STYLES.ECONOMY_BACK; 
                        if (prevRow.type !== 'biz' && PLANES[planeKey].exitRows.includes(prevRowNum)) originalStyleClass = STYLES.ECONOMY + ' ring-2 ring-yellow-400 ring-offset-1'; 
                        currentSelectedSeat.className = `seat ${originalStyleClass}`;
                    }
                }
            }

            // 2. Select new seat
            currentSelectedSeat = seatElement;
            currentSelectedSeat.classList.add('seat-selected');

            // 3. Update Info Panel
            infoPanel.classList.remove('hidden', 'opacity-0');
            
            document.getElementById('info-seat-num').innerText = seatNum;
            document.getElementById('info-price').innerText = `£${price}`;
            
            let className = type === 'biz' ? "Club Europe (Business)" : "Euro Traveller (Economy)";
            document.getElementById('info-class').innerText = className;

            // Update button text
            selectButton.innerText = `Select seat (${seatNum})`;

            let features = [];
            if (rowNum === 11) features.push("Front Row Extra Legroom");
            // Check for special £300 rows that are NOT the main exit rows
            if (((planeKey === 'a321' || planeKey === 'a321neo') && (rowNum === 28 || rowNum === 45)) ||
                (planeKey === 'a319' && rowNum === 23)) {
                features.push("End-of-Cabin Legroom");
            }

            if (PLANES[planeKey].exitRows.includes(rowNum) && type !== 'biz') features.push("Exit Row / Extra Legroom");
            
            if (type === 'biz') features.push("Blocked Middle Seat Comfort", "Priority Boarding");
            else features.push("Otono Standard 34\" Legroom"); // Eco standard legroom
            
            document.getElementById('info-features').innerText = features.join(" • ");
        }


        function renderMap(planeKey) {
            occupiedSeatsMap = generateOccupancyMap(planeKey);

            const data = PLANES[planeKey];
            container.innerHTML = ''; 
            planeNameDisplay.innerText = data.name;
            currentSelectedSeat = null; 

            infoPanel.classList.add('hidden', 'opacity-0');
            selectButton.innerText = `Select seat (---)`;


            data.rows.forEach(row => {
                if (row.type === 'gap') {
                    const gap = document.createElement('div');
                    gap.className = row.size === 'door' ? 'w-full door-gap flex items-center justify-between px-4' : 'w-full h-4';
                    
                    if (row.size === 'door') {
                        gap.innerHTML = `
                            <div class="text-red-600 font-bold text-xs transform -rotate-90">EXIT</div>
                            <div class="text-red-600 font-bold text-xs transform rotate-90">EXIT</div>
                        `;
                    }
                    container.appendChild(gap);
                    return;
                }

                const rowDiv = document.createElement('div');
                rowDiv.className = 'flex items-center gap-1';

                const rowNumL = document.createElement('div');
                rowNumL.className = 'w-6 text-[10px] text-gray-400 font-bold text-right mr-2';
                rowNumL.innerText = row.num;
                rowDiv.appendChild(rowNumL);

                const allLetters = row.type === 'biz' ? SEAT_LETTERS.BUSINESS : SEAT_LETTERS.ECONOMY;
                const lettersToRender = row.only || allLetters.filter(l => !row.missing.includes(l));
                
                const isBiz = row.type === 'biz';
                
                allLetters.forEach((letter, index) => {
                    const seatId = `${row.num}${letter}`;
                    const isOccupied = occupiedSeatsMap[seatId];

                    const isSpacerNeeded = (isBiz && index === 2) || (!isBiz && index === 3);

                    if (!lettersToRender.includes(letter)) {
                        if (isSpacerNeeded) {
                            const aisle = document.createElement('div');
                            aisle.className = 'aisle-gap';
                            rowDiv.appendChild(aisle);
                        }
                        return; 
                    }

                    if (isSpacerNeeded) {
                        const aisle = document.createElement('div');
                        aisle.className = 'aisle-gap';
                        rowDiv.appendChild(aisle);
                    }

                    const seat = document.createElement('div');
                    seat.dataset.seatId = seatId; // Store seat ID for easy lookup

                    // Determine styling
                    let styleClass = '';
                    if (isOccupied) {
                        styleClass = STYLES.OCCUPIED;
                    } else {
                        if (isBiz) styleClass = STYLES.BUSINESS;
                        else if (PLANES[planeKey].lastRows.includes(row.num)) styleClass = STYLES.ECONOMY_BACK; 
                        else if (PLANES[planeKey].exitRows.includes(row.num) || 
                                 ((planeKey === 'a321' || planeKey === 'a321neo') && (row.num === 28 || row.num === 45)) ||
                                 (planeKey === 'a319' && row.num === 23)) {
                            styleClass = STYLES.ECONOMY + ' ring-2 ring-yellow-400 ring-offset-1'; 
                        } else {
                            styleClass = STYLES.ECONOMY;
                        }
                        seat.onclick = () => handleSeatClick(seat, row.num, letter, row.type);
                    }
                    seat.className = `seat ${styleClass}`;
                    seat.innerText = letter; // Always show letter, even if occupied

                    const label = getSeatLabel(row.num, row.type);
                    if(label && !isOccupied) {
                        const badge = document.createElement('span');
                        badge.className = 'absolute -top-2 -right-2 bg-yellow-400 text-purple-900 text-[8px] font-bold px-1 rounded';
                        badge.innerText = label;
                        seat.appendChild(badge);
                    }

                    rowDiv.appendChild(seat);
                });

                container.appendChild(rowDiv);
            });
        }

        // Initialize
        planeSelector.addEventListener('change', (e) => {
            renderMap(e.target.value);
        });

        // Initial Render
        renderMap('a321neo');

    </script>
</body>
</html>