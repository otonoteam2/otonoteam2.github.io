<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üü£ Otono Spanish ‚Äî A Level ‚Ä¢ Lectura + Mini-ensayo + Traducci√≥n ‚Äî El Drummond Tinta-Cre√≠ble</title>
  <style>
    :root{
      --bg1:#2b0a3d; --bg2:#7a0036;
      --card:#0f0b18cc; --card2:#120c22e6;
      --text:#f4efff; --muted:#c9b9ff;
      --accent:#b000ff; --accent2:#ff1b6a;
      --good:#19ff9a; --warn:#ffd166; --bad:#ff4d6d;
      --line:rgba(255,255,255,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background:
        radial-gradient(1000px 700px at 15% 10%, rgba(176,0,255,.22), transparent 60%),
        radial-gradient(900px 650px at 80% 20%, rgba(255,27,106,.18), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .wrap{max-width:1200px; margin:0 auto; padding:22px;}
    .topbar{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow:var(--shadow);
      position:sticky; top:14px; z-index:20; backdrop-filter: blur(10px);
    }
    .brand{display:flex; flex-direction:column; gap:2px}
    .brand h1{margin:0; font-size:16px; letter-spacing:.3px}
    .brand .sub{font-size:12px; color:var(--muted)}
    .pill{
      padding:8px 10px; border-radius:999px; border:1px solid var(--line);
      background:rgba(0,0,0,.25); font-family:var(--mono); font-size:12px;
      display:flex; gap:10px; align-items:center;
    }
    .pill strong{color:#fff}
    .btn{
      border:1px solid var(--line); background:rgba(0,0,0,.25);
      color:var(--text); padding:10px 12px; border-radius:14px; cursor:pointer;
      transition:.15s transform, .15s background, .15s border;
      font-weight:600;
    }
    .btn:hover{transform:translateY(-1px); background:rgba(0,0,0,.33); border-color:rgba(255,255,255,.22)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(176,0,255,.55), rgba(255,27,106,.45));
      border-color:rgba(255,255,255,.22);
    }
    .btn.danger{background:rgba(255,77,109,.18); border-color:rgba(255,77,109,.35)}
    .grid{display:grid; grid-template-columns: 1.15fr .85fr; gap:16px; margin-top:16px;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} .topbar{position:static} }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 16px; border-bottom:1px solid var(--line);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }
    .card .hd h2{margin:0; font-size:14px}
    .card .hd .meta{font-size:12px; color:var(--muted); line-height:1.25}
    .card .bd{padding:16px}
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}

    input[type="text"], input[type="number"], textarea, select{
      width:100%; border:1px solid var(--line); background:rgba(0,0,0,.25);
      color:var(--text); padding:10px 12px; border-radius:14px; outline:none;
      font-family:var(--sans);
    }
    textarea{min-height:110px; resize:vertical}

    .row{display:flex; gap:10px; flex-wrap:wrap}
    .row > div{flex:1 1 180px}

    .note{
      font-size:12px; color:var(--muted); line-height:1.45;
      padding:10px 12px; border-radius:14px; border:1px dashed rgba(255,255,255,.18);
      background:rgba(0,0,0,.18);
    }
    .badge{
      font-family:var(--mono); font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background:rgba(0,0,0,.20);
      display:inline-flex; align-items:center; gap:6px;
    }
    .badge.good{border-color:rgba(25,255,154,.35); background:rgba(25,255,154,.12)}
    .badge.warn{border-color:rgba(255,209,102,.35); background:rgba(255,209,102,.12)}
    .badge.bad{border-color:rgba(255,77,109,.35); background:rgba(255,77,109,.12)}
    .divider{height:1px; background:var(--line); margin:14px 0}
    .passage{
      padding:12px 14px; border:1px solid var(--line); border-radius:16px;
      background:rgba(0,0,0,.22); line-height:1.62;
      font-size:14px;
    }
    .q{
      margin-top:14px; padding:12px 14px; border:1px solid var(--line);
      border-radius:16px; background:rgba(0,0,0,.20);
    }
    .q h3{margin:0 0 8px; font-size:13px}
    .opts{display:grid; gap:8px; margin-top:8px}
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px; border-radius:14px; border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      cursor:pointer;
    }
    .opt input{margin-top:3px}
    .kpi{display:grid; grid-template-columns:repeat(4,1fr); gap:10px}
    @media (max-width: 980px){ .kpi{grid-template-columns:repeat(2,1fr)} }
    .kpi .box{
      border:1px solid var(--line); border-radius:16px; padding:10px 12px;
      background:rgba(0,0,0,.22);
    }
    .kpi .box .t{font-size:12px; color:var(--muted)}
    .kpi .box .v{font-size:18px; font-weight:800; margin-top:4px}
    .small{font-size:12px; color:var(--muted)}
    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{padding:10px 12px; border-radius:14px; border:1px solid var(--line); background:rgba(0,0,0,.22); cursor:pointer; font-weight:700}
    .tab.active{background:linear-gradient(135deg, rgba(176,0,255,.35), rgba(255,27,106,.22)); border-color:rgba(255,255,255,.22)}
    .resultsList{display:grid; gap:10px}
    .attempt{
      border:1px solid var(--line); border-radius:16px; padding:12px 14px;
      background:rgba(0,0,0,.20);
    }
    .attempt .top{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .attempt .top strong{font-family:var(--mono)}
    .attempt .meta{font-size:12px; color:var(--muted); margin-top:6px; line-height:1.45}
    .copy{font-family:var(--mono); font-size:12px; white-space:pre-wrap; word-break:break-word}
    .hide{display:none !important}

    /* Candidate number 4 cases */
    .digitRow{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .digitRow .digit{
      width:52px; text-align:center; font-family:var(--mono);
      font-size:18px; font-weight:900; padding:12px 0;
      border-radius:14px; border:1px solid var(--line);
      background:rgba(0,0,0,.25); color:var(--text);
      outline:none;
    }
    .digitRow .hint{font-size:12px; color:var(--muted)}
    .miniRow{display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end}
    .miniRow > *{flex:1 1 160px}

    .essayHelp{
      display:grid; gap:8px;
      padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.16);
      font-size:12px; color:var(--muted);
    }
    .essayHelp strong{color:#fff}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>üü£ Otono Spanish ‚Äî A Level ‚Ä¢ Lectura + Mini-ensayo + Traducci√≥n ‚Äî El Drummond Tinta-Cre√≠ble</h1>
        <div class="sub">
          3 textos √ó 20 + 1 mini-ensayo √ó 20 + 1 traducci√≥n √ó 20 = <strong>100</strong> ‚Ä¢ Centro: <strong id="centreTop">50749</strong>
        </div>
      </div>
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end">
        <div class="pill"><span>‚è±Ô∏è Cron√≥metro:</span><strong id="timerText">--:--</strong></div>
        <button class="btn" id="btnResults">Resultados</button>
        <button class="btn primary" id="btnHome">Prueba</button>
      </div>
    </div>

    <div class="grid">
      <!-- IZQUIERDA -->
      <div class="card" id="panelHome">
        <div class="hd">
          <div>
            <h2>Configuraci√≥n del candidato</h2>
            <div class="meta">
              Sin diccionario ‚Ä¢ Sin traductor ‚Ä¢ Respuestas en espa√±ol ‚Ä¢ Auto-correcci√≥n por ideas/palabras clave (no perfecta).
            </div>
          </div>
          <span class="badge" id="statusBadge">Listo</span>
        </div>

        <div class="bd" id="homeBody">
          <div class="miniRow">
            <div>
              <label>N√∫mero de centro</label>
              <input type="text" id="centreNo" value="50749" disabled />
              <div class="small" style="margin-top:6px">
                Valor por defecto: <strong>50749</strong> (editable, opcional).
              </div>
            </div>
            <div style="display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap">
              <button class="btn" id="btnEditCentre">Personalizar</button>
              <button class="btn" id="btnResetCentre">Restablecer</button>
            </div>
          </div>

          <div class="divider"></div>

          <div>
            <label>N√∫mero de candidato (obligatorio, 4 cifras)</label>
            <div class="digitRow" aria-label="N√∫mero de candidato">
              <input class="digit" id="candD1" inputmode="numeric" maxlength="1" />
              <input class="digit" id="candD2" inputmode="numeric" maxlength="1" />
              <input class="digit" id="candD3" inputmode="numeric" maxlength="1" />
              <input class="digit" id="candD4" inputmode="numeric" maxlength="1" />
              <span class="hint">Solo cifras ‚Ä¢ avance autom√°tico</span>
            </div>
          </div>

          <div class="row" style="margin-top:6px">
            <div>
              <label>Apellido (opcional)</label>
              <input type="text" id="candSurname" placeholder="Apellido" />
            </div>
            <div>
              <label>Nombre(s) (opcional)</label>
              <input type="text" id="candForenames" placeholder="Nombre(s)" />
            </div>
          </div>

          <div class="divider"></div>

          <div class="note">
            <strong>Recordatorio importante (nombre):</strong><br/>
            ‚Äú<strong>Otono</strong>‚Äù (del departamento) <strong>NO</strong> tiene relaci√≥n con la palabra espa√±ola ‚Äú<strong>oto√±o</strong>‚Äù.<br/>
            Son palabras distintas y no tienen el mismo origen en este contexto.
          </div>

          <div class="divider"></div>

          <div class="note">
            <strong>Estructura del examen:</strong><br/>
            ‚Ä¢ <strong>3 textos largos</strong> sobre Otono Team / El Drummond Tinta-Cre√≠ble: <strong>20</strong> puntos cada uno.<br/>
            ‚Ä¢ <strong>1 mini-ensayo</strong> (respuesta ~90 palabras) basado en UN texto: <strong>20</strong> puntos.<br/>
            ‚Ä¢ <strong>1 traducci√≥n</strong> ingl√©s ‚Üí espa√±ol: <strong>20</strong> puntos.<br/><br/>
            <strong>Tipos de preguntas:</strong> Opci√≥n m√∫ltiple ‚Ä¢ Verdadero/Falso/No se menciona ‚Ä¢ Positivo/Negativo/Ambos ‚Ä¢ Respuestas escritas ‚Ä¢
            Encontrar en el texto una palabra/expresi√≥n con <strong>el mismo significado</strong> que otra palabra.
          </div>

          <div class="divider"></div>

          <div class="row">
            <div>
              <label>Tiempo permitido</label>
              <select id="timeAllowed">
                <option value="90">90 minutos</option>
                <option value="105">105 minutos</option>
                <option value="120" selected>120 minutos (recomendado)</option>
                <option value="135">135 minutos</option>
                <option value="150">150 minutos (m√°x.)</option>
              </select>
            </div>
            <div>
              <label>Orden de preguntas</label>
              <select id="shuffleMode">
                <option value="shuffleAll" selected>Mezclar preguntas (m√°s dif√≠cil)</option>
                <option value="keepOrder">Mantener el orden</option>
              </select>
            </div>
            <div>
              <label>Fin del cron√≥metro</label>
              <select id="autoSubmit">
                <option value="yes" selected>Enviar autom√°ticamente</option>
                <option value="no">No enviar</option>
              </select>
            </div>
          </div>

          <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap">
            <button class="btn primary" id="btnStart">Empezar prueba aleatoria</button>
            <button class="btn" id="btnPreview">Vista previa (sin empezar)</button>
          </div>

          <div id="previewBox" class="note hide" style="margin-top:12px"></div>
        </div>

        <!-- CUERPO DE LA PRUEBA -->
        <div class="bd hide" id="testBody">
          <div class="kpi">
            <div class="box"><div class="t">Candidato</div><div class="v" id="kpiCandidate">‚Äî</div></div>
            <div class="box"><div class="t">Textos</div><div class="v" id="kpiPassages">‚Äî</div></div>
            <div class="box"><div class="t">Mini-ensayo</div><div class="v" id="kpiEssay">‚Äî</div></div>
            <div class="box"><div class="t">Nota m√°x.</div><div class="v">100</div></div>
          </div>

          <div class="divider"></div>

          <div class="note">
            <strong>Recordatorio:</strong> respuestas solo en espa√±ol. Ap√≥yate en el texto. Para respuestas escritas, s√© claro y directo.
          </div>

          <div id="paper"></div>

          <div class="divider"></div>

          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn primary" id="btnSubmit">Enviar y auto-corregir</button>
            <button class="btn" id="btnReset">Reiniciar (nueva prueba)</button>
          </div>

          <div id="markingBox" class="hide" style="margin-top:14px"></div>
        </div>
      </div>

      <!-- DERECHA -->
      <div class="card" id="panelSide">
        <div class="hd">
          <div>
            <h2 id="sideTitle">Calificaci√≥n Otono</h2>
            <div class="meta" id="sideMeta">Puntuaci√≥n ‚Üí nota Otono + estimaci√≥n GCSE + Pass/Merit/Distinction.</div>
          </div>
        </div>

        <div class="bd" id="sideBody">
          <div class="note">
            <strong>Pass / Merit / Distinction</strong><br/>
            PASS : 66+<br/>
            MERIT : 80+<br/>
            DISTINCTION : 90+<br/>
          </div>
          <div class="divider"></div>
          <div class="note">
            <strong>Notas Otono (A‚ÄìH + secreto S)</strong><br/>
            S : 101+ (secreto)<br/>
            A* : 95‚Äì100<br/>
            A : 90‚Äì94<br/>
            B : 80‚Äì89<br/>
            C : 70‚Äì79<br/>
            D : 66‚Äì69<br/>
            E : 55‚Äì65<br/>
            F : 45‚Äì54<br/>
            G : 30‚Äì44<br/>
            H : 15‚Äì29<br/>
            U : 0‚Äì14
          </div>
          <div class="divider"></div>
          <div class="note">
            <strong>Estimaci√≥n GCSE 9‚Äì1 (mapeo simple)</strong><br/>
            9 : 90‚Äì100 ‚Ä¢ 8 : 80‚Äì89 ‚Ä¢ 7 : 70‚Äì79 ‚Ä¢ 6 : 60‚Äì69 ‚Ä¢ 5 : 50‚Äì59<br/>
            4 : 40‚Äì49 ‚Ä¢ 3 : 30‚Äì39 ‚Ä¢ 2 : 20‚Äì29 ‚Ä¢ 1 : 10‚Äì19 ‚Ä¢ U : 0‚Äì9
          </div>
          <div class="divider"></div>
          <div class="small">Los resultados se guardan solo en este navegador (localStorage).</div>
        </div>

        <!-- RESULTADOS -->
        <div class="bd hide" id="resultsBody">
          <div class="tabs">
            <div class="tab active" id="tabAll">Todos los intentos</div>
            <div class="tab" id="tabCandidate">Por candidato</div>
          </div>

          <div class="row" style="margin-top:10px">
            <div>
              <label>Filtrar por n√∫mero (4 cifras)</label>
              <input type="text" id="filterCandidate" placeholder="ej.: 1105" inputmode="numeric" />
            </div>
            <div>
              <label>Acciones</label>
              <div style="display:flex; gap:10px; flex-wrap:wrap">
                <button class="btn" id="btnExport">Exportar JSON</button>
                <button class="btn danger" id="btnClear">Borrar todo</button>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="resultsList" id="resultsList"></div>

          <div id="exportBox" class="note hide" style="margin-top:12px">
            <div><strong>JSON exportado</strong> (c√≥pialo/gu√°rdalo):</div>
            <div class="divider"></div>
            <div class="copy" id="exportText"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* =========================================================
   üîí ANTI-COPIA / ANTI-DETECCI√ìN (razonable)
   Objetivo: evitar que la UI muestre los bancos en claro
   y desanimar el copiar/pegar del ‚Äúsource‚Äù.
   (No sustituye la seguridad real ‚Äî pero es √∫til para un test local.)
========================================================= */

const disabledKeys = ["u", "I"];
const showAlert = e => {
  e.preventDefault();
  return alert("Hahaha, I challenge you, valiant soldier, to uproot the source codes yourself!!!");
};
document.addEventListener("contextmenu", e => { showAlert(e); });
document.addEventListener("keydown", e => {
  if ((e.ctrlKey && disabledKeys.includes(e.key)) || e.key === "F12") {
    showAlert(e);
  }
});

/* =========================================================
   OTONO ‚Äî A LEVEL BANCOS (Otono Team / El Drummond Tinta-Cre√≠ble)
   3 textos √ó 20 = 60
   1 mini-ensayo (~90 palabras) √ó 20 = 20
   1 traducci√≥n EN->ES √ó 20 = 20
   TOTAL = 100
========================================================= */

const PASSAGES_A = [
  {
    id:"P1",
    titre:"Texto P1 ‚Äî Los sobres morados",
    theme:"El Drummond Tinta-Cre√≠ble ‚Äî Resultados y reglas",
    texte:`El d√≠a de los resultados, Red decidi√≥ hacerlo a su manera. En lugar de imprimir una simple nota final, prepar√≥ un sobre morado para cada candidato. Dentro hab√≠a dos cosas: primero, la hoja de resultados detallada, con los puntos por secci√≥n y el total; despu√©s, la copia original, la que deb√≠a devolverse a Red tras consultarla. La regla era clara: se pod√≠a mirar la copia, pero no se pod√≠a modificar. Red dec√≠a que era una cuesti√≥n de honestidad y trazabilidad.

Para algunos, el sobre ten√≠a un valor extra. Si el candidato cumpl√≠a los requisitos, el sobre tambi√©n inclu√≠a un peque√±o bonus. Pero ese bonus nunca era autom√°tico: depend√≠a del respeto de las instrucciones. Una sola cosa pod√≠a complicarlo todo: una penalizaci√≥n. Por ejemplo, si la tinta estaba prohibida o si una parte estaba en el idioma equivocado, Red pod√≠a quitar puntos. En ese caso, escrib√≠a dos notas: la puntuaci√≥n original y la puntuaci√≥n con penalizaci√≥n. A veces era frustrante, pero Red insist√≠a: ¬´Yo corrijo lo que est√° escrito, no lo que quer√≠as escribir¬ª.

A pesar de la tensi√≥n, el ambiente segu√≠a siendo particular: algunos bromeaban, otros se comparaban y Luke, por su parte, miraba sobre todo la nitidez de las respuestas y el color de la tinta.`,
    questions:[
      {id:"P1_q1", type:"mcq", marks:2,
        prompt:"1) En el sobre morado, sobre todo hay‚Ä¶",
        options:["una sola nota final sin detalle","la hoja de resultados detallada y la copia original","una carta de motivaci√≥n y un contrato","un tel√©fono y un c√≥digo secreto"],
        answerIndex:1
      },
      {id:"P1_q2", type:"tfnm", marks:2,
        prompt:"2) El candidato tiene derecho a modificar la copia original. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P1_q3", type:"pn", marks:2,
        prompt:"3) El autor presenta la penalizaci√≥n como‚Ä¶ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P1_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´seguimiento oficial¬ª (una palabra).",
        acceptable:["trazabilidad"]
      },
      {id:"P1_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´prohibida¬ª (femenino)? (una palabra del texto)",
        acceptable:["prohibida"]
      },
      {id:"P1_q6", type:"short", marks:6,
        prompt:"6) Explica dos razones por las que Red escribe dos notas (puntuaci√≥n original y con penalizaci√≥n).",
        rubric:"Ideas: mostrar el impacto de la penalizaci√≥n; ser transparente; corregir lo escrito; probar la regla/instrucci√≥n; trazabilidad/honestidad.",
        keywords:[
          ["penalizacion","penalizaci√≥n","impacto"],
          ["transparente","transparencia","mostrar"],
          ["corrijo lo que esta escrito","corrijo lo que est√° escrito","lo que esta escrito","lo que est√° escrito"],
          ["honestidad","trazabilidad"],
          ["regla","instruccion","instrucci√≥n","consigna"]
        ]
      }
    ]
  },

  {
    id:"P2",
    titre:"Texto P2 ‚Äî La regla de la tinta negra",
    theme:"El Drummond Tinta-Cre√≠ble ‚Äî Presentaci√≥n y sanciones",
    texte:`En el Otono Team, la presentaci√≥n no es un detalle; casi es una disciplina. Red tiene una regla muy estricta: la tinta negra es obligatoria. Explica que, en un examen, la legibilidad importa tanto como la respuesta. A algunos les parece excesivo, pero Red responde que la justicia empieza por condiciones id√©nticas para todo el mundo. La mayor√≠a de los candidatos se adapta sin discutir demasiado, sobre todo porque ya han visto caer una penalizaci√≥n.

El problema no es solo el color. Red tambi√©n comprueba si la respuesta corresponde a la consigna, si el candidato no mezcla idiomas y si la p√°gina no parece un borrador. Cuando alguien usa una tinta prohibida, Red no grita: anota tranquilamente ¬´penalizaci√≥n por tinta¬ª y ajusta el total. A veces quita puntos por la presentaci√≥n; otras veces, si afecta a una parte entera, puede decidir que esa secci√≥n no cuenta. Dice que la regla no est√° hecha para castigar a una persona, sino para proteger el valor del resultado.

Luke se toma la regla en serio. Para √©l, la tinta negra no es solo una elecci√≥n: es una evidencia. Otros, como Wyatt, siguen la regla sobre todo porque odian la idea de una puntuaci√≥n reducida por un detalle evitable.`,
    questions:[
      {id:"P2_q1", type:"mcq", marks:2,
        prompt:"1) ¬øPor qu√© Red impone la tinta negra?",
        options:["Porque le gustan los colores vivos","Porque la legibilidad y las condiciones id√©nticas importan","Porque quiere asustar a todo el mundo","Porque proh√≠be todos los bol√≠grafos"],
        answerIndex:1
      },
      {id:"P2_q2", type:"tfnm", marks:2,
        prompt:"2) Red grita cuando alguien usa una tinta prohibida. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P2_q3", type:"pn", marks:2,
        prompt:"3) La regla se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P"
      },
      {id:"P2_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´legibilidad¬ª (una palabra del texto).",
        acceptable:["legibilidad"]
      },
      {id:"P2_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra corresponde a ¬´borrador¬ª (misma palabra)?",
        acceptable:["borrador"]
      },
      {id:"P2_q6", type:"short", marks:6,
        prompt:"6) Da dos cosas que Red comprueba adem√°s del color de la tinta.",
        rubric:"Consigna; mezcla de idiomas; p√°gina limpia; secci√≥n; borrador; legibilidad.",
        keywords:[
          ["consigna","instruccion","instrucci√≥n"],
          ["idioma","idiomas","mezcla","mezclar"],
          ["pagina","p√°gina","limpia"],
          ["borrador"],
          ["seccion","secci√≥n"]
        ]
      }
    ]
  },

  {
    id:"P3",
    titre:"Texto P3 ‚Äî Las revisiones y el cansancio",
    theme:"El Drummond Tinta-Cre√≠ble ‚Äî Correcciones y presi√≥n",
    texte:`Cuando Red anunci√≥ que har√≠a revisiones, algunos creyeron que ser√≠a un tr√°mite. En realidad, una revisi√≥n exige rigor. Hay que releer sin dejarse influir por la primera impresi√≥n, comprobar los criterios y aceptar la posibilidad de un error inicial. Red dice que una revisi√≥n no es un regalo: es una segunda lectura seria.

Ese d√≠a, el cansancio lo complic√≥. Varios candidatos hab√≠an entregado copias largas, y Red ya hab√≠a pasado mucho tiempo comprobando las secciones. Cuando Clayton lleg√≥, estaba seguro de s√≠ mismo en una materia‚Ä¶ pero no en todas. En idiomas, no ten√≠a la misma estabilidad, y eso sorprendi√≥ a algunas personas. Angus Drummond, por su parte, esperaba sobre todo que la correcci√≥n fuera coherente: odia las aproximaciones, incluso cuando le benefician.

As√≠ que Red decidi√≥ trabajar paso a paso. Separ√≥ la copia en bloques, anot√≥ las pruebas y compar√≥ la respuesta con la consigna. Tambi√©n explic√≥ su m√©todo en voz alta: ¬´Tengo que poder justificar cada punto. Si no puedo justificarlo, no lo doy¬ª. Al final, la revisi√≥n no siempre cambi√≥ la nota, pero a menudo aclar√≥ por qu√© exist√≠a esa nota.`,
    questions:[
      {id:"P3_q1", type:"mcq", marks:2,
        prompt:"1) Para Red, una revisi√≥n es sobre todo‚Ä¶",
        options:["un regalo autom√°tico","una segunda lectura seria","una forma de cambiar todas las notas","un juego para comparar candidatos"],
        answerIndex:1
      },
      {id:"P3_q2", type:"tfnm", marks:2,
        prompt:"2) Red explica que da puntos aunque no pueda justificarlos. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P3_q3", type:"pn", marks:2,
        prompt:"3) El cansancio se presenta como‚Ä¶ (P / N / P+N)",
        correct:"N"
      },
      {id:"P3_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´justificar¬ª (misma palabra).",
        acceptable:["justificar"]
      },
      {id:"P3_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´manera¬ª? (una palabra del texto)",
        acceptable:["metodo","m√©todo"]
      },
      {id:"P3_q6", type:"short", marks:6,
        prompt:"6) ¬øPor qu√© Red trabaja ¬´paso a paso¬ª durante la revisi√≥n? Da dos razones.",
        rubric:"Rigor; evitar influencia de la primera impresi√≥n; justificar cada punto; comparar con la consigna; coherencia.",
        keywords:[
          ["rigor"],
          ["primera impresion","primera impresi√≥n","influ"],
          ["justificar","prueba","pruebas"],
          ["consigna"],
          ["coherencia","coherente"]
        ]
      }
    ]
  },

  {
    id:"P4",
    titre:"Texto P4 ‚Äî Los mensajes y la comparaci√≥n",
    theme:"Otono Team ‚Äî Amistades, presi√≥n, comparaci√≥n",
    texte:`Despu√©s de los resultados, empezaron a llegar mensajes. Unos felicitaban, otros ped√≠an detalles y algunos quer√≠an comparar. En el Otono Team, la comparaci√≥n puede convertirse r√°pido en una trampa: no se comparan solo puntuaciones, sino esfuerzos, m√©todos y a veces incluso personalidades. Benjamin Nelson tiene una frase sencilla sobre esto: odia cuando alguien mide su valor mirando al de al lado.

Red lo sabe, pero tambi√©n entiende por qu√© la gente compara. Cuando una nota parece misteriosa, se busca un referente. Cuando se ha trabajado mucho, se quiere una prueba de que sirvi√≥. Sin embargo, la comparaci√≥n tiene un efecto secundario: convierte un progreso personal en una competici√≥n permanente. Luke prefiere analizar su propia copia: mira la estructura, la precisi√≥n y los lugares donde podr√≠a haber sido m√°s claro. Wyatt, en cambio, no quiere pasarse la noche con eso. Solo quiere saber si se respet√≥ la regla y si no se perdi√≥ ning√∫n punto por un detalle evitable.

En medio de esas reacciones, Red repite la misma idea: la nota no es una identidad. Es un resultado en un momento dado. Puede guiar el pr√≥ximo trabajo, pero no deber√≠a decidir la confianza de una persona.`,
    questions:[
      {id:"P4_q1", type:"mcq", marks:2,
        prompt:"1) ¬øPor qu√© algunas personas comparan sus notas?",
        options:["Porque siempre quieren hacer trampas","Porque la nota parece misteriosa y buscan un referente","Porque Red proh√≠be los sobres","Porque no hay ning√∫n m√©todo"],
        answerIndex:1
      },
      {id:"P4_q2", type:"tfnm", marks:2,
        prompt:"2) El texto dice que la nota es una identidad. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P4_q3", type:"pn", marks:2,
        prompt:"3) La comparaci√≥n se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P4_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´trampa¬ª (misma palabra).",
        acceptable:["trampa"]
      },
      {id:"P4_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´confianza¬ª (misma palabra)?",
        acceptable:["confianza"]
      },
      {id:"P4_q6", type:"short", marks:6,
        prompt:"6) Da dos diferencias entre la reacci√≥n de Luke y la de Wyatt.",
        rubric:"Luke analiza su copia (estructura, precisi√≥n); Wyatt solo verifica reglas/penalizaci√≥n; Luke dedica tiempo; Wyatt evita la noche.",
        keywords:[
          ["luke","analiza","estructura","precision","precisi√≥n","claro"],
          ["wyatt","regla","respet","detalle","penalizacion","penalizaci√≥n"],
          ["no quiere","evita","noche"]
        ]
      }
    ]
  },

  /* --- M√ÅS TEXTOS (banco ampliado) --- */
  {
    id:"P5",
    titre:"Texto P5 ‚Äî El sal√≥n, la calma y el orden",
    theme:"Otono Team ‚Äî Organizaci√≥n y concentraci√≥n",
    texte:`En una de las salas del Otono Team hay un ritual discreto antes de estudiar: ordenar, clasificar y apartar lo que distrae. No es una obsesi√≥n, sino una forma de proteger la atenci√≥n. Red dice que la concentraci√≥n no se fabrica solo con fuerza de voluntad; tambi√©n se fabrica con el entorno. Por eso, antes de empezar, pide cosas simples: el m√≥vil fuera de alcance, una hoja limpia y un objetivo preciso para la sesi√≥n.

A Luke le encanta el ritual. Le gusta sentir que todo est√° listo: la tinta negra, la regla, el orden de las p√°ginas. Dice que esa calma exterior crea una calma interior. OWing es m√°s r√°pido: quiere empezar inmediatamente, a veces sin hablar, como si ponerse en marcha ya fuera una p√©rdida de tiempo. Jessica encuentra un equilibrio: le gusta planificar, pero se niega a convertir la sesi√≥n en una ceremonia. Para ella, lo importante es comprender y reformular.

Este ritual tambi√©n tiene una ventaja social. Cuando todos respetan el silencio al principio, bajan las tensiones. No se comparan, no se provocan y se concentran en el trabajo. Luego, cuando termina la sesi√≥n, se puede bromear. Red insiste: ¬´El silencio no es un castigo, es una protecci√≥n¬ª.`,
    questions:[
      {id:"P5_q1", type:"mcq", marks:2,
        prompt:"1) El ritual sirve sobre todo para‚Ä¶",
        options:["hacer perder tiempo","proteger la atenci√≥n","prohibir hablar para siempre","cambiar las notas autom√°ticamente"],
        answerIndex:1
      },
      {id:"P5_q2", type:"tfnm", marks:2,
        prompt:"2) Jessica quiere convertir la sesi√≥n en una ceremonia. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P5_q3", type:"pn", marks:2,
        prompt:"3) El silencio se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P"
      },
      {id:"P5_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´proteger¬ª (misma palabra).",
        acceptable:["proteger","proteccion","protecci√≥n"]
      },
      {id:"P5_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´equilibrio¬ª? (una palabra del texto)",
        acceptable:["equilibrio"]
      },
      {id:"P5_q6", type:"short", marks:6,
        prompt:"6) Da dos razones por las que el ritual tambi√©n ayuda al grupo (no solo a una persona).",
        rubric:"Bajan tensiones; no hay comparaci√≥n/provocaci√≥n; silencio com√∫n; ambiente; despu√©s se bromea.",
        keywords:[
          ["tension","tensiones","bajan"],
          ["compar","provoc"],
          ["silencio","comun","com√∫n"],
          ["ambiente"],
          ["bromear","broma"]
        ]
      }
    ]
  },

  {
    id:"P6",
    titre:"Texto P6 ‚Äî La copia original y la confianza",
    theme:"El Drummond Tinta-Cre√≠ble ‚Äî Transparencia",
    texte:`La regla de la copia original cre√≥ debate. Algunos se preguntaban: ¬øpor qu√© devolver la copia a Red? ¬øpor qu√© no guardarla? Red respond√≠a siempre con la misma l√≥gica: la copia original no es un recuerdo, es una prueba. En su sistema, la idea de prueba protege a todos. Protege al candidato frente a un error de correcci√≥n; protege al corrector frente a acusaciones injustas; y tambi√©n protege al grupo frente a discusiones interminables.

Para demostrar que no busca controlar, Red permite la consulta. Dice: ¬´Puedes leer, puedes anotar tus errores, puedes comprender. Pero no puedes reescribir la historia¬ª. Esa frase marc√≥ a varias personas, porque convierte la correcci√≥n en un momento de aprendizaje. A Luke le gust√≥ inmediatamente: le encanta la idea de que un resultado tenga que ser claro y verificable. Otros pensaban que la regla era demasiado r√≠gida, pero reconoc√≠an algo: cuando todo es verificable, se discute menos.

Al final, la copia original no est√° ah√≠ para humillar. Est√° ah√≠ para recordar que el progreso empieza cuando se acepta lo que est√° escrito y luego se decide qu√© se va a mejorar.`,
    questions:[
      {id:"P6_q1", type:"mcq", marks:2,
        prompt:"1) Para Red, la copia original es sobre todo‚Ä¶",
        options:["un recuerdo","una prueba","un castigo","un objeto decorativo"],
        answerIndex:1
      },
      {id:"P6_q2", type:"tfnm", marks:2,
        prompt:"2) Red proh√≠be consultar la copia. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P6_q3", type:"pn", marks:2,
        prompt:"3) La regla se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P6_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´verificable¬ª (misma palabra).",
        acceptable:["verificable"]
      },
      {id:"P6_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´discusiones¬ª (misma palabra)?",
        acceptable:["discusiones"]
      },
      {id:"P6_q6", type:"short", marks:6,
        prompt:"6) Explica c√≥mo la regla puede ¬´proteger a todos¬ª (dos ideas).",
        rubric:"Protege candidato (error); protege corrector (acusaciones); protege grupo (discusiones).",
        keywords:[
          ["candidato","error"],
          ["corrector","acusacion","acusaci√≥n","acusaciones"],
          ["grupo","discusiones","interminables","se discute menos"]
        ]
      }
    ]
  },

  {
    id:"P7",
    titre:"Texto P7 ‚Äî Elegir el tono en una revisi√≥n",
    theme:"El Drummond Tinta-Cre√≠ble ‚Äî Comunicaci√≥n",
    texte:`En una revisi√≥n, la manera de hablar puede cambiar la manera de entender. Red se dio cuenta de que, si el tono se vuelve agresivo, el candidato ya no escucha la justificaci√≥n: se cierra y la discusi√≥n se convierte en una batalla. Por eso Red prefiere un tono neutro y preciso. Usa frases simples: ¬´Aqu√≠ no se respeta la consigna¬ª; ¬´All√≠ la idea es buena, pero falta la prueba¬ª. Para √©l, una revisi√≥n debe parecerse a un informe, no a una humillaci√≥n.

Esa actitud no siempre es f√°cil de mantener. Cuando el cansancio sube, cuando el candidato insiste sin argumentos o cuando alguien niega lo evidente, el corrector puede perder la paciencia. Angus Drummond lo entiende, porque odia la aproximaci√≥n, pero respeta la coherencia. Prefiere una frase fr√≠a pero exacta a una frase amable pero falsa. Luke observa la l√≥gica: si el punto est√° justificado, lo acepta; si el punto es confuso, hace una pregunta.

Al final, el tono neutro no elimina la frustraci√≥n, pero hace la decisi√≥n m√°s clara. Y cuando la decisi√≥n est√° clara, se puede pasar al siguiente trabajo: mejorar lo que se pueda mejorar.`,
    questions:[
      {id:"P7_q1", type:"mcq", marks:2,
        prompt:"1) ¬øPor qu√© Red elige un tono neutro?",
        options:["Para parecer m√°s gracioso","Para que el candidato escuche la justificaci√≥n","Para evitar toda prueba","Para cambiar las reglas"],
        answerIndex:1
      },
      {id:"P7_q2", type:"tfnm", marks:2,
        prompt:"2) Red quiere que la revisi√≥n parezca una humillaci√≥n. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P7_q3", type:"pn", marks:2,
        prompt:"3) El tono agresivo se presenta como‚Ä¶ (P / N / P+N)",
        correct:"N"
      },
      {id:"P7_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´justificaci√≥n¬ª (misma palabra).",
        acceptable:["justificacion","justificaci√≥n"]
      },
      {id:"P7_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´batalla¬ª (misma palabra)?",
        acceptable:["batalla"]
      },
      {id:"P7_q6", type:"short", marks:6,
        prompt:"6) Da dos momentos en los que el corrector puede perder la paciencia, seg√∫n el texto.",
        rubric:"Cansancio; el candidato insiste sin argumentos; alguien niega lo evidente.",
        keywords:[
          ["cansancio"],
          ["insiste","sin argumento","sin argumentos","argumento","argumentos"],
          ["niega","negar","evidente","lo evidente"]
        ]
      }
    ]
  },

  {
    id:"P8",
    titre:"Texto P8 ‚Äî Otono Airways y la reputaci√≥n",
    theme:"Otono Team ‚Äî Identidad y detalles",
    texte:`En las conversaciones del Otono Team, Otono Airways aparece a menudo como un s√≠mbolo. No es solo una aerol√≠nea: es una idea de calidad. Red dice que los detalles construyen una reputaci√≥n: la organizaci√≥n, la claridad de las reglas y la comodidad percibida. Incluso cuando alguien viaja en clase econ√≥mica, debe sentir que el sistema est√° pensado. A Luke le gusta esa l√≥gica porque se parece a la correcci√≥n: si el sistema es coherente, se conf√≠a.

Pero esa obsesi√≥n por los detalles puede cansar. Algunos amigos de Red no notan la diferencia al principio; luego, un d√≠a, la ven y reaccionan. Red lo considera normal: la costumbre cambia la percepci√≥n. Al principio aceptas lo que conoces; despu√©s comparas. Sin embargo, Red insiste en una cosa: no hay que confundir comodidad y respeto. Un asiento m√°s grande no sustituye la cortes√≠a, y una regla estricta no sustituye la comprensi√≥n. Para √©l, la verdadera calidad es un equilibrio: un marco s√≥lido, pero una actitud humana.

Cuando el debate se vuelve demasiado intenso, Jessica lo resume con calma: ¬´Los detalles sirven para ayudar, no para aplastar¬ª. Esa frase suele poner a todos de acuerdo, al menos por unos minutos.`,
    questions:[
      {id:"P8_q1", type:"mcq", marks:2,
        prompt:"1) Seg√∫n Red, una reputaci√≥n se construye sobre todo con‚Ä¶",
        options:["el azar","los detalles y la coherencia","gritos y peleas","excusas sin reglas"],
        answerIndex:1
      },
      {id:"P8_q2", type:"tfnm", marks:2,
        prompt:"2) El texto dice que un asiento m√°s grande sustituye el respeto. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P8_q3", type:"pn", marks:2,
        prompt:"3) La obsesi√≥n por los detalles se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P8_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´confianza¬ª (misma palabra).",
        acceptable:["confianza"]
      },
      {id:"P8_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´equilibrio¬ª (misma palabra)?",
        acceptable:["equilibrio"]
      },
      {id:"P8_q6", type:"short", marks:6,
        prompt:"6) Explica la idea de Jessica: ¬´Los detalles sirven para ayudar, no para aplastar¬ª (dos ideas).",
        rubric:"Detalles √∫tiles; no para humillar; marco s√≥lido + actitud humana; comprensi√≥n/cortes√≠a.",
        keywords:[
          ["ayudar"],
          ["aplastar","humillar","castigar"],
          ["marco","solido","s√≥lido"],
          ["humana","humano","cortesia","cortes√≠a","respeto"],
          ["comprension","comprensi√≥n","comprender"]
        ]
      }
    ]
  },

  {
    id:"P9",
    titre:"Texto P9 ‚Äî OWing y la velocidad de trabajo",
    theme:"Otono Team ‚Äî M√©todos, eficacia, equilibrio",
    texte:`En el Otono Team, OWing es conocido por una cosa: va r√°pido. No r√°pido en el sentido de ‚Äúapurado‚Äù, sino r√°pido en el sentido de ‚Äúdirecto‚Äù. Cuando empieza una sesi√≥n, no le gustan las introducciones largas. Abre la hoja, identifica la consigna y ataca. Red admira esa energ√≠a, pero a veces le preocupa: ir r√°pido puede dar la ilusi√≥n de dominar, cuando algunas ideas necesitan tiempo.

Una noche, Red quiso poner a prueba el m√©todo de OWing. Le propuso una sesi√≥n cuyo objetivo no era solo terminar, sino justificar cada paso. OWing acept√≥, un poco divertido: ¬´De acuerdo, pero ver√°s que puedo ser r√°pido y preciso¬ª. Luke observaba en silencio. Quer√≠a comprobar si la precisi√≥n se manten√≠a cuando la velocidad sub√≠a.

Al principio, OWing demostr√≥ su fuerza: reformula la pregunta, elige una estructura clara y anota ejemplos sin dudar. Pero a mitad, un detalle fren√≥ la m√°quina: un matiz en la consigna, una palabra que lo cambia todo. Red insisti√≥: ¬´No es un castigo. Es el momento en el que demuestras que entiendes, no solo que avanzas¬ª. OWing se detuvo, reley√≥ y corrigi√≥ su enfoque. No perdi√≥ su estilo: lo reforz√≥.

Despu√©s, Red concluy√≥ que la velocidad no es el enemigo. El verdadero peligro es la velocidad sin control. OWing sonri√≥: no le gustan las lecciones, pero respeta las ideas que le ayudan a ganar tiempo sin perder calidad.`,
    questions:[
      {id:"P9_q1", type:"mcq", marks:2,
        prompt:"1) ¬øPor qu√© a veces Red se preocupa por la velocidad de OWing?",
        options:[
          "Porque OWing se niega a trabajar",
          "Porque la velocidad puede dar la ilusi√≥n de dominar sin comprender",
          "Porque Red odia que alguien termine pronto",
          "Porque OWing escribe con colores"
        ],
        answerIndex:1
      },
      {id:"P9_q2", type:"tfnm", marks:2,
        prompt:"2) OWing rechaza la sesi√≥n en la que debe justificar cada paso. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P9_q3", type:"pn", marks:2,
        prompt:"3) La velocidad se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P9_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´duda / vacilaci√≥n¬ª (una palabra).",
        acceptable:["dudar","duda","vacilacion","vacilaci√≥n","vacila","vacilar"]
      },
      {id:"P9_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´matiz¬ª (misma palabra)?",
        acceptable:["matiz","matices"]
      },
      {id:"P9_q6", type:"short", marks:6,
        prompt:"6) Explica dos cosas que Red quiere comprobar con la sesi√≥n (dos ideas).",
        rubric:"Comprensi√≥n real vs ilusi√≥n; justificar pasos; precisi√≥n bajo velocidad; atenci√≥n a la consigna; control.",
        keywords:[
          ["ilusion","ilusi√≥n","dominar","comprender","entiendes","entiende"],
          ["justificar","paso","pasos"],
          ["precision","precisi√≥n"],
          ["consigna","matiz","palabra que lo cambia todo"],
          ["control"]
        ]
      }
    ]
  },

  {
    id:"P10",
    titre:"Texto P10 ‚Äî Joshua y el ¬´morad√≠simo, morad√≠simo, morad√≠simo, morad√≠simo, morad√≠simo oscuro¬ª",
    theme:"Otono Team ‚Äî Humor, reglas, identidad",
    texte:`A Joshua le encantan las bromas, sobre todo las que llegan en el peor momento: cuando todo el mundo intenta ser serio. Un d√≠a, mientras Red recordaba otra vez la regla de la tinta negra, Joshua levant√≥ su bol√≠grafo con cara inocente. ¬´Yo respeto la regla¬ª, anunci√≥, ¬´pero yo no uso negro. Yo uso morad√≠simo, morad√≠simo, morad√≠simo, morad√≠simo, morad√≠simo oscuro¬ª. Marc√≥ cada ‚Äúmorad√≠simo‚Äù como si fuera una demostraci√≥n cient√≠fica.

Luke mir√≥ inmediatamente la punta del bol√≠grafo, listo para declarar una cat√°strofe. Wyatt se ech√≥ a re√≠r, porque le encanta cuando alguien provoca sin romper de verdad la regla. Red no se ri√≥ al instante. Mir√≥ a Joshua y pregunt√≥ con calma: ¬´¬øQuieres una broma o quieres un punto?¬ª. Joshua respondi√≥: ¬´Quiero las dos cosas¬ª. Eso define su humor: quiere relajar el ambiente sin perder el objetivo.

Al final, Joshua sac√≥ un bol√≠grafo negro de verdad. Pero no abandon√≥ la broma: escribi√≥ ‚Äúmorado oscuro‚Äù como t√≠tulo, solo para que todos lo recordaran. Red suspir√≥, pero reconoci√≥ algo: a veces, una broma impide que una tensi√≥n se convierta en una discusi√≥n. Mientras se respete la regla, el humor puede servir para respirar.

Despu√©s de la sesi√≥n, Joshua explic√≥ su l√≥gica: si nunca se puede re√≠r, uno acaba odiando el trabajo. Red respondi√≥ que re√≠r est√° permitido, pero que la copia debe seguir siendo clara. En eso estaban de acuerdo.`,
    questions:[
      {id:"P10_q1", type:"mcq", marks:2,
        prompt:"1) ¬øPor qu√© Joshua insiste tanto en ¬´morad√≠simo¬ª?",
        options:[
          "Porque quiere imitar una demostraci√≥n",
          "Porque quiere que Luke cambie las reglas",
          "Porque no tiene ning√∫n bol√≠grafo",
          "Porque rechaza toda correcci√≥n"
        ],
        answerIndex:0
      },
      {id:"P10_q2", type:"tfnm", marks:2,
        prompt:"2) Joshua acaba usando un bol√≠grafo negro de verdad. (Verdadero / Falso / No se menciona)",
        correct:"Verdadero"
      },
      {id:"P10_q3", type:"pn", marks:2,
        prompt:"3) El humor se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P10_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´discusi√≥n¬ª (misma palabra).",
        acceptable:["discusion","discusi√≥n","discusiones"]
      },
      {id:"P10_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´tensi√≥n¬ª (misma palabra)?",
        acceptable:["tension","tensi√≥n","tensiones"]
      },
      {id:"P10_q6", type:"short", marks:6,
        prompt:"6) Da dos razones por las que Red acepta el humor de Joshua, seg√∫n el texto.",
        rubric:"Relaja el ambiente; evita que la tensi√≥n sea discusi√≥n; se respeta la regla; ayuda a respirar; mantener el objetivo.",
        keywords:[
          ["relajar","ambiente"],
          ["evita","tension","tensi√≥n","discusion","discusi√≥n"],
          ["regla","respete","respetar"],
          ["respirar"],
          ["objetivo","copia","clara"]
        ]
      }
    ]
  },

  /* -------------------- P11 SPANISH (replacement due to complaints) -------------------- */
{
  id:"P11",
  titre:"Pasaje P11 ‚Äî El departamento de lenguas de Otono",
  theme:"Departamento MFL de Otono ‚Äî quejas, organizaci√≥n y credibilidad",
  texte:`El departamento de lenguas de Otono no empez√≥ como una actividad divertida. Empez√≥ con quejas. Algunos alumnos dec√≠an que las instrucciones no eran claras. Otros pensaban que los criterios eran demasiado duros. Tambi√©n hab√≠a personas que dec√≠an que el sistema parec√≠a imprevisible.

Red escuch√≥ todas las cr√≠ticas, pero tom√≥ una decisi√≥n importante: mejorar la claridad sin bajar el nivel. Seg√∫n √©l, un departamento serio debe ser comprensible y coherente. Si los alumnos no entienden por qu√© pierden puntos, el problema no es la dificultad, sino la explicaci√≥n.

Para solucionar esto, Red cre√≥ un peque√±o grupo de ayuda. Luke se encarg√≥ del formato y de comprobar que todo fuera claro: acentos, puntuaci√≥n, estructura y orden de las preguntas. Shireen trabaj√≥ sobre el contenido ling√º√≠stico. Revisaba los textos, buscaba errores de sentido y comprobaba que una pregunta no castigara a un alumno honesto. Thomas analizaba la l√≥gica de preguntas como verdadero/falso/no mencionado. Lewis ayudaba a simplificar instrucciones sin hacerlas f√°ciles. Benjamin Nelson ten√≠a otra funci√≥n: recordar que el objetivo del departamento es aprender idiomas, no comparar personas.

El nuevo sistema se volvi√≥ m√°s exigente, pero tambi√©n m√°s claro. Curiosamente, las quejas m√°s fuertes desaparecieron poco a poco. La raz√≥n era simple: cuando cada decisi√≥n puede explicarse, el sistema puede criticarse‚Ä¶ pero tambi√©n puede respetarse.`,
  questions:[
    {id:"P11_q1", type:"mcq", marks:2,
      prompt:"1) ¬øPor qu√© se reorganiz√≥ el departamento de lenguas?",
      options:[
        "Porque quer√≠an hacerlo m√°s divertido",
        "Porque hab√≠a quejas sobre claridad, severidad e imprevisibilidad",
        "Porque Luke prohibi√≥ los idiomas",
        "Porque Benjamin Nelson elimin√≥ las reglas"
      ],
      answerIndex:1
    },
    {id:"P11_q2", type:"tfnm", marks:2,
      prompt:"2) Red decidi√≥ bajar el nivel para evitar quejas. (Verdadero / Falso / No mencionado)",
      correct:"Falso"
    },
    {id:"P11_q3", type:"pn", marks:2,
      prompt:"3) Las quejas se presentan como‚Ä¶ (P / N / P+N)",
      correct:"P+N"
    },
    {id:"P11_q4", type:"syn", marks:3,
      prompt:"4) Encuentra en el texto una palabra que significa ¬´claro / f√°cil de entender¬ª.",
      acceptable:["comprensible","claro"]
    },
    {id:"P11_q5", type:"match", marks:3,
      prompt:"5) En el texto, ¬øqu√© palabra significa ¬´ser digno de confianza¬ª?",
      acceptable:["respetarse","coherente"]
    },
    {id:"P11_q6", type:"short", marks:4,
      prompt:"6) ¬øQui√©n hace el trabajo principal sobre el contenido ling√º√≠stico y qu√© hace exactamente? (dos ideas)",
      rubric:"Shireen; revisa textos; detecta errores de sentido; comprueba que no haya trampas injustas.",
      keywords:[
        ["shireen"],
        ["revisa","revisar","textos"],
        ["errores","sentido"],
        ["trampa","injusta","honesto"]
      ]
    },
    {id:"P11_q7", type:"short", marks:4,
      prompt:"7) Explica por qu√© el sistema puede criticarse pero tambi√©n respetarse (dos ideas).",
      rubric:"Las decisiones pueden explicarse; hay transparencia; los alumnos entienden la p√©rdida de puntos; coherencia del sistema.",
      keywords:[
        ["explicar","explicarse","decision"],
        ["transparente","claridad"],
        ["entienden","pierden puntos"],
        ["coherente","coherencia"],
        ["respeto","respetar"]
      ]
    }
  ]
},

  {
    id:"P12",
    titre:"Texto P12 ‚Äî Thomas, ¬´Lenfer¬ª y la l√≥gica de la oscuridad",
    theme:"Otono Team ‚Äî Imaginaci√≥n, expresi√≥n, precisi√≥n",
    texte:`Thomas tiene una imaginaci√≥n intensa. En sus juegos, le gustan las ciudades nocturnas y los lugares oscuros, y su mundo se llama ¬´Lenfer¬ª. Cuando lo cuenta, algunos piensan que solo busca provocar. En realidad, Thomas explica que la oscuridad le ayuda a organizar sus ideas: con un decorado simple, ve mejor los detalles.

Un d√≠a, durante una preparaci√≥n, Red le pidi√≥ a Thomas que escribiera una respuesta corta, clara y estructurada. Thomas empez√≥ con una frase muy dram√°tica, como si estuviera escribiendo una escena. Luke levant√≥ la vista: para √©l, la belleza debe estar al servicio de la precisi√≥n. Shireen propuso un compromiso: conservar el estilo, pero controlar la estructura.

Thomas acept√≥. Conserv√≥ una imagen fuerte y luego a√±adi√≥ conectores y pruebas. Red not√≥ algo importante: Thomas trabaja mejor cuando tiene derecho a ser √©l mismo, siempre que respete la consigna. El verdadero desaf√≠o no es suprimir su universo, sino traducirlo en argumentos.

Al final, Thomas dijo que escribir se parece a su mundo: si pones demasiados elementos, te pierdes; si eliges bien, construyes una atm√≥sfera y una l√≥gica. Red respondi√≥ que es exactamente eso: puede existir una atm√≥sfera, pero la nota depende de la claridad.`,
    questions:[
      {id:"P12_q1", type:"mcq", marks:2,
        prompt:"1) ¬øPor qu√© Thomas dice que la oscuridad le ayuda?",
        options:[
          "Porque no le gusta estudiar",
          "Porque un decorado simple le ayuda a ver los detalles",
          "Porque quiere impedir que otros lean",
          "Porque rechaza los conectores"
        ],
        answerIndex:1
      },
      {id:"P12_q2", type:"tfnm", marks:2,
        prompt:"2) Red quiere suprimir totalmente el universo de Thomas. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P12_q3", type:"pn", marks:2,
        prompt:"3) El estilo dram√°tico de Thomas se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P12_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´compromiso¬ª (misma palabra).",
        acceptable:["compromiso"]
      },
      {id:"P12_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´atm√≥sfera¬ª (misma palabra)?",
        acceptable:["atmosfera","atm√≥sfera"]
      },
      {id:"P12_q6", type:"short", marks:6,
        prompt:"6) Explica dos ideas del ‚Äúcompromiso‚Äù propuesto a Thomas (dos ideas).",
        rubric:"Mantener estilo/imagen; controlar estructura; a√±adir conectores; a√±adir pruebas; respetar consigna.",
        keywords:[
          ["mantener","conservar","estilo","imagen"],
          ["estructura","controlar","control"],
          ["conectores"],
          ["prueba","pruebas"],
          ["consigna","respetar"]
        ]
      }
    ]
  },

  {
    id:"P13",
    titre:"Texto P13 ‚Äî Wyatt, los detalles evitables y la disciplina",
    theme:"Otono Team ‚Äî H√°bitos, reglas, eficacia",
    texte:`Wyatt es conocido por dos cosas: suele comer Doritos y odia perder puntos por un error evitable. Para √©l, lo m√°s frustrante no es una idea dif√≠cil; es un detalle simple que se podr√≠a haber evitado. Por eso sigue las reglas de presentaci√≥n con una concentraci√≥n casi mec√°nica. Dice que la disciplina no es una obsesi√≥n; es un escudo.

Cuando Red explica una penalizaci√≥n, Wyatt no discute mucho. Pregunta: ¬´¬øQu√© tengo que hacer la pr√≥xima vez?¬ª. A Luke le gusta esa actitud porque convierte la correcci√≥n en un plan de acci√≥n. Sin embargo, Wyatt no es perfecto: cuando est√° cansado, puede escribir demasiado r√°pido y una frase se vuelve menos clara. Red le recuerda que la velocidad debe seguir siendo legible, o se vuelve en su contra.

En una sesi√≥n, Wyatt vio a Joshua bromear con el ‚Äúmorado oscuro‚Äù. Se ri√≥, pero a√±adi√≥ algo serio: ¬´Haz lo que quieras, pero yo no doy puntos al azar¬ª. Red entendi√≥ que Wyatt no es duro por ser duro. Es duro porque quiere una nota que represente de verdad lo que sabe.

Al final, Wyatt resume su enfoque con una idea: si el sistema es claro, se puede ser libre dentro. Las reglas son las paredes; el argumento es la habitaci√≥n que construyes.`,
    questions:[
      {id:"P13_q1", type:"mcq", marks:2,
        prompt:"1) Para Wyatt, la disciplina sirve sobre todo para‚Ä¶",
        options:[
          "hacer feliz a Red",
          "proteger contra errores evitables",
          "impedir cualquier libertad",
          "sustituir el trabajo"
        ],
        answerIndex:1
      },
      {id:"P13_q2", type:"tfnm", marks:2,
        prompt:"2) A Wyatt le gusta perder puntos por un detalle simple. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P13_q3", type:"pn", marks:2,
        prompt:"3) Las reglas se presentan como‚Ä¶ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P13_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´escudo¬ª (misma palabra).",
        acceptable:["escudo"]
      },
      {id:"P13_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´plan¬ª (en ‚Äúplan de acci√≥n‚Äù)? (una palabra)",
        acceptable:["plan"]
      },
      {id:"P13_q6", type:"short", marks:6,
        prompt:"6) Da dos ideas que muestren que Wyatt quiere una nota ‚Äúrepresentativa‚Äù (dos ideas).",
        rubric:"Evitar errores evitables; correcci√≥n = plan de acci√≥n; no al azar; nota representa saber; claridad del sistema.",
        keywords:[
          ["error","evitable","evitables"],
          ["plan de accion","plan de acci√≥n","proxima vez","pr√≥xima vez"],
          ["azar","no doy puntos al azar","no al azar"],
          ["represent","sabe","saber"],
          ["sistema claro","claro"]
        ]
      }
    ]
  },

  {
    id:"P14",
    titre:"Texto P14 ‚Äî Karlito, Kiara y la confianza en uno mismo",
    theme:"Otono Team ‚Äî Respeto, identidad, ambiente de grupo",
    texte:`Karlito tiene una presencia particular: puede cambiar el ambiente de una sala con solo entrar. A veces tambi√©n usa el nombre Kiara, y eso sorprende a algunas personas al principio. Red ha observado que esa sorpresa puede crear dos reacciones: curiosidad respetuosa o juicio r√°pido. En el Otono Team, Red insiste en una regla simple: se respeta a las personas antes de comentar sus elecciones.

En una sesi√≥n, Karlito lleg√≥ con una energ√≠a tranquila. Pidi√≥ algo muy concreto: ¬´Corr√≠geme el contenido, no lo dem√°s¬ª. Luke lo entendi√≥ enseguida: la copia debe ser un espacio neutro, donde la calidad del idioma importe m√°s que el miedo a la mirada de otros. Shireen a√±adi√≥ que la confianza tambi√©n se construye con detalles: una observaci√≥n clara, un tono estable y criterios id√©nticos.

Sin embargo, Karlito admiti√≥ que no siempre se siente c√≥modo. Cuando uno se siente observado, escribe con menos libertad. Red respondi√≥ que precisamente por eso las reglas deben ser coherentes: protegen al alumno de comentarios in√∫tiles. La copia se convierte entonces en una prueba de competencia, no en un objeto de juicio social.

Al final, Karlito dijo una frase simple: ¬´Cuando me siento respetado, escribo mejor¬ª. Red anot√≥ esa idea porque conecta el respeto con el rendimiento: no como una excusa, sino como una condici√≥n para hacer el trabajo de verdad.`,
    questions:[
      {id:"P14_q1", type:"mcq", marks:2,
        prompt:"1) ¬øQu√© regla recuerda Red en este texto?",
        options:[
          "Hay que comentarlo todo",
          "Se respeta a las personas antes de comentar sus elecciones",
          "Se proh√≠ben las sesiones de repaso",
          "Se eliminan los criterios"
        ],
        answerIndex:1
      },
      {id:"P14_q2", type:"tfnm", marks:2,
        prompt:"2) Karlito pide que se le corrija el contenido. (Verdadero / Falso / No se menciona)",
        correct:"Verdadero"
      },
      {id:"P14_q3", type:"pn", marks:2,
        prompt:"3) La coherencia de las reglas se presenta como‚Ä¶ (P / N / P+N)",
        correct:"P"
      },
      {id:"P14_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´juicio¬ª (misma palabra).",
        acceptable:["juicio"]
      },
      {id:"P14_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´criterios¬ª (misma palabra)?",
        acceptable:["criterios"]
      },
      {id:"P14_q6", type:"short", marks:6,
        prompt:"6) Explica dos razones por las que unas reglas coherentes pueden ‚Äúproteger‚Äù a un alumno, seg√∫n el texto.",
        rubric:"Contra comentarios in√∫tiles; espacio neutro; criterios id√©nticos; prueba de competencia; menos miedo.",
        keywords:[
          ["comentarios inutiles","comentarios","inutil","in√∫til"],
          ["espacio neutro","neutro"],
          ["criterios identicos","criterios id√©nticos","identicos","id√©nticos"],
          ["prueba","competencia"],
          ["miedo","observado","observada","mirada"]
        ]
      }
    ]
  },

  {
    id:"P15",
    titre:"Texto P15 ‚Äî Angus Drummond y el odio a las aproximaciones",
    theme:"El Drummond Tinta-Cre√≠ble ‚Äî Coherencia, pruebas, revisiones",
    texte:`Angus Drummond no teme una mala nota. Lo que odia es una nota borrosa. Para √©l, una correcci√≥n debe ser una demostraci√≥n: cada punto debe tener una raz√≥n visible. Cuando Red habla de ‚Äúrevisi√≥n‚Äù, Angus no lo ve como una oportunidad de ganar puntos; lo ve como una oportunidad de hacer coherente la decisi√≥n.

Un d√≠a, Angus le pidi√≥ a Red que mostrara la prueba de dos puntos. Red acept√≥, pero puso una condici√≥n: ¬´Si yo justifico, t√∫ aceptas el resultado¬ª. Angus dijo que s√≠. A Luke le pareci√≥ l√≥gico: es un contrato de claridad. Clayton, en cambio, lo ve√≠a demasiado fr√≠o; preferir√≠a una correcci√≥n m√°s ‚Äúamable‚Äù. Pero Angus considera que la amabilidad sin exactitud es una traici√≥n.

Durante la relectura, Red mostr√≥ los criterios, la consigna y luego las frases exactas de la copia. Angus aprob√≥ cuando todo era s√≥lido e insisti√≥ cuando era fr√°gil. Al final, la nota apenas cambi√≥, pero la discusi√≥n cambi√≥ todo lo dem√°s: elimin√≥ la duda. Red concluy√≥ que a veces ese es el mejor uso de una revisi√≥n: no modificar la nota, sino hacerla imposible de discutir.

Despu√©s, Angus dijo que seguir√≠a escribiendo solo con tinta negra. No por obsesi√≥n, sino porque quiere que la copia se parezca a lo que respeta: una prueba n√≠tida.`,
    questions:[
      {id:"P15_q1", type:"mcq", marks:2,
        prompt:"1) ¬øQu√© es lo que m√°s odia Angus?",
        options:[
          "Una nota borrosa",
          "Una copia corta",
          "Una revisi√≥n",
          "Una regla clara"
        ],
        answerIndex:0
      },
      {id:"P15_q2", type:"tfnm", marks:2,
        prompt:"2) Angus ve la revisi√≥n como un regalo para ganar puntos. (Verdadero / Falso / No se menciona)",
        correct:"Falso"
      },
      {id:"P15_q3", type:"pn", marks:2,
        prompt:"3) La ‚Äúamabilidad sin exactitud‚Äù se presenta como‚Ä¶ (P / N / P+N)",
        correct:"N"
      },
      {id:"P15_q4", type:"syn", marks:4,
        prompt:"4) Encuentra en el texto una palabra que signifique ¬´demostraci√≥n¬ª (misma palabra).",
        acceptable:["demostracion","demostraci√≥n"]
      },
      {id:"P15_q5", type:"match", marks:4,
        prompt:"5) En el texto, ¬øqu√© palabra significa ¬´duda¬ª (misma palabra)?",
        acceptable:["duda"]
      },
      {id:"P15_q6", type:"short", marks:6,
        prompt:"6) Da dos razones por las que la revisi√≥n es √∫til, seg√∫n este texto.",
        rubric:"Hacer coherente la decisi√≥n; mostrar pruebas/criterios; eliminar la duda; hacer la nota dif√≠cil de discutir; aclarar.",
        keywords:[
          ["coherente","coherencia"],
          ["prueba","pruebas","criterios","consigna"],
          ["eliminar","duda"],
          ["imposible de discutir","discutir"],
          ["aclarar","clara","claridad"]
        ]
      }
    ]
  }
];


/* =========================================================
   MINI-ENSAYOS (~90 palabras)
   - 20 puntos
   - El texto es largo (como los dem√°s), pero la respuesta esperada es corta.
========================================================= */

const ESSAYS = [
  {
    id:"E_P1",
    passageId:"P1",
    titre:"Mini-ensayo ‚Äî ¬øLos sobres morados: √∫til o estresante?",
    passage:`Algunas personas creen que el sobre morado es una idea brillante: hace transparente la correcci√≥n y permite entender los errores. Otras dicen que aumenta la presi√≥n, porque la copia original parece un juicio. Sin embargo, Red insiste en una cosa: se aprende mejor cuando se acepta lo que est√° escrito y luego se decide qu√© se va a mejorar.`,
    consigne:`Escribe unas 90 palabras. ¬øEn qu√© medida el sobre morado ayuda al aprendizaje? Da un argumento ‚Äúa favor‚Äù, uno ‚Äúen contra‚Äù y una conclusi√≥n breve.`,
    structureAnchors:[
      ["para empezar","primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["en conclusion","en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    ideaGroups:[
      ["transparente","transparencia","prueba","verificable","trazabilidad"],
      ["presion","presi√≥n","estresante","estr√©s","juicio"],
      ["aprender","entender","errores","mejorar","mejora"],
      ["a favor","util","√∫til","ayuda","ayudar"],
      ["en contra","inconveniente","fatiga"]
    ],
    connectors:[
      ["primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["por lo tanto","as√≠ que","por consiguiente"],
      ["en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    modelAnswer:
`Primero, el sobre morado ayuda porque hace la correcci√≥n transparente: se ve el detalle y se entienden los errores. Eso da una prueba clara y evita discusiones. Sin embargo, tambi√©n puede aumentar la presi√≥n: la copia original se siente como un juicio y algunos se bloquean. En conclusi√≥n, ayuda en la medida en que el candidato acepta la copia como un punto de partida: observa, aprende y luego mejora para la pr√≥xima vez.`
  },

  {
    id:"E_P2",
    passageId:"P2",
    titre:"Mini-ensayo ‚Äî La regla de la tinta negra: ¬øjusta o demasiado estricta?",
    passage:`En el Otono Team, la tinta negra es obligatoria. Red justifica la regla por la legibilidad y la igualdad de condiciones. Sin embargo, una regla estricta puede frustrar: se pueden perder puntos aunque la idea sea buena. As√≠ que la cuesti√≥n es si la regla protege el resultado‚Ä¶ o si aplasta innecesariamente al candidato.`,
    consigne:`Escribe unas 90 palabras. ¬øLa regla es sobre todo positiva? Ap√≥yate en el texto y termina con una conclusi√≥n clara.`,
    structureAnchors:[
      ["para empezar","primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["en conclusion","en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    ideaGroups:[
      ["legibilidad","claro","claridad"],
      ["igualdad","condiciones identicas","condiciones id√©nticas","justicia"],
      ["penalizacion","penalizaci√≥n","quitar","puntos"],
      ["frustrante","frustracion","frustraci√≥n","demasiado estricta","rigida","r√≠gida"],
      ["valor del resultado","proteger","protege"]
    ],
    connectors:[
      ["primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["por lo tanto","as√≠ que","por consiguiente"],
      ["en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    modelAnswer:
`Primero, la regla de la tinta negra es positiva porque protege la legibilidad y la igualdad de condiciones: todos son evaluados del mismo modo. Eso refuerza la confianza en el resultado. Sin embargo, puede parecer demasiado estricta, porque una penalizaci√≥n puede quitar puntos aunque la idea sea buena. En conclusi√≥n, la regla es √∫til si es proporcional: debe proteger el valor del resultado sin aplastar innecesariamente al candidato.`
  },

  {
    id:"E_P4",
    passageId:"P4",
    titre:"Mini-ensayo ‚Äî Comparar notas: ¬ømotivaci√≥n o trampa?",
    passage:`Despu√©s de los resultados, algunos comparan sus puntuaciones. Eso puede dar un referente, pero tambi√©n puede convertir el progreso en una competici√≥n permanente. Red insiste: una nota no es una identidad, es un resultado en un momento dado. El objetivo deber√≠a ser aprender, no medirse sin fin.`,
    consigne:`Escribe unas 90 palabras. ¬øComparar ayuda de verdad? Da una respuesta matizada.`,
    structureAnchors:[
      ["para empezar","primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["en conclusion","en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    ideaGroups:[
      ["referente","punto de referencia","entender","aclarar"],
      ["competicion","competici√≥n","permanente","presion","presi√≥n"],
      ["progreso","progresion","progresi√≥n"],
      ["identidad","resultado"],
      ["matizada","en cierta medida","equilibrio"]
    ],
    connectors:[
      ["primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["por lo tanto","as√≠ que","por consiguiente"],
      ["en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    modelAnswer:
`Primero, comparar notas puede ayudar: da un referente y puede aclarar si un m√©todo funciona. Sin embargo, se convierte r√°pido en una trampa: transforma el progreso en competici√≥n y aumenta la presi√≥n. Entonces se olvida que la nota no es una identidad, sino un resultado en un momento. En conclusi√≥n, comparar sirve solo en cierta medida: lo m√°s √∫til es analizar la propia copia y buscar el progreso.`
  },

  {
    id:"E_P9",
    passageId:"P9",
    titre:"Mini-ensayo ‚Äî Velocidad y calidad: ¬øOWing tiene raz√≥n?",
    passage:`OWing trabaja r√°pido y va directo al grano. Red admira esa energ√≠a, pero recuerda que la velocidad puede crear la ilusi√≥n de dominar. Cuando aparece un matiz en la consigna, hay que frenar, releer y justificar.`,
    consigne:`Escribe unas 90 palabras. ¬øLa velocidad es una ventaja en una prueba? Da un argumento ‚Äúa favor‚Äù, uno ‚Äúen contra‚Äù y una conclusi√≥n breve.`,
    structureAnchors:[
      ["para empezar","primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["en conclusion","en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    ideaGroups:[
      ["velocidad","rapido","r√°pido","eficiente","ganar tiempo"],
      ["ilusion","ilusi√≥n","dominar","comprender","entiendes"],
      ["matiz","consigna","releer","reley√≥","releyo"],
      ["justificar","pruebas","precision","precisi√≥n"],
      ["equilibrio","control"]
    ],
    connectors:[
      ["primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["por lo tanto","as√≠ que","por consiguiente"],
      ["en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    modelAnswer:
`Primero, la velocidad puede ser una ventaja: se gana tiempo y se responde con m√°s eficacia, como OWing. Eso tambi√©n evita quedarse bloqueado. Sin embargo, la velocidad puede crear una ilusi√≥n de dominio: si aparece un matiz en la consigna, hay que releer y justificar, o baja la precisi√≥n. En conclusi√≥n, la velocidad es √∫til solo con control: se puede ir r√°pido, pero hay que frenar en los detalles para mantener la calidad.`
  },

  {
    id:"E_P10",
    passageId:"P10",
    titre:"Mini-ensayo ‚Äî El humor de Joshua: ¬øayuda o distrae?",
    passage:`Joshua bromea con su ‚Äúmorad√≠simo oscuro‚Äù, pero al final respeta la regla. Red acepta el humor siempre que la copia sea clara y no se pierda el objetivo.`,
    consigne:`Escribe unas 90 palabras. ¬øEn qu√© medida el humor puede mejorar una sesi√≥n de estudio?`,
    structureAnchors:[
      ["para empezar","primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["en conclusion","en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    ideaGroups:[
      ["humor","broma","reir","re√≠r","relajar"],
      ["tension","tensi√≥n","estres","estr√©s","respirar"],
      ["distraer","distrae","perder el objetivo"],
      ["regla","respeta","respetar","copia clara"],
      ["equilibrio","en cierta medida"]
    ],
    connectors:[
      ["primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["por lo tanto","as√≠ que","por consiguiente"],
      ["en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    modelAnswer:
`Primero, el humor puede ayudar: una broma como la de Joshua relaja el ambiente y evita que el estr√©s se convierta en discusi√≥n. As√≠ se respira mejor y se vuelve a empezar con m√°s energ√≠a. Sin embargo, el humor tambi√©n puede distraer: si se pierde el objetivo, la sesi√≥n se vuelve ruido. En conclusi√≥n, es positivo en la medida en que se respete la regla y la copia siga siendo clara: es una herramienta, no un sustituto del trabajo.`
  },

  {
    id:"E_P11",
    passageId:"P11",
    titre:"Mini-ensayo ‚Äî Estilo y claridad: ¬øse puede conservar el universo de Thomas?",
    passage:`Thomas escribe con un estilo dram√°tico y un universo oscuro. Shireen propone conservar la imagen, pero controlar la estructura y a√±adir pruebas.`,
    consigne:`Escribe unas 90 palabras. ¬øHay que priorizar el estilo o la claridad en una prueba?`,
    structureAnchors:[
      ["para empezar","primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["en conclusion","en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    ideaGroups:[
      ["estilo","imagen","atmosfera","atm√≥sfera"],
      ["precision","precisi√≥n","claridad","claro"],
      ["estructura","conectores","pruebas"],
      ["consigna","respetar"],
      ["compromiso","equilibrio"]
    ],
    connectors:[
      ["primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["por lo tanto","as√≠ que","por consiguiente"],
      ["en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    modelAnswer:
`Primero, el estilo puede ser una ventaja: una imagen fuerte hace el texto m√°s vivo y puede expresar mejor una idea, como en Thomas. Sin embargo, en una prueba la nota depende sobre todo de la claridad: sin estructura, conectores y pruebas, el estilo se vuelve confusi√≥n. En conclusi√≥n, hace falta un compromiso: conservar un toque personal, pero controlar la estructura y respetar la consigna. El estilo debe servir a la precisi√≥n, no reemplazarla.`
  },

  {
    id:"E_P12",
    passageId:"P12",
    titre:"Mini-ensayo ‚Äî Reglas como ‚Äúescudo‚Äù: la visi√≥n de Wyatt",
    passage:`Wyatt sigue las reglas porque odia perder puntos por un detalle evitable. Para √©l, la disciplina protege la nota y convierte la correcci√≥n en un plan de acci√≥n.`,
    consigne:`Escribe unas 90 palabras. ¬øLas reglas estrictas hacen la evaluaci√≥n m√°s justa?`,
    structureAnchors:[
      ["para empezar","primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["en conclusion","en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    ideaGroups:[
      ["justa","justicia","igualdad"],
      ["detalles evitables","detalle evitable","penalizacion","penalizaci√≥n"],
      ["disciplina","escudo"],
      ["libertad","dentro","dentro del marco"],
      ["limites","l√≠mite","demasiado estricta","cansar","cansancio"]
    ],
    connectors:[
      ["primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["por lo tanto","as√≠ que","por consiguiente"],
      ["en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    modelAnswer:
`Primero, unas reglas estrictas pueden hacer la evaluaci√≥n m√°s justa: crean condiciones id√©nticas y evitan detalles evitables que distorsionan la nota. Para Wyatt, la disciplina es un escudo. Sin embargo, demasiada rigidez puede cansar y penalizar incluso cuando la idea es buena. En conclusi√≥n, las reglas son √∫tiles si son proporcionales: deben proteger la justicia sin aplastar la libertad de argumentar dentro del marco.`
  },

  {
    id:"E_P13",
    passageId:"P13",
    titre:"Mini-ensayo ‚Äî Revisar para cambiar la nota‚Ä¶ o para eliminar la duda",
    passage:`Angus Drummond quiere una correcci√≥n demostrable: pruebas, criterios y consigna. Red muestra que una revisi√≥n a veces sirve m√°s para hacer coherente la decisi√≥n y eliminar la duda que para subir la nota.`,
    consigne:`Escribe unas 90 palabras. ¬øCu√°l es, para ti, el mejor objetivo de una revisi√≥n?`,
    structureAnchors:[
      ["para empezar","primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["en conclusion","en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    ideaGroups:[
      ["pruebas","criterios","consigna"],
      ["coherente","coherencia","claro","claridad"],
      ["duda","discutir","imposible de discutir"],
      ["cambiar la nota","modificar la nota","subir la nota"],
      ["objetivo","util","√∫til"]
    ],
    connectors:[
      ["primero","en primer lugar"],
      ["sin embargo","no obstante","en cambio","por otro lado"],
      ["por lo tanto","as√≠ que","por consiguiente"],
      ["en conclusi√≥n","para concluir","finalmente","en resumen"]
    ],
    modelAnswer:
`Primero, una revisi√≥n puede servir para cambiar la nota si se demuestra un error; as√≠ se protege al candidato. Sin embargo, el mejor objetivo suele ser eliminar la duda: mostrar criterios, consigna y pruebas hace la decisi√≥n coherente y clara. Aunque la nota cambie poco, aumenta la confianza. En conclusi√≥n, una revisi√≥n √∫til no es siempre la que ‚Äúda puntos‚Äù, sino la que hace la nota demostrable y dif√≠cil de discutir.`
  }
];

/* =========================================================
   TRADUCCIONES (EN -> ES): Otono Team / El Drummond Tinta-Cre√≠ble
   20 puntos: 5 ideas-clave √ó 4
========================================================= */

const TRANSLATIONS_A = [
  {
    id:"T1",
    titre:"Traducci√≥n ‚Äî La revisi√≥n",
    theme:"El Drummond Tinta-Cre√≠ble",
    textEN:"During a remark, Red reads the paper again and explains every point. He says it is not a gift but a serious second reading. If he cannot justify a mark, he does not give it.",
    keyBundles:[
      ["durante una revision","durante una revisi√≥n","en una revision","en una revisi√≥n"],
      ["lee de nuevo","vuelve a leer","relee","rele√©","relee la copia","relee el examen","relee el texto"],
      ["explica","justifica","justificar","prueba","pruebas"],
      ["no es un regalo","no se trata de un regalo"],
      ["si no puede justificar","no lo da","no da el punto","no concede el punto"]
    ],
    sampleFR:"Durante una revisi√≥n, Red vuelve a leer la copia y explica cada punto. Dice que no es un regalo, sino una segunda lectura seria. Si no puede justificar un punto, no lo da."
  },
  {
    id:"T2",
    titre:"Traducci√≥n ‚Äî Sobre morado y transparencia",
    theme:"El Drummond Tinta-Cre√≠ble",
    textEN:"The purple envelope contains a detailed results sheet and the original paper. Candidates can look at it, but they cannot change it. If there is a penalty, Red writes the original score and the penalized score.",
    keyBundles:[
      ["sobre morado","sobres morados"],
      ["hoja de resultados","resultados detallados","hoja detallada"],
      ["copia original","original"],
      ["pueden mirarla","pueden consultarla","pero no pueden modificarla","no pueden cambiarla"],
      ["penalizacion","penalizaci√≥n","puntuacion original","puntuaci√≥n original","puntuacion con penalizacion","puntuaci√≥n con penalizaci√≥n"]
    ],
    sampleFR:"El sobre morado contiene una hoja de resultados detallada y la copia original. Los candidatos pueden consultarla, pero no pueden modificarla. Si hay una penalizaci√≥n, Red escribe la puntuaci√≥n original y la puntuaci√≥n con penalizaci√≥n."
  },
  {
    id:"T3",
    titre:"Traducci√≥n ‚Äî Comparaci√≥n",
    theme:"Otono Team",
    textEN:"Some people compare their scores to feel safer. But comparison can become a trap and turn progress into permanent competition. Red reminds everyone that a grade is not an identity.",
    keyBundles:[
      ["algunas personas","alguien","algunas"],
      ["comparan","comparacion","comparaci√≥n","comparar sus puntuaciones","comparar sus notas"],
      ["para sentirse","sentirse mas seguro","sentirse m√°s seguro"],
      ["trampa","competicion permanente","competici√≥n permanente","progreso"],
      ["una nota no es una identidad","no es una identidad","no es identidad"]
    ],
    sampleFR:"Algunas personas comparan sus notas para sentirse m√°s seguras. Pero la comparaci√≥n puede convertirse en una trampa y transformar el progreso en una competici√≥n permanente. Red recuerda que una nota no es una identidad."
  },
  {
    id:"T4",
    titre:"Traducci√≥n ‚Äî OWing y la velocidad",
    theme:"Otono Team",
    textEN:"OWing works fast and goes straight to the point. Red admires his energy, but he warns that speed can create the illusion of mastery. When a nuance appears in the instruction, OWing stops, rereads, and corrects his approach.",
    keyBundles:[
      ["owing trabaja rapido","owing trabaja r√°pido","owing va rapido","owing va r√°pido"],
      ["va directo al grano","va al punto","directo"],
      ["red admira","red aprecia","red admira su energia","red admira su energ√≠a"],
      ["ilusion de dominar","ilusi√≥n de dominar","ilusion de maestria","ilusi√≥n de maestr√≠a","ilusion de dominio","ilusi√≥n de dominio"],
      ["matiz","consigna","se detiene","relee","vuelve a leer","corrige su enfoque"]
    ],
    sampleFR:"OWing trabaja r√°pido y va directo al grano. Red admira su energ√≠a, pero advierte que la velocidad puede crear la ilusi√≥n de dominar. Cuando aparece un matiz en la consigna, OWing se detiene, relee y corrige su enfoque."
  },
  {
    id:"T5",
    titre:"Traducci√≥n ‚Äî El morado oscuro de Joshua",
    theme:"Otono Team",
    textEN:"Joshua jokes that he does not use black ink but a very, very, very, very, very dark purple. Red asks him calmly whether he wants a joke or a mark. In the end, Joshua uses a real black pen, and the atmosphere becomes less tense.",
    keyBundles:[
      ["joshua bromea","joshua hace una broma","joshua dice en broma"],
      ["tinta negra","boligrafo negro","bol√≠grafo negro"],
      ["muy muy muy muy muy morado oscuro","morad√≠simo oscuro","morado muy oscuro"],
      ["quieres una broma o un punto","con calma"],
      ["al final","finalmente","usa un bol√≠grafo negro de verdad","el ambiente se vuelve menos tenso","la atmosfera se vuelve menos tensa","la atm√≥sfera se vuelve menos tensa"]
    ],
    sampleFR:"Joshua bromea diciendo que no usa tinta negra, sino un morad√≠simo oscuro. Red le pregunta con calma si quiere una broma o un punto. Al final, Joshua usa un bol√≠grafo negro de verdad y el ambiente se vuelve menos tenso."
  },
  {
    id:"T6",
    titre:"Traducci√≥n ‚Äî Thomas y la claridad",
    theme:"Otono Team",
    textEN:"Thomas writes with dramatic images, but the exam still requires clarity. Shireen suggests keeping the style while controlling the structure and adding evidence. Red concludes that a personal universe is allowed if the instruction is respected.",
    keyBundles:[
      ["thomas escribe","imagenes dramaticas","im√°genes dram√°ticas","estilo dram√°tico"],
      ["el examen exige","la prueba exige","claridad"],
      ["mantener el estilo","conservar el estilo","controlar la estructura"],
      ["anadir pruebas","a√±adir pruebas","prueba","pruebas"],
      ["universo personal","esta permitido","est√° permitido","si se respeta la consigna","si la consigna se respeta"]
    ],
    sampleFR:"Thomas escribe con im√°genes dram√°ticas, pero el examen exige claridad. Shireen propone mantener el estilo mientras se controla la estructura y se a√±aden pruebas. Red concluye que un universo personal est√° permitido si se respeta la consigna."
  },
  {
    id:"T7",
    titre:"Traducci√≥n ‚Äî Wyatt y los detalles evitables",
    theme:"Otono Team",
    textEN:"Wyatt hates losing marks for avoidable details. For him, discipline is a shield and the correction should become an action plan. Red reminds him that writing too fast can reduce clarity.",
    keyBundles:[
      ["wyatt odia","detesta"],
      ["perder puntos","perder notas","por detalles evitables","detalle evitable","detalles evitables"],
      ["disciplina","es un escudo","escudo"],
      ["plan de accion","plan de acci√≥n"],
      ["escribir demasiado rapido","escribir demasiado r√°pido","reduce la claridad","menos claro","claridad"]
    ],
    sampleFR:"Wyatt odia perder puntos por detalles evitables. Para √©l, la disciplina es un escudo y la correcci√≥n debe convertirse en un plan de acci√≥n. Red le recuerda que escribir demasiado r√°pido puede reducir la claridad."
  },
  {
    id:"T8",
    titre:"Traducci√≥n ‚Äî Angus Drummond y la prueba",
    theme:"El Drummond Tinta-Cre√≠ble",
    textEN:"Angus Drummond does not fear a low grade; he fears an unclear one. He wants every mark to be demonstrable with criteria and evidence. Red shows that a remark is sometimes useful not to change the score, but to remove doubt and make the decision coherent.",
    keyBundles:[
      ["angus drummond","angus"],
      ["no teme una mala nota","no tiene miedo de una mala nota","teme una nota borrosa","teme una nota poco clara"],
      ["demostrable","criterios","pruebas","prueba"],
      ["revision","revisi√≥n","util","√∫til"],
      ["no para cambiar la nota","sino para eliminar la duda","quitar la duda","hacer coherente la decision","hacer coherente la decisi√≥n"]
    ],
    sampleFR:"Angus Drummond no teme una mala nota; teme una nota borrosa. Quiere que cada punto sea demostrable con criterios y pruebas. Red muestra que una revisi√≥n a veces es √∫til no para cambiar la nota, sino para eliminar la duda y hacer coherente la decisi√≥n."
  }
];

/* =========================================================
   UTILIDADES
========================================================= */
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));

function nowISO(){ return new Date().toISOString(); }

function norm(s){
  return (s ?? "")
    .toString()
    .toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-z0-9\s]/g," ")
    .replace(/\s+/g," ")
    .trim();
}
function countWords(s){
  const t = (s ?? "").toString().trim();
  if(!t) return 0;
  return t.split(/\s+/).filter(Boolean).length;
}
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}
function pickRandom(arr, n){ return shuffle(arr).slice(0,n); }
function escapeHtml(str){
  return (str ?? "").toString()
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#039;");
}

/* Otono grading (sin cambios) */
function otonoLetterGrade(score){
  if(score >= 101) return "S";
  if(score >= 95) return "A*";
  if(score >= 90) return "A";
  if(score >= 80) return "B";
  if(score >= 70) return "C";
  if(score >= 66) return "D";
  if(score >= 55) return "E";
  if(score >= 45) return "F";
  if(score >= 30) return "G";
  if(score >= 15) return "H";
  return "U";
}
function passMeritDistinction(score){
  if(score >= 90) return "DISTINCTION";
  if(score >= 80) return "MERIT";
  if(score >= 66) return "PASS";
  return "FAIL";
}
function gcseEstimate(score){
  if(score >= 90) return 9;
  if(score >= 80) return 8;
  if(score >= 70) return 7;
  if(score >= 60) return 6;
  if(score >= 50) return 5;
  if(score >= 40) return 4;
  if(score >= 30) return 3;
  if(score >= 20) return 2;
  if(score >= 10) return 1;
  return "U";
}
function badgeForScore(score){
  if(score >= 90) return ["badge good","üèÜ Excelente"];
  if(score >= 80) return ["badge good","‚≠ê Muy bien"];
  if(score >= 66) return ["badge warn","‚úÖ Ok"];
  return ["badge bad","‚ùå Malo"];
}

/* =========================================================
   ALMACENAMIENTO LOCAL
========================================================= */
const STORE_KEY = "otonoSpanish_AlevelReadingDrummond_results_v2";
function loadResults(){
  try{ return JSON.parse(localStorage.getItem(STORE_KEY) || "[]"); }
  catch(e){ return []; }
}
function saveResults(list){ localStorage.setItem(STORE_KEY, JSON.stringify(list)); }
function addResult(attempt){
  const list = loadResults();
  list.unshift(attempt);
  saveResults(list);
}

/* =========================================================
   ESTADO
========================================================= */
let state = {
  mode: "home",
  timer: null,
  remainingSec: 0,
  startedAt: null,

  centreNo: "50749",
  candidateNo: null,
  candSurname: "",
  candForenames: "",

  selection: null,         // { passages:[...], essay:{...}, translation:{...} }
  answers: {},             // qid -> string
  choiceCorrectValue: {},  // qid -> correct index after shuffle
  submitted: false
};

/* =========================================================
   CENTRO
========================================================= */
function setCentre(no){
  state.centreNo = String(no);
  $("#centreNo").value = state.centreNo;
  $("#centreTop").textContent = state.centreNo;
}
$("#btnEditCentre").addEventListener("click", () => {
  const val = prompt("Introduce el n√∫mero de centro (solo cifras):", state.centreNo);
  if(val === null) return;
  const clean = String(val).replace(/\D/g,"").slice(0,10);
  if(clean.length < 3){
    alert("El n√∫mero de centro debe tener al menos 3 cifras.");
    return;
  }
  setCentre(clean);
});
$("#btnResetCentre").addEventListener("click", () => setCentre("50749"));

/* =========================================================
   N√öMERO DE CANDIDATO (4 casillas)
========================================================= */
const digitIds = ["#candD1","#candD2","#candD3","#candD4"];
function focusDigit(i){ const el = $(digitIds[i]); if(el) el.focus(); }
function getCandidateNoFromSquares(){
  const d = digitIds.map(id => ($(id).value || "").trim());
  if(d.some(x => x.length !== 1 || !/^\d$/.test(x))) return "";
  return d.join("");
}
(function wireDigitSquares(){
  digitIds.forEach((id, idx) => {
    const el = $(id);
    el.addEventListener("input", () => {
      el.value = (el.value || "").replace(/\D/g,"").slice(0,1);
      if(el.value && idx < 3) focusDigit(idx+1);
    });
    el.addEventListener("keydown", (e) => {
      if(e.key === "Backspace" && !el.value && idx > 0){ focusDigit(idx-1); }
      if(e.key === "ArrowLeft" && idx > 0){ e.preventDefault(); focusDigit(idx-1); }
      if(e.key === "ArrowRight" && idx < 3){ e.preventDefault(); focusDigit(idx+1); }
    });
    el.addEventListener("paste", (e) => {
      e.preventDefault();
      const txt = (e.clipboardData || window.clipboardData).getData("text") || "";
      const digits = txt.replace(/\D/g,"").slice(0,4).split("");
      digits.forEach((ch, j) => { const t = $(digitIds[j]); if(t) t.value = ch; });
      const joined = getCandidateNoFromSquares();
      if(joined.length === 4) focusDigit(3);
      else{
        const firstEmpty = digitIds.findIndex(did => !$(did).value);
        if(firstEmpty >= 0) focusDigit(firstEmpty);
      }
    });
  });
})();

/* =========================================================
   GENERACI√ìN DE LA PRUEBA
========================================================= */
function generateSelection(){
  const passages = pickRandom(PASSAGES_A, 3);

  // Elegir un mini-ensayo que corresponda a uno de los textos seleccionados
  const eligibleEssays = ESSAYS.filter(e => passages.some(p => p.id === e.passageId));
  const essay = (eligibleEssays.length ? pickRandom(eligibleEssays,1)[0] : pickRandom(ESSAYS,1)[0]);

  const translation = pickRandom(TRANSLATIONS_A, 1)[0];
  return { passages, essay, translation };
}
function selectionSummary(sel){
  const p = sel.passages.map(x=>x.id).join(", ");
  return `Textos: ${p} ‚Ä¢ Mini-ensayo: ${sel.essay.id} ‚Ä¢ Traducci√≥n: ${sel.translation.id}`;
}

/* =========================================================
   NAVEGACI√ìN / RENDER
========================================================= */
function setBadge(text, cls="badge"){
  const b = $("#statusBadge");
  b.className = cls;
  b.textContent = text;
}
function stopTimer(){
  if(state.timer){ clearInterval(state.timer); state.timer = null; }
}
function startTimer(minutes){
  stopTimer();
  state.remainingSec = Math.max(1, Math.floor(minutes*60));
  state.startedAt = Date.now();

  const tick = () => {
    if(state.submitted) return;
    const m = Math.floor(state.remainingSec/60);
    const s = state.remainingSec%60;
    $("#timerText").textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    state.remainingSec--;
    if(state.remainingSec < 0){
      stopTimer();
      const auto = $("#autoSubmit").value === "yes";
      if(auto) submitPaper(true);
      else alert("Tiempo terminado. A√∫n puedes enviar manualmente.");
    }
  };
  tick();
  state.timer = setInterval(tick, 1000);
}

function renderHome(){
  $("#homeBody").classList.remove("hide");
  $("#testBody").classList.add("hide");
  $("#resultsBody").classList.add("hide");
  $("#sideTitle").textContent = "Calificaci√≥n Otono";
  $("#sideMeta").textContent = "Puntuaci√≥n ‚Üí nota Otono + estimaci√≥n GCSE + Pass/Merit/Distinction.";
  $("#sideBody").classList.remove("hide");
  setBadge("Listo","badge");
  $("#timerText").textContent = "--:--";
}
function renderResults(){
  $("#homeBody").classList.add("hide");
  $("#testBody").classList.add("hide");
  $("#sideBody").classList.add("hide");
  $("#resultsBody").classList.remove("hide");
  $("#sideTitle").textContent = "Resultados guardados";
  $("#sideMeta").textContent = "Guardados en este navegador (localStorage).";
  setBadge("Resultados","badge");
  $("#timerText").textContent = "--:--";
  drawResults();
}
function renderTest(){
  $("#homeBody").classList.add("hide");
  $("#testBody").classList.remove("hide");
  $("#resultsBody").classList.add("hide");
  $("#sideBody").classList.remove("hide");

  const candNameLine = [
    state.candSurname ? state.candSurname : "",
    state.candForenames ? state.candForenames : ""
  ].filter(Boolean).join(", ");

  const cand = `${state.candidateNo}${candNameLine ? " ‚Ä¢ " + candNameLine : ""}`;
  $("#kpiCandidate").textContent = cand;
  $("#kpiPassages").textContent = state.selection.passages.map(p=>p.id).join(" ");
  $("#kpiEssay").textContent = state.selection.essay.id;

  $("#paper").innerHTML = "";
  state.choiceCorrectValue = {};

  const shuffleMode = $("#shuffleMode").value;

  const head = document.createElement("div");
  head.className = "note";
  head.innerHTML =
    `<strong>Contenido seleccionado</strong><br/>` +
    state.selection.passages.map(p => `‚Ä¢ ${escapeHtml(p.titre)} (${escapeHtml(p.id)})`).join("<br/>") +
    `<br/>‚Ä¢ ${escapeHtml(state.selection.essay.titre)} (${escapeHtml(state.selection.essay.id)})` +
    `<br/>‚Ä¢ ${escapeHtml(state.selection.translation.titre)} (${escapeHtml(state.selection.translation.id)})`;
  $("#paper").appendChild(head);

  // Textos
  state.selection.passages.forEach(p => {
    const block = document.createElement("div");
    block.className = "card";
    block.style.marginTop = "14px";
    block.innerHTML = `
      <div class="hd">
        <div>
          <h2>${escapeHtml(p.titre)}</h2>
          <div class="meta">${escapeHtml(p.theme)} ‚Ä¢ <strong>20 puntos</strong></div>
        </div>
        <span class="badge">${escapeHtml(p.id)}</span>
      </div>
      <div class="bd">
        <div class="passage">${escapeHtml(p.texte).replace(/\n/g,"<br/>")}</div>
        <div class="divider"></div>
        <div class="small">Opciones/etiquetas: las opciones se mezclan siempre. Escritas: correcci√≥n por ideas/palabras clave.</div>
        <div class="qs"></div>
      </div>
    `;
    const qs = block.querySelector(".qs");
    let qsList = p.questions.slice();
    if(shuffleMode === "shuffleAll") qsList = shuffle(qsList);

    qsList.forEach(q => {
      const qWrap = document.createElement("div");
      qWrap.className = "q";
      qWrap.dataset.qid = q.id;
      qWrap.innerHTML = `
        <h3>${escapeHtml(q.prompt)} <span class="badge">${q.marks} pts</span></h3>
        ${renderQuestion(q)}
        <div class="small" style="margin-top:8px">${escapeHtml(instructionFor(q.type))}</div>
      `;
      qs.appendChild(qWrap);
    });

    $("#paper").appendChild(block);
  });

  // Mini-ensayo
  const e = state.selection.essay;
  const essayBlock = document.createElement("div");
  essayBlock.className = "card";
  essayBlock.style.marginTop = "14px";
  essayBlock.innerHTML = `
    <div class="hd">
      <div>
        <h2>${escapeHtml(e.titre)}</h2>
        <div class="meta">Respuesta corta (~90 palabras) ‚Ä¢ <strong>20 puntos</strong></div>
      </div>
      <span class="badge">MINI-ENSAYO</span>
    </div>
    <div class="bd">
      <div class="passage">${escapeHtml(e.passage).replace(/\n/g,"<br/>")}</div>
      <div class="divider"></div>
      <div class="note"><strong>Consigna:</strong><br/>${escapeHtml(e.consigne)}</div>
      <div class="essayHelp">
        <strong>Auto-correcci√≥n:</strong>
        <div>‚Ä¢ Busca 3 elementos: <strong>a favor</strong> + <strong>en contra</strong> + <strong>conclusi√≥n</strong>.</div>
        <div>‚Ä¢ Objetivo: <strong>75‚Äì110 palabras</strong> (ideal ~90). Muy corto ‚Üí penalizaci√≥n suave.</div>
        <div>‚Ä¢ Usa al menos un conector: <em>primero</em>, <em>sin embargo</em>, <em>en conclusi√≥n</em>‚Ä¶</div>
      </div>
      <div class="q" data-qid="essay">
        <h3>Redacci√≥n (en espa√±ol) <span class="badge">20 pts</span></h3>
        <textarea id="ans_essay" placeholder="Escribe tu mini-ensayo aqu√≠ (~90 palabras)‚Ä¶"></textarea>
        <div class="small" id="essayCount" style="margin-top:6px">Palabras: 0</div>
      </div>
    </div>
  `;
  $("#paper").appendChild(essayBlock);

  // Traducci√≥n
  const t = state.selection.translation;
  const tBlock = document.createElement("div");
  tBlock.className = "card";
  tBlock.style.marginTop = "14px";
  tBlock.innerHTML = `
    <div class="hd">
      <div>
        <h2>${escapeHtml(t.titre)}</h2>
        <div class="meta">${escapeHtml(t.theme)} ‚Ä¢ <strong>20 puntos</strong></div>
      </div>
      <span class="badge">TRADUCCI√ìN</span>
    </div>
    <div class="bd">
      <div class="note"><strong>Texto (ingl√©s):</strong><br/>${escapeHtml(t.textEN)}</div>
      <div class="divider"></div>
      <div class="q" data-qid="translation">
        <h3>Traducir al espa√±ol <span class="badge">20 pts</span></h3>
        <textarea id="ans_translation" placeholder="Escribe tu traducci√≥n al espa√±ol‚Ä¶"></textarea>
        <div class="small" style="margin-top:8px">Auto-corr: 5 ideas-clave (sentido) ‚Ä¢ 4 puntos cada una.</div>
      </div>
    </div>
  `;
  $("#paper").appendChild(tBlock);

  bindInputs();

  const mins = parseInt($("#timeAllowed").value,10);
  startTimer(mins);
  state.submitted = false;

  $("#markingBox").classList.add("hide");
  $("#markingBox").innerHTML = "";
  setBadge("En curso","badge warn");
}

function instructionFor(type){
  if(type === "mcq") return "Elige UNA respuesta.";
  if(type === "tfnm") return "Elige: Verdadero / Falso / No se menciona.";
  if(type === "pn") return "Elige: P / N / P+N.";
  if(type === "syn") return "Escribe la palabra exacta (o la expresi√≥n) encontrada en el texto.";
  if(type === "match") return "Escribe la palabra exacta solicitada (una palabra del texto).";
  return "Respuesta redactada: s√© conciso y preciso (auto-correcci√≥n por palabras clave).";
}

function renderQuestion(q){
  if(q.type === "mcq"){
    const opts = q.options.map((text, idx) => ({ text, isCorrect: idx === q.answerIndex }));
    return renderChoice(q, opts);
  }
  if(q.type === "pn"){
    const opts = [
      { text:"P", isCorrect: q.correct === "P" },
      { text:"N", isCorrect: q.correct === "N" },
      { text:"P+N", isCorrect: q.correct === "P+N" }
    ];
    return renderChoice(q, opts);
  }
  if(q.type === "tfnm"){
    const opts = [
      { text:"Verdadero", isCorrect: q.correct === "Verdadero" },
      { text:"Falso", isCorrect: q.correct === "Falso" },
      { text:"No se menciona", isCorrect: q.correct === "No se menciona" }
    ];
    return renderChoice(q, opts);
  }
  if(q.type === "syn"){
    return `<input type="text" id="ans_${q.id}" placeholder="Palabra exacta del texto‚Ä¶" />`;
  }
  if(q.type === "match"){
    return `<input type="text" id="ans_${q.id}" placeholder="Una palabra exacta del texto‚Ä¶" />`;
  }
  return `<textarea id="ans_${q.id}" placeholder="Responde en espa√±ol‚Ä¶"></textarea>`;
}

function renderChoice(q, optionObjects){
  const name = `ans_${q.id}`;
  const shuffled = shuffle(optionObjects);
  const correctIndex = shuffled.findIndex(o => o.isCorrect);
  state.choiceCorrectValue[q.id] = String(correctIndex);

  return `
    <div class="opts">
      ${shuffled.map((opt, idx) => `
        <label class="opt">
          <input type="radio" name="${name}" value="${idx}" />
          <div><div><strong>${String.fromCharCode(65+idx)}.</strong> ${escapeHtml(opt.text)}</div></div>
        </label>
      `).join("")}
    </div>
  `;
}

function bindInputs(){
  $$("input[type='radio']").forEach(r => {
    r.addEventListener("change", () => {
      const qid = r.name.replace("ans_","");
      state.answers[qid] = r.value;
    });
  });

  $$("textarea").forEach(t => {
    t.addEventListener("input", () => {
      const id = t.id.replace("ans_","");
      state.answers[id] = t.value;
      if(id === "essay"){
        $("#essayCount").textContent = "Palabras: " + countWords(t.value);
      }
    });
  });

  $$("input[type='text']").forEach(inp => {
    if(inp.id === "centreNo" || inp.id.startsWith("candD") || inp.id === "candSurname" || inp.id === "candForenames") return;
    inp.addEventListener("input", () => {
      const id = inp.id.replace("ans_","");
      state.answers[id] = inp.value;
    });
  });
}

/* =========================================================
   AUTO-CORRECCI√ìN
========================================================= */
function markChoice(qid, chosenValue, marks){
  const correctValue = state.choiceCorrectValue[qid];
  const ok = String(chosenValue ?? "") === String(correctValue);
  return { score: ok ? marks : 0, max: marks, detail: ok ? "Correcto." : "Incorrecto." };
}
function markExactWord(q, userText){
  const t = norm(userText);
  if(!t) return {score:0, max:q.marks, detail:"Respuesta vac√≠a."};
  const acc = (q.acceptable || []).map(x => norm(x));
  const ok = acc.includes(t);
  return {score: ok ? q.marks : 0, max:q.marks, detail: ok ? "Correcto (palabra del texto)." : "Incorrecto (se esperaba una palabra del texto)." };
}
function markShort(q, userText){
  const t = norm(userText);
  if(!t) return {score:0, max:q.marks, detail:"Respuesta vac√≠a."};

  const groups = q.keywords || [];
  if(groups.length === 0) return {score:0, max:q.marks, detail:"R√∫brica no configurada."};

  let hits = 0;
  groups.forEach(g => {
    const found = g.some(k => t.includes(norm(k)));
    if(found) hits++;
  });

  const per = q.marks / groups.length;
  const raw = hits * per;
  const score = Math.max(0, Math.min(q.marks, Math.round(raw*2)/2));
  let detail = `Grupos de palabras clave encontrados: ${hits}/${groups.length}.`;
  if(q.rubric) detail += ` Esperado: ${q.rubric}`;
  return {score, max:q.marks, detail};
}

function markMiniEssay(essayObj, userText){
  const raw = (userText ?? "").toString();
  const t = norm(raw);
  if(!t) return {score:0, max:20, detail:"Mini-ensayo vac√≠o.", wordCount:0};

  const wc = countWords(raw);

  // Estructura (6): introducci√≥n + oposici√≥n + conclusi√≥n (2 pts cada una)
  let structHits = 0;
  (essayObj.structureAnchors || []).forEach(group => {
    const ok = group.some(k => t.includes(norm(k)));
    if(ok) structHits++;
  });
  const structureScore = Math.min(6, structHits * 2);

  // Ideas (10): 5 grupos √ó 2
  let ideaHits = 0;
  (essayObj.ideaGroups || []).forEach(group => {
    const ok = group.some(k => t.includes(norm(k)));
    if(ok) ideaHits++;
  });
  const ideaScore = Math.min(10, ideaHits * 2);

  // Conectores (4): 4 familias, 1 pt cada una
  let connHits = 0;
  (essayObj.connectors || []).forEach(group => {
    const ok = group.some(k => t.includes(norm(k)));
    if(ok) connHits++;
  });
  const connScore = Math.min(4, connHits);

  // Longitud (penalizaci√≥n suave)
  let lengthAdj = 0;
  if(wc < 60) lengthAdj = -6;
  else if(wc < 75) lengthAdj = -3;
  else if(wc > 140) lengthAdj = -2; // demasiado largo para ‚Äúestilo 90 palabras‚Äù
  else lengthAdj = 0;

  const total = Math.max(0, Math.min(20, structureScore + ideaScore + connScore + lengthAdj));
  const detail =
    `Estructura: ${structureScore}/6 ‚Ä¢ Ideas: ${ideaScore}/10 ‚Ä¢ Conectores: ${connScore}/4 ‚Ä¢ Longitud: ${wc} palabras (${lengthAdj<0 ? lengthAdj+" pts" : "OK"}).`;
  return {score: Math.round(total*2)/2, max:20, detail, wordCount:wc};
}

function markTranslation(trObj, userText){
  const t = norm(userText);
  if(!t) return {score:0, max:20, detail:"Traducci√≥n vac√≠a."};

  // 5 paquetes (bundles) √ó 4
  let hits = 0;
  (trObj.keyBundles || []).forEach(bundle => {
    const ok = bundle.some(k => t.includes(norm(k)));
    if(ok) hits++;
  });
  const score = Math.min(20, hits * 4);
  const detail = `Ideas clave: ${hits}/5 (puntuaci√≥n ${score}/20).`;
  return {score, max:20, detail};
}

function computeTotal(){
  let total = 0;
  let breakdown = [];

  // Pasajes
  state.selection.passages.forEach(p => {
    p.questions.forEach(q => {
      const ans = state.answers[q.id];
      let res;
      if(["mcq","pn","tfnm"].includes(q.type)){
        res = markChoice(q.id, ans, q.marks);
      }else if(q.type === "syn" || q.type === "match"){
        res = markExactWord(q, ans);
      }else{
        res = markShort(q, ans);
      }
      total += res.score;
      breakdown.push({
        qid: q.id, bloc: p.id, type: q.type, prompt: q.prompt,
        score: res.score, max: res.max, detail: res.detail
      });
    });
  });

  // Mini-ensayo
  const essayAns = state.answers["essay"] ?? $("#ans_essay")?.value ?? "";
  const eRes = markMiniEssay(state.selection.essay, essayAns);
  total += eRes.score;
  breakdown.push({
    qid:"essay", bloc:"MINI-ENSAYO", type:"essay90", prompt:"Mini-ensayo (~90 palabras)",
    score:eRes.score, max:eRes.max, detail:eRes.detail
  });

  // Traducci√≥n
  const trAns = state.answers["translation"] ?? $("#ans_translation")?.value ?? "";
  const tRes = markTranslation(state.selection.translation, trAns);
  total += tRes.score;
  breakdown.push({
    qid:"translation", bloc:"TRADUCCI√ìN", type:"translation", prompt:"Traducci√≥n ingl√©s ‚Üí espa√±ol",
    score:tRes.score, max:tRes.max, detail:tRes.detail
  });

  return { total: Math.round(total*2)/2, max: 100, breakdown };
}

/* =========================================================
   ENV√çO + GUARDADO
========================================================= */
function submitPaper(fromAutoTimer=false){
  if(state.submitted) return;

  const { total, max, breakdown } = computeTotal();
  state.submitted = true;
  stopTimer();

  const letter = otonoLetterGrade(total);
  const pmd = passMeritDistinction(total);
  const gcse = gcseEstimate(total);
  const [badgeCls, badgeText] = badgeForScore(total);

  const attempt = {
    paper: "Otono Spanish ‚Äî A Level ‚Ä¢ Lectura + Mini-ensayo + Traducci√≥n ‚Äî El Inkredible Drummond",
    centre: state.centreNo,
    candidateNo: String(state.candidateNo),
    candidateSurname: state.candSurname || "",
    candidateForenames: state.candForenames || "",
    submittedAt: nowISO(),
    timeAllowedMin: parseInt($("#timeAllowed").value,10),
    selectedPassages: state.selection.passages.map(p=>p.id),
    selectedEssay: state.selection.essay.id,
    selectedTranslation: state.selection.translation.id,
    score: total,
    maxScore: max,
    otonoGrade: letter,
    gcseEstimated: gcse,
    outcome: pmd,
    breakdown
  };
  addResult(attempt);

  const nameLine = [attempt.candidateSurname, attempt.candidateForenames].filter(Boolean).join(", ");

  const box = $("#markingBox");
  box.classList.remove("hide");
  box.innerHTML = `
    <div class="card">
      <div class="hd">
        <div>
          <h2>‚úÖ Corregido${fromAutoTimer ? " (env√≠o autom√°tico)" : ""}</h2>
          <div class="meta">
            Guardado en Resultados ‚Ä¢ Centro ${escapeHtml(attempt.centre)} ‚Ä¢ Candidato ${escapeHtml(attempt.candidateNo)}${nameLine ? " ‚Ä¢ " + escapeHtml(nameLine) : ""}
          </div>
        </div>
        <span class="${badgeCls}">${escapeHtml(badgeText)}</span>
      </div>
      <div class="bd">
        <div class="kpi">
          <div class="box"><div class="t">Puntuaci√≥n</div><div class="v">${attempt.score} / ${attempt.maxScore}</div></div>
          <div class="box"><div class="t">Nota Otono</div><div class="v">${escapeHtml(attempt.otonoGrade)}</div></div>
          <div class="box"><div class="t">Estimaci√≥n GCSE</div><div class="v">${escapeHtml(String(attempt.gcseEstimated))}</div></div>
          <div class="box"><div class="t">Estado</div><div class="v">${escapeHtml(attempt.outcome)}</div></div>
        </div>

        <div class="divider"></div>

        <div class="note">
          <strong>Notas de auto-correcci√≥n</strong><br/>
          ‚Ä¢ MCQ / V-F-NM / P-N-P+N: correcci√≥n exacta (opciones mezcladas).<br/>
          ‚Ä¢ ‚ÄúPalabra del texto‚Äù: se espera exactitud (ortograf√≠a normalizada).<br/>
          ‚Ä¢ Respuestas redactadas + mini-ensayo: correcci√≥n por ideas/palabras clave ‚Üí si reformulas mucho, puede bajar la nota.
        </div>

        <div class="divider"></div>

        <button class="btn" id="btnShowBreakdown">Mostrar el detalle</button>
        <div id="breakdown" class="hide" style="margin-top:12px"></div>

        <div class="divider"></div>

        <div class="note">
          <strong>Modelo (mini-ensayo / traducci√≥n) ‚Äî para referencia</strong><br/>
          <div class="divider"></div>
          <div><strong>Mini-ensayo:</strong><br/>${escapeHtml(state.selection.essay.modelAnswer).replace(/\n/g,"<br/>")}</div>
          <div class="divider"></div>
          <div><strong>Traducci√≥n:</strong><br/>${escapeHtml(state.selection.translation.sampleFR)}</div>
        </div>
      </div>
    </div>
  `;

  $("#btnShowBreakdown").addEventListener("click", () => {
    const bd = $("#breakdown");
    bd.classList.toggle("hide");
    if(!bd.classList.contains("hide")){
      bd.innerHTML = breakdown.map(b => `
        <div class="attempt">
          <div class="top">
            <div><strong>${escapeHtml(b.qid)}</strong> ‚Ä¢ ${escapeHtml(b.bloc)} ‚Ä¢ ${escapeHtml(String(b.type))}</div>
            <div><span class="badge">${b.score} / ${b.max}</span></div>
          </div>
          <div class="meta">
            <div><strong>Pregunta:</strong> ${escapeHtml(b.prompt)}</div>
            <div><strong>Auto-corr:</strong> ${escapeHtml(b.detail)}</div>
          </div>
        </div>
      `).join("");
    }
  });

  setBadge("Enviado","badge good");
}

/* =========================================================
   UI DE RESULTADOS
========================================================= */
function drawResults(){
  const listEl = $("#resultsList");
  const all = loadResults();
  const filter = ($("#filterCandidate").value || "").replace(/\D/g,"").slice(0,4);
  const filtered = filter ? all.filter(a => String(a.candidateNo) === String(filter)) : all;

  if(filtered.length === 0){
    listEl.innerHTML = `<div class="note">No hay intentos guardados${filter ? " para este candidato" : ""}.</div>`;
    return;
  }

  listEl.innerHTML = filtered.map(a => {
    const [cls, txt] = badgeForScore(a.score);
    const nameLine = [a.candidateSurname, a.candidateForenames].filter(Boolean).join(", ");
    return `
      <div class="attempt">
        <div class="top">
          <div>
            <strong>${escapeHtml(a.candidateNo)}</strong>${nameLine ? " ‚Ä¢ " + escapeHtml(nameLine) : ""}
            <span class="badge" style="margin-left:8px">Centro ${escapeHtml(a.centre)}</span>
          </div>
          <div class="${cls}">${escapeHtml(txt)} ‚Ä¢ ${escapeHtml(String(a.score))}/100</div>
        </div>
        <div class="meta">
          <div><strong>Fecha:</strong> ${escapeHtml(new Date(a.submittedAt).toLocaleString())}</div>
          <div><strong>Selecci√≥n:</strong> Pasajes ${escapeHtml(a.selectedPassages.join(", "))} ‚Ä¢ Ensayo ${escapeHtml(a.selectedEssay)} ‚Ä¢ Trad ${escapeHtml(a.selectedTranslation)}</div>
          <div><strong>Notas:</strong> Otono ${escapeHtml(a.otonoGrade)} ‚Ä¢ GCSE ${escapeHtml(String(a.gcseEstimated))} ‚Ä¢ ${escapeHtml(a.outcome)}</div>
        </div>
      </div>
    `;
  }).join("");
}

function exportResults(){
  const all = loadResults();
  $("#exportText").textContent = JSON.stringify(all, null, 2);
  $("#exportBox").classList.remove("hide");
}

function clearResults(){
  if(!confirm("¬øBorrar TODOS los intentos guardados en este navegador?")) return;
  localStorage.removeItem(STORE_KEY);
  drawResults();
  $("#exportBox").classList.add("hide");
}

/* =========================================================
   BOTONES
========================================================= */
$("#btnHome").addEventListener("click", () => { state.mode="home"; renderHome(); });
$("#btnResults").addEventListener("click", () => { state.mode="results"; renderResults(); });

$("#btnPreview").addEventListener("click", () => {
  const c = getCandidateNoFromSquares();
  if(!c){ alert("Primero introduce un n√∫mero de candidato."); focusDigit(0); return; }
  const sel = generateSelection();
  const box = $("#previewBox");
  box.classList.remove("hide");
  box.innerHTML = `<strong>Vista previa (sin empezar):</strong><br/>${escapeHtml(selectionSummary(sel))}<br/>` +
    sel.passages.map(p => `‚Ä¢ ${escapeHtml(p.titre)} (${escapeHtml(p.id)})`).join("<br/>") +
    `<br/>‚Ä¢ ${escapeHtml(sel.essay.titre)} (${escapeHtml(sel.essay.id)})` +
    `<br/>‚Ä¢ ${escapeHtml(sel.translation.titre)} (${escapeHtml(sel.translation.id)})`;
});

$("#btnStart").addEventListener("click", () => {
  const c = getCandidateNoFromSquares();
  if(!c){ alert("El n√∫mero de candidato es obligatorio."); focusDigit(0); return; }

  state.candidateNo = c;
  state.candSurname = ($("#candSurname").value || "").trim();
  state.candForenames = ($("#candForenames").value || "").trim();

  state.selection = generateSelection();
  state.answers = {};
  renderTest();
});

$("#btnSubmit").addEventListener("click", () => submitPaper(false));

$("#btnReset").addEventListener("click", () => {
  if(!confirm("¬øReiniciar y generar un NUEVO examen? Se perder√°n las respuestas actuales.")) return;
  stopTimer();
  state.answers = {};
  state.submitted = false;
  state.selection = generateSelection();
  renderTest();
});

/* Resultados */
$("#filterCandidate").addEventListener("input", (e) => {
  e.target.value = e.target.value.replace(/\D/g,"").slice(0,4);
  drawResults();
});
$("#tabAll").addEventListener("click", () => {
  $("#tabAll").classList.add("active");
  $("#tabCandidate").classList.remove("active");
  $("#filterCandidate").value = "";
  drawResults();
});
$("#tabCandidate").addEventListener("click", () => {
  $("#tabCandidate").classList.add("active");
  $("#tabAll").classList.remove("active");
  $("#filterCandidate").focus();
});
$("#btnExport").addEventListener("click", exportResults);
$("#btnClear").addEventListener("click", clearResults);

/* INIT */
setCentre("50749");
renderHome();
</script>
</body>
</html>