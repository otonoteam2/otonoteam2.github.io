<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸŸ£ Otono French â€” A Level â€¢ Lecture + Mini-essai + Traduction â€” Lâ€™Encroyable Drummond</title>
  <style>
    :root{
      --bg1:#2b0a3d; --bg2:#7a0036;
      --card:#0f0b18cc; --card2:#120c22e6;
      --text:#f4efff; --muted:#c9b9ff;
      --accent:#b000ff; --accent2:#ff1b6a;
      --good:#19ff9a; --warn:#ffd166; --bad:#ff4d6d;
      --line:rgba(255,255,255,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background:
        radial-gradient(1000px 700px at 15% 10%, rgba(176,0,255,.22), transparent 60%),
        radial-gradient(900px 650px at 80% 20%, rgba(255,27,106,.18), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .wrap{max-width:1200px; margin:0 auto; padding:22px;}
    .topbar{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow:var(--shadow);
      position:sticky; top:14px; z-index:20; backdrop-filter: blur(10px);
    }
    .brand{display:flex; flex-direction:column; gap:2px}
    .brand h1{margin:0; font-size:16px; letter-spacing:.3px}
    .brand .sub{font-size:12px; color:var(--muted)}
    .pill{
      padding:8px 10px; border-radius:999px; border:1px solid var(--line);
      background:rgba(0,0,0,.25); font-family:var(--mono); font-size:12px;
      display:flex; gap:10px; align-items:center;
    }
    .pill strong{color:#fff}
    .btn{
      border:1px solid var(--line); background:rgba(0,0,0,.25);
      color:var(--text); padding:10px 12px; border-radius:14px; cursor:pointer;
      transition:.15s transform, .15s background, .15s border;
      font-weight:600;
    }
    .btn:hover{transform:translateY(-1px); background:rgba(0,0,0,.33); border-color:rgba(255,255,255,.22)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(176,0,255,.55), rgba(255,27,106,.45));
      border-color:rgba(255,255,255,.22);
    }
    .btn.danger{background:rgba(255,77,109,.18); border-color:rgba(255,77,109,.35)}
    .grid{display:grid; grid-template-columns: 1.15fr .85fr; gap:16px; margin-top:16px;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} .topbar{position:static} }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 16px; border-bottom:1px solid var(--line);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }
    .card .hd h2{margin:0; font-size:14px}
    .card .hd .meta{font-size:12px; color:var(--muted); line-height:1.25}
    .card .bd{padding:16px}
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}

    input[type="text"], input[type="number"], textarea, select{
      width:100%; border:1px solid var(--line); background:rgba(0,0,0,.25);
      color:var(--text); padding:10px 12px; border-radius:14px; outline:none;
      font-family:var(--sans);
    }
    textarea{min-height:110px; resize:vertical}

    .row{display:flex; gap:10px; flex-wrap:wrap}
    .row > div{flex:1 1 180px}

    .note{
      font-size:12px; color:var(--muted); line-height:1.45;
      padding:10px 12px; border-radius:14px; border:1px dashed rgba(255,255,255,.18);
      background:rgba(0,0,0,.18);
    }
    .badge{
      font-family:var(--mono); font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background:rgba(0,0,0,.20);
      display:inline-flex; align-items:center; gap:6px;
    }
    .badge.good{border-color:rgba(25,255,154,.35); background:rgba(25,255,154,.12)}
    .badge.warn{border-color:rgba(255,209,102,.35); background:rgba(255,209,102,.12)}
    .badge.bad{border-color:rgba(255,77,109,.35); background:rgba(255,77,109,.12)}
    .divider{height:1px; background:var(--line); margin:14px 0}
    .passage{
      padding:12px 14px; border:1px solid var(--line); border-radius:16px;
      background:rgba(0,0,0,.22); line-height:1.62;
      font-size:14px;
    }
    .q{
      margin-top:14px; padding:12px 14px; border:1px solid var(--line);
      border-radius:16px; background:rgba(0,0,0,.20);
    }
    .q h3{margin:0 0 8px; font-size:13px}
    .opts{display:grid; gap:8px; margin-top:8px}
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px; border-radius:14px; border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      cursor:pointer;
    }
    .opt input{margin-top:3px}
    .kpi{display:grid; grid-template-columns:repeat(4,1fr); gap:10px}
    @media (max-width: 980px){ .kpi{grid-template-columns:repeat(2,1fr)} }
    .kpi .box{
      border:1px solid var(--line); border-radius:16px; padding:10px 12px;
      background:rgba(0,0,0,.22);
    }
    .kpi .box .t{font-size:12px; color:var(--muted)}
    .kpi .box .v{font-size:18px; font-weight:800; margin-top:4px}
    .small{font-size:12px; color:var(--muted)}
    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{padding:10px 12px; border-radius:14px; border:1px solid var(--line); background:rgba(0,0,0,.22); cursor:pointer; font-weight:700}
    .tab.active{background:linear-gradient(135deg, rgba(176,0,255,.35), rgba(255,27,106,.22)); border-color:rgba(255,255,255,.22)}
    .resultsList{display:grid; gap:10px}
    .attempt{
      border:1px solid var(--line); border-radius:16px; padding:12px 14px;
      background:rgba(0,0,0,.20);
    }
    .attempt .top{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .attempt .top strong{font-family:var(--mono)}
    .attempt .meta{font-size:12px; color:var(--muted); margin-top:6px; line-height:1.45}
    .copy{font-family:var(--mono); font-size:12px; white-space:pre-wrap; word-break:break-word}
    .hide{display:none !important}

    /* Candidate number 4 cases */
    .digitRow{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .digitRow .digit{
      width:52px; text-align:center; font-family:var(--mono);
      font-size:18px; font-weight:900; padding:12px 0;
      border-radius:14px; border:1px solid var(--line);
      background:rgba(0,0,0,.25); color:var(--text);
      outline:none;
    }
    .digitRow .hint{font-size:12px; color:var(--muted)}
    .miniRow{display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end}
    .miniRow > *{flex:1 1 160px}

    .essayHelp{
      display:grid; gap:8px;
      padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.16);
      font-size:12px; color:var(--muted);
    }
    .essayHelp strong{color:#fff}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>ğŸŸ£ Otono French â€” A Level â€¢ Lecture + Mini-essai + Traduction â€” Lâ€™Encroyable Drummond</h1>
        <div class="sub">
          3 passages Ã— 20 + 1 mini-essai Ã— 20 + 1 traduction Ã— 20 = <strong>100</strong> â€¢ Centre: <strong id="centreTop">50749</strong>
        </div>
      </div>
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end">
        <div class="pill"><span>â±ï¸ Chrono :</span><strong id="timerText">--:--</strong></div>
        <button class="btn" id="btnResults">RÃ©sultats</button>
        <button class="btn primary" id="btnHome">Test</button>
      </div>
    </div>

    <div class="grid">
      <!-- GAUCHE -->
      <div class="card" id="panelHome">
        <div class="hd">
          <div>
            <h2>Configuration du candidat</h2>
            <div class="meta">
              Pas de dictionnaire â€¢ Pas de traducteur â€¢ RÃ©ponses en franÃ§ais â€¢ Auto-correction par idÃ©es/mots-clÃ©s (pas parfaite).
            </div>
          </div>
          <span class="badge" id="statusBadge">PrÃªt</span>
        </div>

        <div class="bd" id="homeBody">
          <div class="miniRow">
            <div>
              <label>NumÃ©ro de centre</label>
              <input type="text" id="centreNo" value="50749" disabled />
              <div class="small" style="margin-top:6px">
                Valeur par dÃ©faut : <strong>50749</strong> (modifiable, optionnel).
              </div>
            </div>
            <div style="display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap">
              <button class="btn" id="btnEditCentre">Personnaliser</button>
              <button class="btn" id="btnResetCentre">RÃ©initialiser</button>
            </div>
          </div>

          <div class="divider"></div>

          <div>
            <label>NumÃ©ro candidat (obligatoire, 4 chiffres)</label>
            <div class="digitRow" aria-label="NumÃ©ro candidat">
              <input class="digit" id="candD1" inputmode="numeric" maxlength="1" />
              <input class="digit" id="candD2" inputmode="numeric" maxlength="1" />
              <input class="digit" id="candD3" inputmode="numeric" maxlength="1" />
              <input class="digit" id="candD4" inputmode="numeric" maxlength="1" />
              <span class="hint">Chiffres uniquement â€¢ avance automatique</span>
            </div>
          </div>

          <div class="row" style="margin-top:6px">
            <div>
              <label>Nom (optionnel)</label>
              <input type="text" id="candSurname" placeholder="Nom" />
            </div>
            <div>
              <label>PrÃ©nom(s) (optionnel)</label>
              <input type="text" id="candForenames" placeholder="PrÃ©nom(s)" />
            </div>
          </div>

          <div class="divider"></div>

          <div class="note">
            <strong>Structure du sujet :</strong><br/>
            â€¢ <strong>3 passages longs</strong> sur lâ€™Otono Team / Lâ€™Encroyable Drummond : <strong>20</strong> points chacun.<br/>
            â€¢ <strong>1 mini-essai</strong> (rÃ©ponse ~90 mots) basÃ© sur UN passage : <strong>20</strong> points.<br/>
            â€¢ <strong>1 traduction</strong> anglais â†’ franÃ§ais : <strong>20</strong> points.<br/><br/>
            <strong>Types de questions :</strong> QCM â€¢ Vrai/Faux/Non mentionnÃ© â€¢ Positif/NÃ©gatif/Les deux â€¢ RÃ©ponses rÃ©digÃ©es â€¢
            Trouver dans le texte un mot/une expression ayant <strong>le mÃªme sens</strong> quâ€™un autre mot.
          </div>

          <div class="divider"></div>

          <div class="row">
            <div>
              <label>Temps imparti</label>
              <select id="timeAllowed">
                <option value="90">90 minutes</option>
                <option value="105">105 minutes</option>
                <option value="120" selected>120 minutes (recommandÃ©)</option>
                <option value="135">135 minutes</option>
                <option value="150">150 minutes (max)</option>
              </select>
            </div>
            <div>
              <label>Ordre des questions</label>
              <select id="shuffleMode">
                <option value="shuffleAll" selected>MÃ©langer les questions (plus dur)</option>
                <option value="keepOrder">Garder lâ€™ordre</option>
              </select>
            </div>
            <div>
              <label>Fin du chrono</label>
              <select id="autoSubmit">
                <option value="yes" selected>Soumettre automatiquement</option>
                <option value="no">Ne pas soumettre</option>
              </select>
            </div>
          </div>

          <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap">
            <button class="btn primary" id="btnStart">DÃ©marrer le sujet alÃ©atoire</button>
            <button class="btn" id="btnPreview">AperÃ§u (sans dÃ©marrer)</button>
          </div>

          <div id="previewBox" class="note hide" style="margin-top:12px"></div>
        </div>

        <!-- CORPS DU TEST -->
        <div class="bd hide" id="testBody">
          <div class="kpi">
            <div class="box"><div class="t">Candidat</div><div class="v" id="kpiCandidate">â€”</div></div>
            <div class="box"><div class="t">Passages</div><div class="v" id="kpiPassages">â€”</div></div>
            <div class="box"><div class="t">Mini-essai</div><div class="v" id="kpiEssay">â€”</div></div>
            <div class="box"><div class="t">Note max</div><div class="v">100</div></div>
          </div>

          <div class="divider"></div>

          <div class="note">
            <strong>Rappel :</strong> rÃ©ponses en franÃ§ais uniquement. Appuie-toi sur le texte. Pour les rÃ©ponses rÃ©digÃ©es, sois clair et direct.
          </div>

          <div id="paper"></div>

          <div class="divider"></div>

          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn primary" id="btnSubmit">Soumettre & Auto-corriger</button>
            <button class="btn" id="btnReset">RÃ©initialiser (nouveau sujet)</button>
          </div>

          <div id="markingBox" class="hide" style="margin-top:14px"></div>
        </div>
      </div>

      <!-- DROITE -->
      <div class="card" id="panelSide">
        <div class="hd">
          <div>
            <h2 id="sideTitle">Notation Otono</h2>
            <div class="meta" id="sideMeta">Score â†’ note Otono + estimation GCSE + Pass/Merit/Distinction.</div>
          </div>
        </div>

        <div class="bd" id="sideBody">
          <div class="note">
            <strong>Pass / Merit / Distinction</strong><br/>
            PASS : 66+<br/>
            MERIT : 80+<br/>
            DISTINCTION : 90+<br/>
          </div>
          <div class="divider"></div>
          <div class="note">
            <strong>Notes Otono (Aâ€“H + secret S)</strong><br/>
            S : 101+ (secret)<br/>
            A* : 95â€“100<br/>
            A : 90â€“94<br/>
            B : 80â€“89<br/>
            C : 70â€“79<br/>
            D : 66â€“69<br/>
            E : 55â€“65<br/>
            F : 45â€“54<br/>
            G : 30â€“44<br/>
            H : 15â€“29<br/>
            U : 0â€“14
          </div>
          <div class="divider"></div>
          <div class="note">
            <strong>Estimation GCSE 9â€“1 (mapping simple)</strong><br/>
            9 : 90â€“100 â€¢ 8 : 80â€“89 â€¢ 7 : 70â€“79 â€¢ 6 : 60â€“69 â€¢ 5 : 50â€“59<br/>
            4 : 40â€“49 â€¢ 3 : 30â€“39 â€¢ 2 : 20â€“29 â€¢ 1 : 10â€“19 â€¢ U : 0â€“9
          </div>
          <div class="divider"></div>
          <div class="small">Les rÃ©sultats sont enregistrÃ©s uniquement sur ce navigateur (localStorage).</div>
        </div>

        <!-- RÃ‰SULTATS -->
        <div class="bd hide" id="resultsBody">
          <div class="tabs">
            <div class="tab active" id="tabAll">Toutes les tentatives</div>
            <div class="tab" id="tabCandidate">Par candidat</div>
          </div>

          <div class="row" style="margin-top:10px">
            <div>
              <label>Filtrer par numÃ©ro (4 chiffres)</label>
              <input type="text" id="filterCandidate" placeholder="ex : 1105" inputmode="numeric" />
            </div>
            <div>
              <label>Actions</label>
              <div style="display:flex; gap:10px; flex-wrap:wrap">
                <button class="btn" id="btnExport">Exporter JSON</button>
                <button class="btn danger" id="btnClear">Tout effacer</button>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="resultsList" id="resultsList"></div>

          <div id="exportBox" class="note hide" style="margin-top:12px">
            <div><strong>JSON exportÃ©</strong> (copie/stocke-le) :</div>
            <div class="divider"></div>
            <div class="copy" id="exportText"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* =========================================================
   ğŸ”’ ANTI-COPIE / ANTI-DETECTION (raisonnable)
   Objectif : empÃªcher que lâ€™UI affiche les banques en clair
   et dÃ©courager le copier-coller du â€œsourceâ€.
   (Ne remplace pas la sÃ©curitÃ© rÃ©elle â€” mais utile pour un test local.)
========================================================= */

const disabledKeys = ["u", "I"];
const showAlert = e => {
  e.preventDefault();
  return alert("Hahaha, I challenge you, valiant soldier, to uproot the source codes yourself!!!");
};
document.addEventListener("contextmenu", e => { showAlert(e); });
document.addEventListener("keydown", e => {
  if ((e.ctrlKey && disabledKeys.includes(e.key)) || e.key === "F12") {
    showAlert(e);
  }
});

/* =========================================================
   OTONO â€” A LEVEL BANQUES (Otono Team / Lâ€™Encroyable Drummond)
   3 passages Ã— 20 = 60
   1 mini-essai (~90 mots) Ã— 20 = 20
   1 traduction EN->FR Ã— 20 = 20
   TOTAL = 100
========================================================= */

const PASSAGES_A = [
  {
    id:"P1",
    titre:"Passage P1 â€” Les enveloppes violettes",
    theme:"Lâ€™Encroyable Drummond â€” RÃ©sultats et rÃ¨gles",
    texte:`Le jour des rÃ©sultats, Red a dÃ©cidÃ© de faire les choses Ã  sa maniÃ¨re. Au lieu dâ€™imprimer une simple note finale, il a prÃ©parÃ© une enveloppe violette pour chaque candidat. Ã€ lâ€™intÃ©rieur, on trouvait deux Ã©lÃ©ments : dâ€™abord la feuille de rÃ©sultats dÃ©taillÃ©e, avec les points par section et le total ; ensuite la copie originale, celle qui devait Ãªtre rendue Ã  Red aprÃ¨s consultation. La rÃ¨gle Ã©tait claire : on pouvait regarder la copie, mais on ne pouvait pas la modifier. Red disait que câ€™Ã©tait une question dâ€™honnÃªtetÃ© et de traÃ§abilitÃ©.

Pour certains, lâ€™enveloppe avait une valeur supplÃ©mentaire. Si le candidat atteignait les exigences, lâ€™enveloppe contenait aussi un petit bonus. Mais ce bonus nâ€™Ã©tait jamais automatique : il dÃ©pendait du respect des consignes. Une seule chose pouvait tout compliquer : une pÃ©nalitÃ©. Par exemple, si lâ€™encre Ã©tait interdite ou si une partie Ã©tait faite dans la mauvaise langue, Red pouvait retirer des points. Dans ce cas, il Ã©crivait deux notes : le score original et le score pÃ©nalisÃ©. Câ€™Ã©tait parfois frustrant, mais Red insistait : Â« Je corrige ce qui est Ã©crit, pas ce que tu voulais Ã©crire Â».

MalgrÃ© la tension, lâ€™ambiance restait particuliÃ¨re : certains plaisantaient, dâ€™autres se comparaient, et Luke, lui, regardait surtout la nettetÃ© des rÃ©ponses et la couleur de lâ€™encre.`,
    questions:[
      {id:"P1_q1", type:"mcq", marks:2,
        prompt:"1) Dans lâ€™enveloppe violette, il y a surtoutâ€¦",
        options:["une seule note finale sans dÃ©tail","la feuille de rÃ©sultats dÃ©taillÃ©e et la copie originale","une lettre de motivation et un contrat","un tÃ©lÃ©phone et un code secret"],
        answerIndex:1
      },
      {id:"P1_q2", type:"tfnm", marks:2,
        prompt:"2) Le candidat a le droit de modifier la copie originale. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P1_q3", type:"pn", marks:2,
        prompt:"3) Lâ€™auteur prÃ©sente la pÃ©nalitÃ© commeâ€¦ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P1_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« suivi officiel Â» (un mot).",
        acceptable:["traÃ§abilitÃ©","tracabilite"]
      },
      {id:"P1_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« interdite Â» (fÃ©minin) ? (un mot du texte)",
        acceptable:["interdite"]
      },
      {id:"P1_q6", type:"short", marks:6,
        prompt:"6) Explique deux raisons pour lesquelles Red Ã©crit deux notes (score original et score pÃ©nalisÃ©).",
        rubric:"IdÃ©es : montrer lâ€™impact de la pÃ©nalitÃ© ; Ãªtre transparent ; corriger ce qui est Ã©crit ; prouver la rÃ¨gle/consigne ; traÃ§abilitÃ©/honnÃªtetÃ©.",
        keywords:[
          ["penalite","pÃ©nalitÃ©","impact"],
          ["transparent","transparence","montrer"],
          ["corrige ce qui est ecrit","corriger ce qui est Ã©crit","ce qui est Ã©crit"],
          ["honnete","honnÃªtetÃ©","traÃ§abilite","traÃ§abilitÃ©"],
          ["regle","rÃ¨gle","consigne"]
        ]
      }
    ]
  },

  {
    id:"P2",
    titre:"Passage P2 â€” La rÃ¨gle de lâ€™encre noire",
    theme:"Lâ€™Encroyable Drummond â€” PrÃ©sentation et sanctions",
    texte:`Dans lâ€™Otono Team, la prÃ©sentation nâ€™est pas un dÃ©tail ; câ€™est presque une discipline. Red a une rÃ¨gle trÃ¨s stricte : lâ€™encre noire est obligatoire. Il explique que, lors dâ€™un examen, la lisibilitÃ© compte autant que la rÃ©ponse. Certains trouvent cette rÃ¨gle excessive, mais Red rÃ©pond que la justice commence par des conditions identiques pour tout le monde. La plupart des candidats sâ€™adaptent sans trop discuter, surtout parce quâ€™ils ont dÃ©jÃ  vu une pÃ©nalitÃ© tomber.

Le problÃ¨me nâ€™est pas seulement la couleur. Red vÃ©rifie aussi si la rÃ©ponse correspond Ã  la consigne, si le candidat ne mÃ©lange pas les langues, et si la page ne ressemble pas Ã  un brouillon. Quand quelquâ€™un utilise une encre interdite, Red ne crie pas : il note calmement Â« pÃ©nalitÃ© dâ€™encre Â» et ajuste le total. Parfois, il retire des points sur la prÃ©sentation ; parfois, si cela concerne une partie entiÃ¨re, il peut dÃ©cider que la section ne compte pas. Il dit que la rÃ¨gle nâ€™est pas faite pour punir un individu, mais pour protÃ©ger la valeur du rÃ©sultat.

Luke, lui, prend la rÃ¨gle au sÃ©rieux. Pour lui, lâ€™encre noire nâ€™est pas seulement un choix : câ€™est une Ã©vidence. Dâ€™autres, comme Wyatt, suivent surtout la rÃ¨gle parce quâ€™ils dÃ©testent lâ€™idÃ©e dâ€™un score rÃ©duit Ã  cause dâ€™un dÃ©tail Ã©vitable.`,
    questions:[
      {id:"P2_q1", type:"mcq", marks:2,
        prompt:"1) Pourquoi Red impose-t-il lâ€™encre noire ?",
        options:["Parce quâ€™il aime les couleurs vives","Parce que la lisibilitÃ© et des conditions identiques comptent","Parce quâ€™il veut faire peur Ã  tout le monde","Parce quâ€™il interdit tous les stylos"],
        answerIndex:1
      },
      {id:"P2_q2", type:"tfnm", marks:2,
        prompt:"2) Red crie quand quelquâ€™un utilise une encre interdite. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P2_q3", type:"pn", marks:2,
        prompt:"3) La rÃ¨gle est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
        correct:"P"
      },
      {id:"P2_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« lisibilitÃ© Â» (un mot du texte).",
        acceptable:["lisibilitÃ©","lisibilite"]
      },
      {id:"P2_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot correspond Ã  Â« brouillon Â» (mÃªme mot) ?",
        acceptable:["brouillon"]
      },
      {id:"P2_q6", type:"short", marks:6,
        prompt:"6) Donne deux choses que Red vÃ©rifie en plus de la couleur de lâ€™encre.",
        rubric:"Consigne ; mÃ©lange des langues ; page propre ; section ; brouillon ; lisibilitÃ©.",
        keywords:[
          ["consigne"],
          ["langue","langues","melange","mÃ©lange"],
          ["page","propre"],
          ["brouillon"],
          ["section"]
        ]
      }
    ]
  },

  {
    id:"P3",
    titre:"Passage P3 â€” Les remarques et la fatigue",
    theme:"Lâ€™Encroyable Drummond â€” Corrections et pression",
    texte:`Quand Red a annoncÃ© quâ€™il ferait des remarques, certains ont cru que ce serait une formalitÃ©. En rÃ©alitÃ©, la remarque demande de la rigueur. Il faut relire sans se laisser influencer par la premiÃ¨re impression, vÃ©rifier les critÃ¨res, et accepter la possibilitÃ© dâ€™une erreur initiale. Red dit quâ€™une remarque nâ€™est pas un cadeau : câ€™est une seconde lecture sÃ©rieuse.

Ce jour-lÃ , la fatigue a compliquÃ© les choses. Plusieurs candidats avaient rendu des copies longues, et Red avait dÃ©jÃ  passÃ© beaucoup de temps Ã  vÃ©rifier les sections. Quand Clayton est arrivÃ©, il Ã©tait sÃ»r de lui dans une matiÃ¨reâ€¦ mais pas dans toutes. En langues, il nâ€™avait pas la mÃªme stabilitÃ©, et cela a surpris certaines personnes. Angus Drummond, lui, attendait surtout que la correction soit cohÃ©rente : il dÃ©teste les approximations, mÃªme quand elles lâ€™avantagent.

Red a donc dÃ©cidÃ© de travailler Ã©tape par Ã©tape. Il a sÃ©parÃ© la copie en blocs, a notÃ© les preuves, et a comparÃ© la rÃ©ponse Ã  la consigne. Il a aussi expliquÃ© sa mÃ©thode Ã  voix haute : Â« Je dois pouvoir justifier chaque point. Si je ne peux pas le justifier, je ne le donne pas Â». Ã€ la fin, la remarque nâ€™a pas toujours changÃ© la note, mais elle a souvent clarifiÃ© pourquoi la note existait.`,
    questions:[
      {id:"P3_q1", type:"mcq", marks:2,
        prompt:"1) Pour Red, une remarque est surtoutâ€¦",
        options:["un cadeau automatique","une seconde lecture sÃ©rieuse","une faÃ§on de changer toutes les notes","un jeu pour comparer les candidats"],
        answerIndex:1
      },
      {id:"P3_q2", type:"tfnm", marks:2,
        prompt:"2) Red explique quâ€™il donne des points mÃªme sâ€™il ne peut pas les justifier. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P3_q3", type:"pn", marks:2,
        prompt:"3) La fatigue est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
        correct:"N"
      },
      {id:"P3_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« justifier Â» (mÃªme mot).",
        acceptable:["justifier"]
      },
      {id:"P3_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« maniÃ¨re Â» ? (un mot du texte)",
        acceptable:["mÃ©thode","methode"]
      },
      {id:"P3_q6", type:"short", marks:6,
        prompt:"6) Pourquoi Red travaille-t-il Â« Ã©tape par Ã©tape Â» pendant la remarque ? Donne deux raisons.",
        rubric:"Rigueur ; Ã©viter lâ€™influence de la premiÃ¨re impression ; prouver/justifier chaque point ; comparer Ã  la consigne ; cohÃ©rence.",
        keywords:[
          ["rigueur"],
          ["premiere impression","premiÃ¨re impression","influenc"],
          ["justifier","preuve","preuves"],
          ["consigne"],
          ["coherente","cohÃ©rente","cohÃ©rence"]
        ]
      }
    ]
  },

  {
    id:"P4",
    titre:"Passage P4 â€” Les messages et la comparaison",
    theme:"Otono Team â€” AmitiÃ©s, pression, comparaison",
    texte:`AprÃ¨s les rÃ©sultats, les messages ont commencÃ© Ã  arriver. Certains fÃ©licitaient, dâ€™autres demandaient des dÃ©tails, et quelques-uns cherchaient Ã  comparer. Dans lâ€™Otono Team, la comparaison peut vite devenir un piÃ¨ge : on ne compare pas seulement des scores, mais des efforts, des mÃ©thodes, et parfois mÃªme des personnalitÃ©s. Benjamin Nelson a une phrase simple sur ce sujet : il dÃ©teste quand on mesure sa valeur en regardant le voisin.

Red le sait, mais il comprend aussi pourquoi les gens comparent. Quand une note semble mystÃ©rieuse, on cherche un repÃ¨re. Quand on a travaillÃ© longtemps, on veut une preuve que cela a servi. Pourtant, la comparaison a un effet secondaire : elle transforme une progression personnelle en compÃ©tition permanente. Luke, lui, prÃ©fÃ¨re analyser sa propre copie : il regarde la structure, la prÃ©cision, et les endroits oÃ¹ il aurait pu Ãªtre plus clair. Wyatt, au contraire, nâ€™a pas envie dâ€™y passer la soirÃ©e. Il veut juste savoir si la rÃ¨gle a Ã©tÃ© respectÃ©e, et si aucun point nâ€™a Ã©tÃ© perdu pour un dÃ©tail Ã©vitable.

Au milieu de ces rÃ©actions, Red rÃ©pÃ¨te la mÃªme idÃ©e : la note nâ€™est pas une identitÃ©. Elle est un rÃ©sultat Ã  un moment donnÃ©. Elle peut guider le prochain travail, mais elle ne devrait pas dÃ©cider de la confiance dâ€™une personne.`,
    questions:[
      {id:"P4_q1", type:"mcq", marks:2,
        prompt:"1) Pourquoi certaines personnes comparent-elles leurs notes ?",
        options:["Parce quâ€™elles veulent toujours tricher","Parce que la note semble mystÃ©rieuse et elles cherchent un repÃ¨re","Parce que Red interdit les enveloppes","Parce quâ€™il nâ€™y a aucune mÃ©thode"],
        answerIndex:1
      },
      {id:"P4_q2", type:"tfnm", marks:2,
        prompt:"2) Le texte dit que la note est une identitÃ©. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P4_q3", type:"pn", marks:2,
        prompt:"3) La comparaison est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P4_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« piÃ¨ge Â» (mÃªme mot).",
        acceptable:["piÃ¨ge","piege"]
      },
      {id:"P4_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« confiance Â» (mÃªme mot) ?",
        acceptable:["confiance"]
      },
      {id:"P4_q6", type:"short", marks:6,
        prompt:"6) Donne deux diffÃ©rences entre la rÃ©action de Luke et celle de Wyatt.",
        rubric:"Luke analyse sa copie (structure, prÃ©cision) ; Wyatt veut juste vÃ©rifier rÃ¨gles/pÃ©nalitÃ© ; Luke passe du temps ; Wyatt Ã©vite la soirÃ©e.",
        keywords:[
          ["luke","analyse","structure","precision","prÃ©cision","clair"],
          ["wyatt","regle","rÃ¨gle","respectee","respectÃ©e","detail","dÃ©tail","penalite","pÃ©nalitÃ©"],
          ["pas envie","evite","Ã©vite","soirÃ©e","soiree"]
        ]
      }
    ]
  },

  /* --- PLUS DE TEXTES (banque Ã©largie) --- */
  {
    id:"P5",
    titre:"Passage P5 â€” Le salon, le calme, et le tri",
    theme:"Otono Team â€” Organisation et concentration",
    texte:`Dans une des salles de lâ€™Otono Team, il y a un rituel discret avant les rÃ©visions : on range, on trie, on Ã©limine ce qui distrait. Ce nâ€™est pas une obsession, mais un moyen de protÃ©ger lâ€™attention. Red dit que la concentration ne se fabrique pas uniquement avec la volontÃ© ; elle se fabrique aussi avec lâ€™environnement. Alors, avant de commencer, il demande des choses simples : tÃ©lÃ©phone hors de portÃ©e, feuille claire, et objectif prÃ©cis pour la sÃ©ance.

Luke adore ce rituel. Il aime sentir que tout est prÃªt : lâ€™encre noire, la rÃ¨gle, lâ€™ordre des pages. Il dit que ce calme extÃ©rieur donne un calme intÃ©rieur. OWing, lui, est plus rapide. Il veut commencer immÃ©diatement, parfois sans parler, comme si la mise en route Ã©tait dÃ©jÃ  une perte de temps. Jessica trouve un Ã©quilibre : elle aime planifier, mais elle refuse de transformer la sÃ©ance en cÃ©rÃ©monie. Pour elle, lâ€™important est de comprendre et de reformuler.

Ce rituel a aussi un avantage social. Quand chacun respecte le silence au dÃ©but, les tensions baissent. On ne se compare pas, on ne se provoque pas, et on se concentre sur le travail. Ensuite, quand la sÃ©ance est terminÃ©e, on peut plaisanter. Red insiste : Â« Le silence nâ€™est pas une punition, câ€™est une protection Â».`,
    questions:[
      {id:"P5_q1", type:"mcq", marks:2,
        prompt:"1) Le rituel sert surtout Ã â€¦",
        options:["faire perdre du temps","protÃ©ger lâ€™attention","empÃªcher toute discussion pour toujours","changer les notes automatiquement"],
        answerIndex:1
      },
      {id:"P5_q2", type:"tfnm", marks:2,
        prompt:"2) Jessica veut transformer la sÃ©ance en cÃ©rÃ©monie. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P5_q3", type:"pn", marks:2,
        prompt:"3) Le silence est prÃ©sentÃ© commeâ€¦ (P / N / P+N)",
        correct:"P"
      },
      {id:"P5_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« protÃ©ger Â» (mÃªme mot).",
        acceptable:["protÃ©ger","proteger","protection"]
      },
      {id:"P5_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« Ã©quilibre Â» ? (un mot du texte)",
        acceptable:["Ã©quilibre","equilibre"]
      },
      {id:"P5_q6", type:"short", marks:6,
        prompt:"6) Donne deux raisons pour lesquelles le rituel aide aussi le groupe (pas seulement un individu).",
        rubric:"Baisse des tensions ; pas de comparaison/provocation ; silence commun ; ambiance ; ensuite on plaisante.",
        keywords:[
          ["tension","tensions","baissent"],
          ["compare","comparer","provocation","provoque"],
          ["silence","commun"],
          ["ambiance"],
          ["plaisanter"]
        ]
      }
    ]
  },

  {
    id:"P6",
    titre:"Passage P6 â€” La copie originale et la confiance",
    theme:"Lâ€™Encroyable Drummond â€” Transparence",
    texte:`La rÃ¨gle de la copie originale a crÃ©Ã© des dÃ©bats. Certains se demandaient : pourquoi rendre la copie Ã  Red ? Pourquoi ne pas la garder ? Red rÃ©pondait toujours avec la mÃªme logique : la copie originale nâ€™est pas un souvenir, câ€™est une preuve. Dans son systÃ¨me, lâ€™idÃ©e de preuve protÃ¨ge tout le monde. Elle protÃ¨ge le candidat contre une erreur de correction ; elle protÃ¨ge le correcteur contre des accusations injustes ; elle protÃ¨ge aussi le groupe contre les discussions sans fin.

Pour montrer quâ€™il ne cherche pas Ã  contrÃ´ler, Red autorise la consultation. Il dit : Â« Tu peux lire, tu peux noter tes erreurs, tu peux comprendre. Mais tu ne peux pas rÃ©Ã©crire lâ€™histoire Â». Cette phrase a marquÃ© plusieurs personnes, parce quâ€™elle transforme la correction en moment dâ€™apprentissage. Luke a apprÃ©ciÃ© immÃ©diatement : il aime lâ€™idÃ©e quâ€™un rÃ©sultat doit Ãªtre clair et vÃ©rifiable. Dâ€™autres trouvaient la rÃ¨gle trop rigide, mais ils reconnaissaient un point : quand tout est vÃ©rifiable, on se dispute moins.

Au final, la copie originale nâ€™est pas lÃ  pour humilier. Elle est lÃ  pour rappeler que le progrÃ¨s commence quand on accepte ce qui est Ã©crit, puis quâ€™on dÃ©cide ce quâ€™on va amÃ©liorer.`,
    questions:[
      {id:"P6_q1", type:"mcq", marks:2,
        prompt:"1) Pour Red, la copie originale est surtoutâ€¦",
        options:["un souvenir","une preuve","une punition","un objet dÃ©coratif"],
        answerIndex:1
      },
      {id:"P6_q2", type:"tfnm", marks:2,
        prompt:"2) Red interdit de consulter la copie. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P6_q3", type:"pn", marks:2,
        prompt:"3) La rÃ¨gle est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P6_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« vÃ©rifiable Â» (mÃªme mot).",
        acceptable:["vÃ©rifiable","verifiable"]
      },
      {id:"P6_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« discussions Â» ? (mÃªme mot)",
        acceptable:["discussions"]
      },
      {id:"P6_q6", type:"short", marks:6,
        prompt:"6) Explique comment la rÃ¨gle peut Â« protÃ©ger tout le monde Â» (deux idÃ©es).",
        rubric:"ProtÃ¨ge candidat (erreur) ; protÃ¨ge correcteur (accusations) ; protÃ¨ge groupe (discussions).",
        keywords:[
          ["candidat","erreur"],
          ["correcteur","accusation","accusations"],
          ["groupe","discussions","sans fin","se dispute moins"]
        ]
      }
    ]
  },

  {
    id:"P7",
    titre:"Passage P7 â€” Le choix du ton dans les remarques",
    theme:"Lâ€™Encroyable Drummond â€” Communication",
    texte:`Pendant une remarque, la faÃ§on de parler peut changer la faÃ§on de comprendre. Red a remarquÃ© que, si le ton devient agressif, le candidat nâ€™Ã©coute plus la justification. Il se ferme, et la discussion devient une bataille. Câ€™est pour cela que Red prÃ©fÃ¨re un ton neutre et prÃ©cis. Il pose des phrases simples : Â« Ici, la consigne nâ€™est pas respectÃ©e Â» ; Â« LÃ , lâ€™idÃ©e est bonne, mais la preuve manque Â». Pour lui, une remarque doit ressembler Ã  un rapport, pas Ã  une humiliation.

Cette attitude nâ€™est pas toujours facile Ã  garder. Quand la fatigue monte, quand le candidat insiste sans argument, ou quand quelquâ€™un nie lâ€™Ã©vidence, le correcteur peut perdre patience. Angus Drummond comprend cela, car il dÃ©teste lâ€™approximation, mais il respecte aussi la cohÃ©rence. Il prÃ©fÃ¨re une phrase froide mais exacte Ã  une phrase gentille mais fausse. Luke, lui, observe la logique : si le point est justifiÃ©, il accepte ; si le point est flou, il pose une question.

Au final, le ton neutre nâ€™Ã©limine pas la frustration, mais il rend la dÃ©cision plus claire. Et quand la dÃ©cision est claire, on peut passer au travail suivant : amÃ©liorer ce qui peut lâ€™Ãªtre.`,
    questions:[
      {id:"P7_q1", type:"mcq", marks:2,
        prompt:"1) Pourquoi Red choisit-il un ton neutre ?",
        options:["Pour paraÃ®tre plus drÃ´le","Pour que le candidat Ã©coute la justification","Pour Ã©viter toute preuve","Pour changer les rÃ¨gles"],
        answerIndex:1
      },
      {id:"P7_q2", type:"tfnm", marks:2,
        prompt:"2) Red veut que la remarque ressemble Ã  une humiliation. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P7_q3", type:"pn", marks:2,
        prompt:"3) Le ton agressif est prÃ©sentÃ© commeâ€¦ (P / N / P+N)",
        correct:"N"
      },
      {id:"P7_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« justification Â» (mÃªme mot).",
        acceptable:["justification"]
      },
      {id:"P7_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« bataille Â» ? (mÃªme mot)",
        acceptable:["bataille"]
      },
      {id:"P7_q6", type:"short", marks:6,
        prompt:"6) Donne deux moments oÃ¹ le correcteur peut perdre patience, selon le texte.",
        rubric:"Fatigue ; candidat insiste sans argument ; quelquâ€™un nie lâ€™Ã©vidence.",
        keywords:[
          ["fatigue"],
          ["insiste","sans argument","argument"],
          ["nie","nier","evidence","Ã©vidence"]
        ]
      }
    ]
  },

  {
    id:"P8",
    titre:"Passage P8 â€” Otono Airways et la rÃ©putation",
    theme:"Otono Team â€” IdentitÃ© et dÃ©tails",
    texte:`Dans les discussions de lâ€™Otono Team, Otono Airways revient souvent comme un symbole. Ce nâ€™est pas seulement une compagnie aÃ©rienne : câ€™est une idÃ©e de qualitÃ©. Red dit que les dÃ©tails construisent une rÃ©putation : lâ€™organisation, la clartÃ© des rÃ¨gles, et le confort ressenti. MÃªme quand quelquâ€™un voyage en classe Ã©conomique, il doit sentir que le systÃ¨me est pensÃ©. Luke aime cette logique, parce quâ€™elle ressemble Ã  la correction : si le systÃ¨me est cohÃ©rent, on fait confiance.

Mais cette obsession des dÃ©tails peut fatiguer. Certains amis de Red ne remarquent pas immÃ©diatement la diffÃ©rence, puis un jour ils la voient, et ils rÃ©agissent. Red trouve cela normal : lâ€™habitude change la perception. Au dÃ©but, on accepte ce quâ€™on connaÃ®t ; ensuite, on compare. Pourtant, Red insiste sur une chose : il ne faut pas confondre confort et respect. Un siÃ¨ge plus large ne remplace pas la politesse, et une rÃ¨gle stricte ne remplace pas la comprÃ©hension. Pour lui, la vraie qualitÃ© est un Ã©quilibre : un cadre solide, mais une attitude humaine.

Quand le dÃ©bat devient trop intense, Jessica rÃ©sume calmement : Â« Les dÃ©tails servent Ã  aider, pas Ã  Ã©craser Â». Cette phrase met souvent tout le monde dâ€™accord, au moins pour quelques minutes.`,
    questions:[
      {id:"P8_q1", type:"mcq", marks:2,
        prompt:"1) Selon Red, une rÃ©putation se construit surtout avecâ€¦",
        options:["le hasard","les dÃ©tails et la cohÃ©rence","des cris et des disputes","des excuses sans rÃ¨gles"],
        answerIndex:1
      },
      {id:"P8_q2", type:"tfnm", marks:2,
        prompt:"2) Le texte dit quâ€™un siÃ¨ge plus large remplace le respect. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P8_q3", type:"pn", marks:2,
        prompt:"3) Lâ€™obsession des dÃ©tails est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P8_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« confiance Â» (mÃªme mot).",
        acceptable:["confiance"]
      },
      {id:"P8_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« Ã©quilibre Â» (mÃªme mot) ?",
        acceptable:["Ã©quilibre","equilibre"]
      },
      {id:"P8_q6", type:"short", marks:6,
        prompt:"6) Explique lâ€™idÃ©e de Jessica : Â« Les dÃ©tails servent Ã  aider, pas Ã  Ã©craser Â» (deux idÃ©es).",
        rubric:"DÃ©tails utiles ; pas pour humilier ; cadre solide + attitude humaine ; comprendre/politesse.",
        keywords:[
          ["aider"],
          ["ecraser","Ã©craser","humilier","punir"],
          ["cadre","solide"],
          ["humaine","humain","politesse","respect"],
          ["comprendre","comprÃ©hension"]
        ]
      }
    ]
  },

  /* -------------------- P9 (OWing main) -------------------- */
  {
    id:"P9",
    titre:"Passage P9 â€” OWing et la vitesse du travail",
    theme:"Otono Team â€” MÃ©thodes, efficacitÃ©, Ã©quilibre",
    texte:`Dans lâ€™Otono Team, OWing est connu pour une chose : il va vite. Pas vite au sens â€œpressÃ©â€, mais vite au sens â€œdirectâ€. Quand une sÃ©ance commence, il nâ€™aime pas les longues introductions. Il ouvre la feuille, il repÃ¨re la consigne, puis il attaque. Red admire cette Ã©nergie, mais il sâ€™inquiÃ¨te parfois : aller vite peut donner lâ€™illusion de maÃ®triser, alors que certaines idÃ©es demandent du temps.

Un soir, Red a voulu tester la mÃ©thode dâ€™OWing. Il lui a proposÃ© une sÃ©ance oÃ¹ lâ€™objectif nâ€™Ã©tait pas seulement de finir, mais de justifier chaque Ã©tape. OWing a acceptÃ©, un peu amusÃ© : Â« Dâ€™accord, mais tu vas voir que je peux Ãªtre rapide et prÃ©cis Â». Luke, lui, observait en silence. Il voulait surtout vÃ©rifier si la prÃ©cision restait intacte quand la vitesse augmentait.

Au dÃ©but, OWing a prouvÃ© sa force : il reformule la question, choisit une structure claire, et note des exemples sans hÃ©siter. Mais au milieu, un dÃ©tail a ralenti la machine : une nuance dans la consigne, un mot qui change tout. Red a insistÃ© : Â« Ce nâ€™est pas une punition. Câ€™est le moment oÃ¹ tu prouves que tu comprends, pas seulement que tu avances Â». OWing sâ€™est arrÃªtÃ©, a relu, puis a corrigÃ© sa trajectoire. Il nâ€™a pas perdu son style ; il lâ€™a renforcÃ©.

AprÃ¨s la sÃ©ance, Red a conclu que la vitesse nâ€™est pas lâ€™ennemie. Le vrai danger, câ€™est la vitesse sans contrÃ´le. OWing a souri : il nâ€™aime pas les leÃ§ons, mais il respecte les idÃ©es qui lâ€™aident Ã  gagner du temps sans perdre la qualitÃ©.`,
    questions:[
      {id:"P9_q1", type:"mcq", marks:2,
        prompt:"1) Pourquoi Red sâ€™inquiÃ¨te-t-il parfois de la vitesse dâ€™OWing ?",
        options:[
          "Parce quâ€™OWing refuse de travailler",
          "Parce que la vitesse peut donner lâ€™illusion de maÃ®triser sans comprendre",
          "Parce que Red dÃ©teste quand quelquâ€™un finit tÃ´t",
          "Parce quâ€™OWing Ã©crit en couleur"
        ],
        answerIndex:1
      },
      {id:"P9_q2", type:"tfnm", marks:2,
        prompt:"2) OWing refuse la sÃ©ance oÃ¹ il doit justifier chaque Ã©tape. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P9_q3", type:"pn", marks:2,
        prompt:"3) La vitesse est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P9_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« hÃ©sitation Â» (un mot).",
        acceptable:["hÃ©siter","hesiter","hÃ©site","hesite","hÃ©sitation","hesitation"]
      },
      {id:"P9_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« nuance Â» (mÃªme mot) ?",
        acceptable:["nuance","nuances"]
      },
      {id:"P9_q6", type:"short", marks:6,
        prompt:"6) Explique deux choses que Red veut vÃ©rifier avec la sÃ©ance (deux idÃ©es).",
        rubric:"ComprÃ©hension rÃ©elle vs illusion ; justification/Ã©tapes ; prÃ©cision sous vitesse ; attention Ã  la consigne ; contrÃ´le.",
        keywords:[
          ["illusion","maitriser","maÃ®triser","comprendre"],
          ["justifier","etape","Ã©tape","Ã©tapes"],
          ["precision","prÃ©cision"],
          ["consigne","nuance","mot qui change tout"],
          ["controle","contrÃ´le"]
        ]
      }
    ]
  },

  /* -------------------- P10 (Joshua dark purple joke) -------------------- */
  {
    id:"P10",
    titre:"Passage P10 â€” Joshua et le Â« trÃ¨s trÃ¨s trÃ¨s trÃ¨s trÃ¨s violet foncÃ© Â»",
    theme:"Otono Team â€” Humour, rÃ¨gles, identitÃ©",
    texte:`Joshua aime les blagues, surtout celles qui arrivent au pire moment, câ€™est-Ã -dire quand tout le monde essaie dâ€™Ãªtre sÃ©rieux. Un jour, alors que Red rappelait encore la rÃ¨gle de lâ€™encre noire, Joshua a levÃ© son stylo avec un air innocent. Â« Je respecte la rÃ¨gle Â», a-t-il annoncÃ©, Â« mais moi je nâ€™utilise pas de noir. Jâ€™utilise du trÃ¨s trÃ¨s trÃ¨s trÃ¨s trÃ¨s violet foncÃ© Â». Il a insistÃ© sur chaque â€œtrÃ¨sâ€ comme si câ€™Ã©tait une dÃ©monstration scientifique.

Luke a immÃ©diatement regardÃ© la pointe du stylo, prÃªt Ã  dÃ©clarer une catastrophe. Wyatt, lui, a Ã©clatÃ© de rire, parce quâ€™il adore quand quelquâ€™un provoque sans casser rÃ©ellement la rÃ¨gle. Red nâ€™a pas ri tout de suite. Il a regardÃ© Joshua et a demandÃ© calmement : Â« Tu veux une blague, ou tu veux un point ? Â». Joshua a rÃ©pondu : Â« Je veux les deux Â». Câ€™est exactement ce qui dÃ©finit son humour : il veut dÃ©tendre lâ€™ambiance sans perdre lâ€™objectif.

Finalement, Joshua a sorti un vrai stylo noir. Mais il nâ€™a pas abandonnÃ© sa blague : il a Ã©crit â€œviolet foncÃ©â€ en titre, juste pour que tout le monde sâ€™en souvienne. Red a soupirÃ©, mais il a reconnu une chose : parfois, une blague empÃªche une tension de devenir une dispute. Tant que la rÃ¨gle est respectÃ©e, lâ€™humour peut servir Ã  respirer.

AprÃ¨s la sÃ©ance, Joshua a expliquÃ© sa logique : si on ne peut jamais rire, on finit par dÃ©tester le travail. Red a rÃ©pondu que le rire est autorisÃ©, mais que la copie doit rester claire. Sur ce point-lÃ , ils Ã©taient dâ€™accord.`,
    questions:[
      {id:"P10_q1", type:"mcq", marks:2,
        prompt:"1) Pourquoi Joshua insiste-t-il sur Â« trÃ¨s trÃ¨s trÃ¨s trÃ¨s trÃ¨s Â» ?",
        options:[
          "Parce quâ€™il veut imiter une dÃ©monstration",
          "Parce quâ€™il veut que Luke change les rÃ¨gles",
          "Parce quâ€™il nâ€™a aucun stylo",
          "Parce quâ€™il refuse toute correction"
        ],
        answerIndex:0
      },
      {id:"P10_q2", type:"tfnm", marks:2,
        prompt:"2) Joshua finit par utiliser un vrai stylo noir. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Vrai"
      },
      {id:"P10_q3", type:"pn", marks:2,
        prompt:"3) Lâ€™humour est prÃ©sentÃ© commeâ€¦ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P10_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« dispute Â» (mÃªme mot).",
        acceptable:["dispute","disputes"]
      },
      {id:"P10_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« tension Â» (mÃªme mot) ?",
        acceptable:["tension","tensions"]
      },
      {id:"P10_q6", type:"short", marks:6,
        prompt:"6) Donne deux raisons pour lesquelles Red accepte lâ€™humour de Joshua, selon le texte.",
        rubric:"DÃ©tend lâ€™ambiance ; Ã©vite que la tension devienne dispute ; rÃ¨gle respectÃ©e ; aide Ã  respirer ; garder objectif.",
        keywords:[
          ["detendre","dÃ©tendre","ambiance"],
          ["evite","Ã©vite","tension","dispute"],
          ["regle","rÃ¨gle","respectee","respectÃ©e"],
          ["respirer"],
          ["objectif","copie claire","claire"]
        ]
      }
    ]
  },

  
  {
  id:"P11",
  titre:"Passage P11 â€” Le dÃ©partement MFL dâ€™Otono : rigueur, plaintes, et crÃ©dibilitÃ©",
  theme:"Otono MFL Department â€” Organisation, qualitÃ©, rÃ©actions",
  texte:`Le dÃ©partement MFL dâ€™Otono nâ€™est pas nÃ© dâ€™un â€œclub sympaâ€ ; il est nÃ© dâ€™un problÃ¨me. AprÃ¨s plusieurs sÃ©ries dâ€™activitÃ©s, des plaintes sont arrivÃ©es : certains disaient que les consignes nâ€™Ã©taient pas assez nettes, dâ€™autres trouvaient les critÃ¨res trop sÃ©vÃ¨res, et quelques-uns accusaient le systÃ¨me dâ€™Ãªtre â€œimprÃ©visibleâ€. Red a acceptÃ© une chose : si un dÃ©partement veut Ãªtre respectÃ©, il doit Ãªtre lisible. Mais il a refusÃ© une autre : baisser le niveau pour calmer le bruit.

Pour reconstruire la confiance, Red a formÃ© une petite Ã©quipe â€” volontairement limitÃ©e. Luke a pris la partie la plus technique : mise en page, cohÃ©rence des formats, vÃ©rification des dÃ©tails (mÃªme la ponctuation et les accents). Shireen, elle, a fait le travail le plus lourd sur le contenu : elle relisait, repÃ©rait les faux sens, et testait si une question pouvait piÃ©ger un Ã©lÃ¨ve honnÃªte. Thomas intervenait surtout sur la logique des questions (vrai/faux/non mentionnÃ©) et sur les formulations qui crÃ©ent des ambiguÃ¯tÃ©s. Lewis aidait Ã  simplifier certaines consignes sans les rendre faciles. Benjamin Nelson, enfin, jouait le rÃ´le le plus â€œinconfortableâ€ : il repÃ©rait les moments oÃ¹ la comparaison entre Ã©lÃ¨ves risquait de remplacer lâ€™apprentissage, et il insistait pour que le dÃ©partement reste un outil, pas une machine Ã  classer.

Red a annoncÃ© une rÃ¨gle interne : chaque exercice doit prouver deux choses Ã  la fois â€” une compÃ©tence linguistique et une compÃ©tence de mÃ©thode. Cela a rendu le dÃ©partement plus exigeant, donc pas forcÃ©ment plus populaire. Pourtant, la plainte la plus sÃ©rieuse a diminuÃ© : â€œOn ne comprend pas pourquoi on perd des points.â€ Red disait que ce nâ€™Ã©tait pas un hasard : quand un systÃ¨me peut justifier chaque dÃ©cision, il devient critiquableâ€¦ mais il devient aussi crÃ©dible.`,
  questions:[
    {id:"P11_q1", type:"mcq", marks:2,
      prompt:"1) Pourquoi le dÃ©partement MFL dâ€™Otono a-t-il Ã©tÃ© rÃ©organisÃ© ?",
      options:[
        "Parce que Red voulait faire un club amusant",
        "Parce que des plaintes concernaient la clartÃ©, la sÃ©vÃ©ritÃ© et lâ€™imprÃ©visibilitÃ©",
        "Parce que Luke a interdit les langues",
        "Parce que Benjamin Nelson voulait supprimer les critÃ¨res"
      ],
      answerIndex:1
    },
    {id:"P11_q2", type:"tfnm", marks:2,
      prompt:"2) Red accepte de baisser le niveau pour calmer les plaintes. (Vrai / Faux / Non mentionnÃ©)",
      correct:"Faux"
    },
    {id:"P11_q3", type:"pn", marks:2,
      prompt:"3) Les plaintes sont prÃ©sentÃ©es commeâ€¦ (P / N / P+N)",
      correct:"P+N"
    },
    {id:"P11_q4", type:"syn", marks:3,
      prompt:"4) Trouve dans le texte un mot qui signifie Â« facile Ã  comprendre / clair Â» (un mot).",
      acceptable:["lisible"]
    },
    {id:"P11_q5", type:"match", marks:3,
      prompt:"5) Dans le texte, quel mot signifie Â« digne de confiance / sÃ©rieux Â» ? (un mot du texte)",
      acceptable:["crÃ©dible","credible"]
    },
    {id:"P11_q6", type:"short", marks:4,
      prompt:"6) Qui fait le travail le plus lourd sur le contenu, et en quoi consiste ce travail ? (deux Ã©lÃ©ments)",
      rubric:"Shireen ; relecture ; repÃ©rer faux sens ; tester les piÃ¨ges injustes ; vÃ©rifier quâ€™un Ã©lÃ¨ve honnÃªte nâ€™est pas piÃ©gÃ©.",
      keywords:[
        ["shireen"],
        ["relire","relecture","relisait"],
        ["faux sens"],
        ["tester","piÃ©ger","pieger"],
        ["eleve","Ã©lÃ¨ve","honnÃªte","honnete"]
      ]
    },
    {id:"P11_q7", type:"short", marks:4,
      prompt:"7) Explique pourquoi le dÃ©partement devient â€œcritiquableâ€ mais aussi â€œcrÃ©dibleâ€ selon Red (deux idÃ©es).",
      rubric:"Justifier chaque dÃ©cision â†’ on peut critiquer prÃ©cisÃ©ment ; transparence ; on comprend pourquoi points perdus ; cohÃ©rence ; confiance.",
      keywords:[
        ["justifier","justification","decision","dÃ©cision"],
        ["critique","critiquable"],
        ["comprendre","pourquoi","perd des points"],
        ["coher","cohÃ©r","cohÃ©rence"],
        ["confiance","credible","crÃ©dible","transparen","transparence"]
      ]
    }
  ]
},

  /* -------------------- P12 (Thomas) -------------------- */
  {
    id:"P12",
    titre:"Passage P12 â€” Thomas, Â« Lenfer Â» et la logique de lâ€™obscuritÃ©",
    theme:"Otono Team â€” Imagination, expression, prÃ©cision",
    texte:`Thomas a une imagination intense. Dans ses jeux, il aime les villes nocturnes et les endroits sombres, et son monde sâ€™appelle Â« Lenfer Â». Quand il en parle, certains pensent quâ€™il cherche juste Ã  provoquer. En rÃ©alitÃ©, Thomas explique que lâ€™obscuritÃ© lâ€™aide Ã  organiser ses idÃ©es : dans un dÃ©cor simple, il voit mieux les dÃ©tails.

Un jour, pendant une prÃ©paration, Red a demandÃ© Ã  Thomas dâ€™Ã©crire une rÃ©ponse courte, claire, et structurÃ©e. Thomas a commencÃ© avec une phrase trÃ¨s dramatique, comme sâ€™il Ã©crivait une scÃ¨ne. Luke a levÃ© les yeux : pour lui, la beautÃ© doit rester au service de la prÃ©cision. Shireen a proposÃ© un compromis : garder le style, mais contrÃ´ler la structure.

Thomas a acceptÃ©. Il a gardÃ© une image forte, puis il a ajoutÃ© des connecteurs et des preuves. Red a remarquÃ© quelque chose dâ€™important : Thomas travaille mieux quand il a le droit dâ€™Ãªtre lui-mÃªme, tant quâ€™il respecte la consigne. Le vrai dÃ©fi nâ€™est pas de supprimer son univers ; câ€™est de le traduire en arguments.

Ã€ la fin, Thomas a dit que lâ€™Ã©criture ressemble Ã  son monde : si on met trop dâ€™Ã©lÃ©ments, on se perd ; si on choisit bien, on construit une atmosphÃ¨re et une logique. Red a rÃ©pondu que câ€™est exactement Ã§a : une atmosphÃ¨re peut exister, mais la note dÃ©pend de la clartÃ©.`,
    questions:[
      {id:"P12_q1", type:"mcq", marks:2,
        prompt:"1) Pourquoi Thomas dit-il que lâ€™obscuritÃ© lâ€™aide ?",
        options:[
          "Parce quâ€™il nâ€™aime pas travailler",
          "Parce quâ€™un dÃ©cor simple lâ€™aide Ã  voir les dÃ©tails",
          "Parce quâ€™il veut empÃªcher les autres de lire",
          "Parce quâ€™il refuse les connecteurs"
        ],
        answerIndex:1
      },
      {id:"P12_q2", type:"tfnm", marks:2,
        prompt:"2) Red veut supprimer totalement lâ€™univers de Thomas. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P12_q3", type:"pn", marks:2,
        prompt:"3) Le style dramatique de Thomas est prÃ©sentÃ© commeâ€¦ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P12_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« compromis Â» (mÃªme mot).",
        acceptable:["compromis"]
      },
      {id:"P12_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« atmosphÃ¨re Â» (mÃªme mot) ?",
        acceptable:["atmosphÃ¨re","atmosphere"]
      },
      {id:"P12_q6", type:"short", marks:6,
        prompt:"6) Explique deux idÃ©es du â€œcompromisâ€ proposÃ© Ã  Thomas (deux idÃ©es).",
        rubric:"Garder style/image ; contrÃ´ler structure ; ajouter connecteurs ; ajouter preuves ; respecter consigne.",
        keywords:[
          ["garder","style","image"],
          ["structure","control","contrÃ´l"],
          ["connecteurs"],
          ["preuves","preuve"],
          ["consigne","respect"]
        ]
      }
    ]
  },

  /* -------------------- P13 (Wyatt) -------------------- */
  {
    id:"P13",
    titre:"Passage P13 â€” Wyatt, les dÃ©tails Ã©vitables et la discipline",
    theme:"Otono Team â€” Habitudes, rÃ¨gles, efficacitÃ©",
    texte:`Wyatt est connu pour deux choses : il mange souvent des Doritos, et il dÃ©teste perdre des points pour une erreur Ã©vitable. Pour lui, le plus frustrant nâ€™est pas une idÃ©e difficile ; câ€™est un dÃ©tail simple quâ€™on aurait pu Ã©viter. Câ€™est pour cela quâ€™il suit les rÃ¨gles de prÃ©sentation avec une concentration presque mÃ©canique. Il dit que la discipline nâ€™est pas une obsession, câ€™est un bouclier.

Quand Red explique une pÃ©nalitÃ©, Wyatt nâ€™argumente pas longtemps. Il demande : Â« Quâ€™est-ce que je dois faire la prochaine fois ? Â». Luke apprÃ©cie cette attitude, parce quâ€™elle transforme la correction en plan dâ€™action. Pourtant, Wyatt nâ€™est pas parfait : quand il est fatiguÃ©, il peut Ã©crire trop vite, et une phrase devient moins claire. Red lui rappelle alors que la vitesse doit rester lisible, sinon elle se retourne contre lui.

Dans une sÃ©ance, Wyatt a vu Joshua plaisanter sur le â€œviolet foncÃ©â€. Il a ri, mais il a ajoutÃ© une phrase sÃ©rieuse : Â« Fais ce que tu veux, mais moi je ne donne pas des points au hasard Â». Red a compris que Wyatt nâ€™est pas dur pour Ãªtre dur. Il est dur parce quâ€™il veut une note qui reprÃ©sente vraiment ce quâ€™il sait.

Au final, Wyatt rÃ©sume son approche en une idÃ©e : si le systÃ¨me est clair, on peut Ãªtre libre Ã  lâ€™intÃ©rieur. Les rÃ¨gles sont les murs ; lâ€™argument est la piÃ¨ce quâ€™on construit.`,
    questions:[
      {id:"P13_q1", type:"mcq", marks:2,
        prompt:"1) Pour Wyatt, la discipline sert surtout Ã â€¦",
        options:[
          "faire plaisir Ã  Red",
          "protÃ©ger contre les erreurs Ã©vitables",
          "empÃªcher toute libertÃ©",
          "remplacer le travail"
        ],
        answerIndex:1
      },
      {id:"P13_q2", type:"tfnm", marks:2,
        prompt:"2) Wyatt aime perdre des points pour un dÃ©tail simple. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P13_q3", type:"pn", marks:2,
        prompt:"3) Les rÃ¨gles sont prÃ©sentÃ©es commeâ€¦ (P / N / P+N)",
        correct:"P+N"
      },
      {id:"P13_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« bouclier Â» (mÃªme mot).",
        acceptable:["bouclier"]
      },
      {id:"P13_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« plan Â» (dans lâ€™expression â€œplan dâ€™actionâ€) ? (un mot)",
        acceptable:["plan"]
      },
      {id:"P13_q6", type:"short", marks:6,
        prompt:"6) Donne deux idÃ©es qui montrent que Wyatt veut une note â€œreprÃ©sentativeâ€ (deux idÃ©es).",
        rubric:"Ã‰viter erreurs Ã©vitables ; correction = plan dâ€™action ; pas au hasard ; note reprÃ©sente savoir ; clartÃ© du systÃ¨me.",
        keywords:[
          ["erreur","evitable","Ã©vitable"],
          ["plan d action","plan dâ€™action","prochaine fois"],
          ["pas au hasard","hasard"],
          ["represente","reprÃ©sente","sait","savoir"],
          ["systeme clair","systÃ¨me clair","clair"]
        ]
      }
    ]
  },

  /* -------------------- P14 (Karlito / Kiara) -------------------- */
  {
    id:"P14",
    titre:"Passage P14 â€” Karlito, Kiara et la confiance en soi",
    theme:"Otono Team â€” Respect, identitÃ©, atmosphÃ¨re de groupe",
    texte:`Karlito a une prÃ©sence particuliÃ¨re : il est capable de changer lâ€™ambiance dâ€™une piÃ¨ce simplement en entrant. Parfois, il utilise aussi le prÃ©nom Kiara, et cela surprend des gens au dÃ©but. Red a remarquÃ© que cette surprise peut crÃ©er deux rÃ©actions : la curiositÃ© respectueuse, ou le jugement rapide. Dans lâ€™Otono Team, Red insiste sur une rÃ¨gle simple : on respecte les personnes avant de commenter leurs choix.

Lors dâ€™une sÃ©ance, Karlito est arrivÃ© avec une Ã©nergie calme. Il a demandÃ© une chose prÃ©cise : Â« Corrige-moi sur le contenu, pas sur le reste Â». Luke a compris immÃ©diatement : la copie doit Ãªtre un espace neutre, oÃ¹ la qualitÃ© de la langue compte plus que la peur du regard des autres. Shireen a ajoutÃ© que la confiance se construit aussi avec des dÃ©tails : une remarque claire, un ton stable, et des critÃ¨res identiques.

Pourtant, Karlito a admis quâ€™il nâ€™est pas toujours Ã  lâ€™aise. Quand on se sent observÃ©, on Ã©crit moins librement. Red a rÃ©pondu que câ€™est justement pour cela que les rÃ¨gles doivent Ãªtre cohÃ©rentes : elles protÃ¨gent lâ€™Ã©lÃ¨ve contre les commentaires inutiles. La copie devient alors une preuve de compÃ©tence, pas un objet de jugement social.

Ã€ la fin, Karlito a dit une phrase simple : Â« Quand je me sens respectÃ©, jâ€™Ã©cris mieux Â». Red a notÃ© cette idÃ©e, car elle lie le respect Ã  la performance : pas comme une excuse, mais comme une condition pour faire son vrai travail.`,
    questions:[
      {id:"P14_q1", type:"mcq", marks:2,
        prompt:"1) Quelle rÃ¨gle Red rappelle-t-il dans ce passage ?",
        options:[
          "On doit tout commenter",
          "On respecte les personnes avant de commenter leurs choix",
          "On interdit les sÃ©ances de rÃ©vision",
          "On supprime les critÃ¨res"
        ],
        answerIndex:1
      },
      {id:"P14_q2", type:"tfnm", marks:2,
        prompt:"2) Karlito demande quâ€™on le corrige sur le contenu. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Vrai"
      },
      {id:"P14_q3", type:"pn", marks:2,
        prompt:"3) La cohÃ©rence des rÃ¨gles est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
        correct:"P"
      },
      {id:"P14_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« jugement Â» (mÃªme mot).",
        acceptable:["jugement","juger"]
      },
      {id:"P14_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« critÃ¨res Â» (mÃªme mot) ?",
        acceptable:["critÃ¨res","criteres"]
      },
      {id:"P14_q6", type:"short", marks:6,
        prompt:"6) Explique deux raisons pour lesquelles des rÃ¨gles cohÃ©rentes peuvent â€œprotÃ©gerâ€ un Ã©lÃ¨ve, selon le texte.",
        rubric:"Contre commentaires inutiles ; espace neutre ; critÃ¨res identiques ; preuve de compÃ©tence ; moins de peur.",
        keywords:[
          ["commentaires inutiles","inutile"],
          ["espace neutre","neutre"],
          ["criteres identiques","critÃ¨res identiques","identiques"],
          ["preuve","competence","compÃ©tence"],
          ["peur","observÃ©","observe","observÃ©"]
        ]
      }
    ]
  },

  /* -------------------- P15 (Angus Drummond) -------------------- */
  {
    id:"P15",
    titre:"Passage P15 â€” Angus Drummond et la haine des approximations",
    theme:"Lâ€™Encroyable Drummond â€” CohÃ©rence, preuves, remarques",
    texte:`Angus Drummond nâ€™a pas peur dâ€™une mauvaise note. Ce quâ€™il dÃ©teste, câ€™est une note floue. Pour lui, une correction doit Ãªtre une dÃ©monstration : chaque point doit avoir une raison visible. Quand Red parle de â€œremarqueâ€, Angus nâ€™y voit pas une chance de gagner des points ; il y voit une chance de rendre la dÃ©cision cohÃ©rente.

Un jour, Angus a demandÃ© Ã  Red de montrer la preuve de deux points. Red a acceptÃ©, mais il a posÃ© une condition : Â« Si je justifie, tu acceptes le rÃ©sultat Â». Angus a rÃ©pondu oui. Luke a trouvÃ© cet Ã©change logique : câ€™est un contrat de clartÃ©. Clayton, lui, trouvait cela trop froid ; il prÃ©fÃ©rerait une correction plus â€œgentilleâ€. Mais Angus considÃ¨re que la gentillesse sans exactitude est une trahison.

Pendant la relecture, Red a montrÃ© les critÃ¨res, la consigne, puis les phrases exactes de la copie. Angus a approuvÃ© quand câ€™Ã©tait solide, et il a insistÃ© quand câ€™Ã©tait fragile. Ã€ la fin, la note nâ€™a pas changÃ© beaucoup, mais la discussion a changÃ© tout le reste : elle a supprimÃ© le doute. Red a conclu que câ€™est parfois la meilleure utilitÃ© dâ€™une remarque : pas modifier la note, mais rendre la note impossible Ã  contester.

AprÃ¨s cela, Angus a dit quâ€™il continuerait Ã  Ã©crire uniquement en encre noire. Pas par obsession, mais parce quâ€™il veut que la copie ressemble Ã  ce quâ€™il respecte : une preuve nette.`,
    questions:[
      {id:"P15_q1", type:"mcq", marks:2,
        prompt:"1) Quâ€™est-ce quâ€™Angus dÃ©teste le plus ?",
        options:[
          "Une note floue",
          "Une copie courte",
          "Une remarque",
          "Une rÃ¨gle claire"
        ],
        answerIndex:0
      },
      {id:"P15_q2", type:"tfnm", marks:2,
        prompt:"2) Angus voit la remarque comme un cadeau pour gagner des points. (Vrai / Faux / Non mentionnÃ©)",
        correct:"Faux"
      },
      {id:"P15_q3", type:"pn", marks:2,
        prompt:"3) La â€œgentillesse sans exactitudeâ€ est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
        correct:"N"
      },
      {id:"P15_q4", type:"syn", marks:4,
        prompt:"4) Trouve dans le texte un mot qui signifie Â« dÃ©monstration Â» (mÃªme mot).",
        acceptable:["dÃ©monstration","demonstration"]
      },
      {id:"P15_q5", type:"match", marks:4,
        prompt:"5) Dans le texte, quel mot signifie Â« doute Â» (mÃªme mot) ?",
        acceptable:["doute"]
      },
      {id:"P15_q6", type:"short", marks:6,
        prompt:"6) Donne deux raisons pour lesquelles la remarque est utile, selon ce passage.",
        rubric:"Rendre dÃ©cision cohÃ©rente ; montrer preuves/critÃ¨res ; supprimer le doute ; rendre la note difficile Ã  contester ; clarifier.",
        keywords:[
          ["coherent","cohÃ©rent","cohÃ©rence","coherente","cohÃ©rente"],
          ["preuve","preuves","criteres","critÃ¨res","consigne"],
          ["supprimer","doute"],
          ["impossible a contester","impossible Ã  contester","contester"],
          ["clarifier","claire","clartÃ©"]
        ]
      }
    ]
  },
  {
  id:"P17",
  titre:"Passage P17 â€” Le chronomÃ¨tre et la panique",
  theme:"Otono Team â€” Gestion du temps et mÃ©thode",
  texte:`Le jour oÃ¹ Red a introduit un chronomÃ¨tre officiel, lâ€™ambiance a changÃ©. Ce nâ€™Ã©tait pas un simple minuteur : câ€™Ã©tait un cadre. Red a expliquÃ© que le temps nâ€™est pas un ennemi, mais un filtre. Si une idÃ©e est solide, elle rÃ©siste Ã  la pression ; si elle est fragile, elle se casse dÃ¨s quâ€™on accÃ©lÃ¨re.

Au dÃ©but, Wyatt a paniquÃ©. Il nâ€™aimait pas voir les minutes disparaÃ®tre, comme si elles Ã©taient perdues pour toujours. Luke, lui, nâ€™a pas paniquÃ© : il a simplement classÃ©. Il a divisÃ© la feuille en blocs, a notÃ© les consignes en marge, puis il a rÃ©pondu. OWing a fait ce quâ€™il fait toujours : il est parti vite, mais Red a exigÃ© une justification par Ã©tape.

Jessica a rÃ©sumÃ© la situation avec une phrase simple : Â« La vitesse nâ€™est pas la mÃªme chose que la prÃ©cipitation Â». Red a approuvÃ©. Il a ajoutÃ© que le chronomÃ¨tre nâ€™est pas lÃ  pour punir ; il sert Ã  rÃ©vÃ©ler la mÃ©thode. Quand la sÃ©ance sâ€™est terminÃ©e, certains Ã©taient frustrÃ©s, mais une chose Ã©tait claire : ceux qui avaient une structure se sentaient plus calmes.`,
  questions:[
    {id:"P17_q1", type:"mcq", marks:2,
      prompt:"1) Pour Red, le chronomÃ¨tre sert surtout Ã â€¦",
      options:["faire peur Ã  tout le monde","rÃ©vÃ©ler la mÃ©thode sous pression","annuler les consignes","donner des points gratuits"],
      answerIndex:1
    },
    {id:"P17_q2", type:"tfnm", marks:2,
      prompt:"2) Red dit que le temps est un ennemi. (Vrai / Faux / Non mentionnÃ©)",
      correct:"Faux"
    },
    {id:"P17_q3", type:"pn", marks:2,
      prompt:"3) Le chronomÃ¨tre est prÃ©sentÃ© commeâ€¦ (P / N / P+N)",
      correct:"P+N"
    },
    {id:"P17_q4", type:"syn", marks:3,
      prompt:"4) Trouve dans le texte un mot qui signifie Â« contexte fixÃ© / cadre Â» (un mot).",
      acceptable:["cadre"]
    },
    {id:"P17_q5", type:"match", marks:3,
      prompt:"5) Dans le texte, quel mot signifie Â« trop vite et mal Â» (un mot du texte) ?",
      acceptable:["prÃ©cipitation","precipitation"]
    },
    {id:"P17_q6", type:"short", marks:4,
      prompt:"6) Donne deux actions concrÃ¨tes de Luke qui montrent sa mÃ©thode (deux idÃ©es).",
      rubric:"Diviser en blocs ; noter les consignes en marge ; rÃ©pondre avec ordre/structure.",
      keywords:[
        ["divis","blocs"],
        ["consigne","marge"],
        ["class","structure","ordre"]
      ]
    },
    {id:"P17_q7", type:"short", marks:4,
      prompt:"7) Pourquoi certaines personnes se sentent-elles plus calmes Ã  la fin ? (deux idÃ©es)",
      rubric:"Structure ; mÃ©thode solide ; organisation ; consignes claires ; pression mieux gÃ©rÃ©e.",
      keywords:[
        ["structure","organis","ordre"],
        ["methode","mÃ©thode","solide"],
        ["consigne","clair"],
        ["pression","gÃ©rer","resiste","rÃ©siste"]
      ]
    }
  ]
},

/* -------------------- P18 (8 questions, total = 20) -------------------- */
{
  id:"P18",
  titre:"Passage P18 â€” Le piÃ¨ge des langues mÃ©langÃ©es",
  theme:"Lâ€™Encroyable Drummond â€” Consignes, langues, pÃ©nalitÃ©s",
  texte:`Pendant une sÃ©ance de langues, Red a repÃ©rÃ© un problÃ¨me quâ€™il dÃ©teste : le mÃ©lange. Certains candidats commenÃ§aient une phrase en franÃ§ais, glissaient un mot anglais, puis terminaient en espagnol. Red a levÃ© la main : Â« Stop. Ici, ce nâ€™est pas un brouillon. Tu choisis une langue et tu la respectes Â». Il a expliquÃ© que, sinon, on ne sait plus si on Ã©value la connaissance ou la chance.

Shireen a compris immÃ©diatement : elle a relu ses rÃ©ponses et elle a corrigÃ© les transitions. Thomas, lui, a soupirÃ© : il trouvait la rÃ¨gle dure, mais il a reconnu que câ€™Ã©tait logique. Luke a ajoutÃ© un dÃ©tail : mÃªme une bonne idÃ©e peut perdre de la valeur si la consigne nâ€™est pas respectÃ©e.

Red a notÃ© â€œpÃ©nalitÃ© de langueâ€ dans la marge dâ€™une copie, mais il nâ€™a pas humiliÃ© le candidat. Il a insistÃ© : Â« Je punis la rÃ¨gle, pas la personne Â». Ensuite, il a donnÃ© une solution : relire Ã  voix basse, repÃ©rer les mots intrus, puis reformuler. Ã€ la fin, lâ€™ambiance Ã©tait plus calme, parce que la rÃ¨gle Ã©tait devenue claire et applicable.`,
  questions:[
    {id:"P18_q1", type:"mcq", marks:2,
      prompt:"1) Quel problÃ¨me Red dÃ©teste-t-il ici ?",
      options:["les rÃ©ponses trop longues","le mÃ©lange des langues","les stylos noirs","les feuilles blanches"],
      answerIndex:1
    },
    {id:"P18_q2", type:"tfnm", marks:2,
      prompt:"2) Red dit quâ€™un mÃ©lange de langues aide Ã  Ã©valuer la connaissance. (Vrai / Faux / Non mentionnÃ©)",
      correct:"Faux"
    },
    {id:"P18_q3", type:"pn", marks:2,
      prompt:"3) La rÃ¨gle est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
      correct:"P+N"
    },
    {id:"P18_q4", type:"syn", marks:2,
      prompt:"4) Trouve dans le texte un mot qui signifie Â« chance Â» (mÃªme mot).",
      acceptable:["chance"]
    },
    {id:"P18_q5", type:"match", marks:2,
      prompt:"5) Dans le texte, quel mot signifie Â« calmer / plus tranquille Â» ? (un mot du texte)",
      acceptable:["calme","calmer"]
    },
    {id:"P18_q6", type:"short", marks:3,
      prompt:"6) Donne une raison pour laquelle le mÃ©lange empÃªche une bonne Ã©valuation (une idÃ©e).",
      rubric:"On ne sait plus si câ€™est connaissance ou chance ; consigne non respectÃ©e ; confusion.",
      keywords:[
        ["connaissance","evaluer","Ã©valuer"],
        ["chance"],
        ["consigne","respect"]
      ]
    },
    {id:"P18_q7", type:"short", marks:3,
      prompt:"7) Quelle solution Red propose-t-il pour Ã©viter les mots intrus ? (deux Ã©tapes)",
      rubric:"Relire Ã  voix basse ; repÃ©rer les mots intrus ; reformuler.",
      keywords:[
        ["relire","voix basse"],
        ["repÃ©rer","intrus"],
        ["reformuler"]
      ]
    },
    {id:"P18_q8", type:"short", marks:4,
      prompt:"8) Explique lâ€™idÃ©e : Â« Je punis la rÃ¨gle, pas la personne Â» (deux idÃ©es).",
      rubric:"Sanctionner la consigne ; Ã©viter lâ€™humiliation ; rester juste ; sÃ©parer erreur et identitÃ©.",
      keywords:[
        ["regle","rÃ¨gle","consigne"],
        ["humili","humiliation"],
        ["juste","justice"],
        ["personne","identit","identitÃ©"]
      ]
    }
  ]
},

/* -------------------- P19 (5 questions, total = 20) -------------------- */
{
  id:"P19",
  titre:"Passage P19 â€” Joshua et la motivation invisible",
  theme:"Otono Team â€” Motivation, habitudes, progression",
  texte:`Joshua nâ€™est pas celui qui parle le plus pendant les rÃ©visions, mais il observe tout. Un jour, Red lui a demandÃ© pourquoi il restait jusquâ€™Ã  la fin alors que personne ne lâ€™obligeait. Joshua a rÃ©pondu simplement : il aime voir une progression. Pour lui, la motivation nâ€™est pas un discours ; câ€™est une habitude.

Luke a trouvÃ© cette rÃ©ponse intÃ©ressante. Il a dit que la motivation Â« invisible Â» se voit dans les dÃ©tails : la rÃ©gularitÃ©, la relecture, et la capacitÃ© Ã  corriger sans se vexer. OWing a rigolÃ© : il prÃ©fÃ¨re une motivation qui donne des rÃ©sultats rapides. Jessica a tranchÃ© : les deux existent, et la vraie force est de savoir quand utiliser lâ€™une ou lâ€™autre.

Red a conclu que la motivation se construit comme une preuve : on la voit dans ce quâ€™on rÃ©pÃ¨te, pas dans ce quâ€™on promet. Cette idÃ©e a surpris plusieurs personnes, parce quâ€™elle rendait la discipline plus simple : il suffisait de recommencer correctement.`,
  questions:[
    {id:"P19_q1", type:"mcq", marks:4,
      prompt:"1) Pourquoi Joshua reste-t-il jusquâ€™Ã  la fin ?",
      options:["Parce quâ€™il a peur de Red","Parce quâ€™il aime voir une progression","Parce quâ€™il veut toujours comparer les notes","Parce quâ€™il dÃ©teste les habitudes"],
      answerIndex:1
    },
    {id:"P19_q2", type:"tfnm", marks:4,
      prompt:"2) Le texte dit que la motivation est surtout un discours. (Vrai / Faux / Non mentionnÃ©)",
      correct:"Faux"
    },
    {id:"P19_q3", type:"syn", marks:4,
      prompt:"3) Trouve dans le texte un mot qui signifie Â« constance Â» (un mot du texte).",
      acceptable:["rÃ©gularitÃ©","regularite"]
    },
    {id:"P19_q4", type:"match", marks:4,
      prompt:"4) Dans le texte, quel mot signifie Â« preuve Â» (mÃªme mot) ?",
      acceptable:["preuve"]
    },
    {id:"P19_q5", type:"short", marks:4,
      prompt:"5) Donne deux exemples de Â« dÃ©tails Â» qui montrent la motivation selon Luke.",
      rubric:"RÃ©gularitÃ© ; relecture ; corriger sans se vexer ; habitudes.",
      keywords:[
        ["regulier","rÃ©gulier","rÃ©gularitÃ©","regularite"],
        ["relecture","relire"],
        ["corriger","correction"],
        ["se vexer","vexer","sans se vexer"]
      ]
    }
  ]
},

/* -------------------- P20 (7 questions, total = 20) -------------------- */
{
  id:"P20",
  titre:"Passage P20 â€” Lâ€™Ã©chelle de sÃ©vÃ©ritÃ©",
  theme:"Lâ€™Encroyable Drummond â€” BarÃ¨mes, cohÃ©rence, justice",
  texte:`Quand Red a annoncÃ© quâ€™il allait rendre son barÃ¨me plus sÃ©vÃ¨re, certains ont cru quâ€™il voulait simplement faire mal. Il a rÃ©pondu que la sÃ©vÃ©ritÃ© nâ€™a de valeur que si elle est cohÃ©rente. Un barÃ¨me trop gentil ment ; un barÃ¨me trop dur Ã©crase. Le bon barÃ¨me, selon Red, crÃ©e une vÃ©ritÃ© utilisable : il montre ce qui marche et ce qui manque.

Angus Drummond a approuvÃ©, mais il a posÃ© une condition : Â« Alors tu justifies chaque point Â». Red a acceptÃ©. Il a expliquÃ© quâ€™il utilisait une Ã©chelle : dâ€™abord la consigne, ensuite la preuve, puis la prÃ©cision. Une rÃ©ponse peut Ãªtre brillante, mais si elle sort du sujet, elle perd sa base. Luke a insistÃ© sur un dÃ©tail : la sÃ©vÃ©ritÃ© nâ€™est pas un style, câ€™est une mÃ©thode.

Ã€ la fin, Red a Ã©crit une phrase sur le tableau : Â« La justice, câ€™est la mÃªme rÃ¨gle pour tous Â». Cette phrase a calmÃ© plusieurs personnes, parce quâ€™elle transformait la peur en logique.`,
  questions:[
    {id:"P20_q1", type:"mcq", marks:2,
      prompt:"1) Pour Red, un barÃ¨me â€œtrop gentilâ€ fait quoi ?",
      options:["Il ment","Il protÃ¨ge tout le monde","Il augmente la prÃ©cision","Il supprime les consignes"],
      answerIndex:0
    },
    {id:"P20_q2", type:"tfnm", marks:2,
      prompt:"2) Red dit quâ€™un barÃ¨me trop dur est toujours juste. (Vrai / Faux / Non mentionnÃ©)",
      correct:"Faux"
    },
    {id:"P20_q3", type:"pn", marks:2,
      prompt:"3) La sÃ©vÃ©ritÃ© est prÃ©sentÃ©e commeâ€¦ (P / N / P+N)",
      correct:"P+N"
    },
    {id:"P20_q4", type:"syn", marks:3,
      prompt:"4) Trouve dans le texte un mot qui signifie Â« cohÃ©rent(e) Â» (mÃªme mot).",
      acceptable:["cohÃ©rente","coherent","cohÃ©rente","coherence","cohÃ©rence","cohÃ©rente"]
    },
    {id:"P20_q5", type:"match", marks:3,
      prompt:"5) Dans le texte, quel mot signifie Â« condition Â» ? (un mot du texte)",
      acceptable:["condition"]
    },
    {id:"P20_q6", type:"short", marks:4,
      prompt:"6) Donne deux Ã©lÃ©ments de lâ€™Ã©chelle de Red (dans lâ€™ordre ou pas).",
      rubric:"Consigne ; preuve ; prÃ©cision.",
      keywords:[
        ["consigne"],
        ["preuve","preuves"],
        ["precision","prÃ©cision"]
      ]
    },
    {id:"P20_q7", type:"short", marks:4,
      prompt:"7) Pourquoi la phrase sur la justice calme-t-elle des personnes ? (deux idÃ©es)",
      rubric:"MÃªme rÃ¨gle pour tous ; logique ; cohÃ©rence ; peur transformÃ©e en cadre clair.",
      keywords:[
        ["meme regle","mÃªme rÃ¨gle","tous"],
        ["logique"],
        ["coher","cohÃ©r"],
        ["peur","calm","cadre"]
      ]
    }
  ]
},
];


/* =========================================================
   MINI-ESSAIS (rÃ©ponse ~90 mots)
   - 20 points
   - Le passage fourni est long (comme les autres), mais la rÃ©ponse attendue est courte.
========================================================= */

const ESSAYS = [
  {
    id:"E_P1",
    passageId:"P1",
    titre:"Mini-essai â€” Les enveloppes violettes : utile ou stressant ?",
    passage:`Certains pensent que lâ€™enveloppe violette est une idÃ©e brillante : elle rend la correction transparente et permet de comprendre les erreurs. Dâ€™autres disent que cela augmente la pression, car la copie originale ressemble Ã  un jugement. Red insiste pourtant sur une chose : on apprend mieux quand on accepte ce qui est Ã©crit, puis quâ€™on dÃ©cide ce quâ€™on va amÃ©liorer.`,
    consigne:`RÃ©dige environ 90 mots. Dans quelle mesure lâ€™enveloppe violette aide-t-elle lâ€™apprentissage ? Donne un argument Â« pour Â», un argument Â« contre Â», puis une conclusion courte.`,
    structureAnchors:[
      ["pour commencer","dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche","nÃ©anmoins"],
      ["en conclusion","pour conclure","finalement","en somme"]
    ],
    ideaGroups:[
      ["transparent","transparence","preuve","verifiable","vÃ©rifiable","traÃ§abilite","traÃ§abilitÃ©"],
      ["pression","stressant","stress","jugement"],
      ["apprendre","comprendre","erreurs","amÃ©liorer","ameliorer"],
      ["pour","utile","aide","aider"],
      ["contre","inconvenient","inconvÃ©nient","fatigue"]
    ],
    connectors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche"],
      ["donc","ainsi","par consÃ©quent"],
      ["en conclusion","pour conclure","finalement"]
    ],
    modelAnswer:
`Dâ€™abord, lâ€™enveloppe violette aide parce quâ€™elle rend la correction transparente : on voit le dÃ©tail et on peut comprendre ses erreurs. Cela donne une preuve claire et Ã©vite les disputes. Cependant, elle peut aussi augmenter la pression : la copie originale ressemble Ã  un jugement et certains se sentent bloquÃ©s. En conclusion, elle aide dans la mesure oÃ¹ le candidat accepte la copie comme un point de dÃ©part : on observe, on apprend, puis on amÃ©liore pour la prochaine fois.`
  },

  {
    id:"E_P2",
    passageId:"P2",
    titre:"Mini-essai â€” La rÃ¨gle de lâ€™encre noire : juste ou trop stricte ?",
    passage:`Dans lâ€™Otono Team, lâ€™encre noire est obligatoire. Red justifie la rÃ¨gle par la lisibilitÃ© et lâ€™Ã©galitÃ© des conditions. Pourtant, une rÃ¨gle stricte peut frustrer : on peut perdre des points sans que lâ€™idÃ©e soit mauvaise. La question est donc de savoir si la rÃ¨gle protÃ¨ge le rÃ©sultatâ€¦ ou si elle Ã©crase inutilement le candidat.`,
    consigne:`RÃ©dige environ 90 mots. La rÃ¨gle est-elle surtout positive ? Appuie-toi sur le passage, et finis par une conclusion claire.`,
    structureAnchors:[
      ["pour commencer","dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche","nÃ©anmoins"],
      ["en conclusion","pour conclure","finalement","en somme"]
    ],
    ideaGroups:[
      ["lisibilite","lisibilitÃ©","clair","clartÃ©","clarte"],
      ["egalite","Ã©galitÃ©","conditions identiques","justice"],
      ["penalite","pÃ©nalitÃ©","retirer","points"],
      ["frustrant","frustration","trop stricte","rigide"],
      ["valeur du resultat","valeur du rÃ©sultat","proteger","protÃ©ger"]
    ],
    connectors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche"],
      ["donc","ainsi","par consÃ©quent"],
      ["en conclusion","pour conclure","finalement"]
    ],
    modelAnswer:
`Dâ€™abord, la rÃ¨gle de lâ€™encre noire est positive car elle protÃ¨ge la lisibilitÃ© et lâ€™Ã©galitÃ© des conditions : tout le monde est jugÃ© de la mÃªme faÃ§on. Cela renforce la confiance dans le rÃ©sultat. Cependant, elle peut sembler trop stricte, car une pÃ©nalitÃ© peut faire perdre des points mÃªme si lâ€™idÃ©e est bonne. En conclusion, la rÃ¨gle est utile si elle reste proportionnÃ©e : elle doit protÃ©ger la valeur du rÃ©sultat sans Ã©craser inutilement le candidat.`
  },

  {
    id:"E_P4",
    passageId:"P4",
    titre:"Mini-essai â€” Comparer les notes : motivation ou piÃ¨ge ?",
    passage:`AprÃ¨s les rÃ©sultats, certains candidats comparent leurs scores. Cela peut donner un repÃ¨re, mais cela peut aussi transformer la progression en compÃ©tition permanente. Red insiste : une note nâ€™est pas une identitÃ©, câ€™est un rÃ©sultat Ã  un moment donnÃ©. Lâ€™objectif devrait Ãªtre dâ€™apprendre, pas de se mesurer sans fin.`,
    consigne:`RÃ©dige environ 90 mots. La comparaison aide-t-elle vraiment ? Donne une rÃ©ponse nuancÃ©e.`,
    structureAnchors:[
      ["pour commencer","dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche","nÃ©anmoins"],
      ["en conclusion","pour conclure","finalement","en somme"]
    ],
    ideaGroups:[
      ["repere","repÃ¨re","comprendre","clarifier"],
      ["competition","compÃ©tition","permanente","pression"],
      ["progres","progrÃ¨s","progression"],
      ["identite","identitÃ©","resultat","rÃ©sultat"],
      ["nuance","nuancÃ©","dans une certaine mesure","equilibre","Ã©quilibre"]
    ],
    connectors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche"],
      ["donc","ainsi","par consÃ©quent"],
      ["en conclusion","pour conclure","finalement"]
    ],
    modelAnswer:
`Dâ€™abord, comparer les notes peut aider : cela donne un repÃ¨re et peut clarifier si une mÃ©thode fonctionne. Pourtant, la comparaison devient vite un piÃ¨ge : elle transforme la progression en compÃ©tition et augmente la pression. On risque alors dâ€™oublier que la note nâ€™est pas une identitÃ©, mais un rÃ©sultat Ã  un moment prÃ©cis. En conclusion, comparer peut servir seulement dans une certaine mesure : il faut surtout analyser sa propre copie et viser le progrÃ¨s.`
  },
  {
    id:"E_P5",
    passageId:"P5",
    titre:"Mini-essai â€” Vitesse et qualitÃ© : OWing a-t-il raison ?",
    passage:`OWing travaille vite et va droit au but. Red admire cette Ã©nergie, mais il rappelle que la vitesse peut donner lâ€™illusion de maÃ®triser. Quand une nuance de consigne apparaÃ®t, il faut ralentir, relire, puis justifier.`,
    consigne:`RÃ©dige environ 90 mots. La vitesse est-elle un avantage dans une Ã©preuve ? Donne un argument Â« pour Â», un argument Â« contre Â», puis une conclusion courte.`,
    structureAnchors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche","nÃ©anmoins"],
      ["en conclusion","pour conclure","finalement","en somme"]
    ],
    ideaGroups:[
      ["vitesse","rapide","efficace","gagner du temps"],
      ["illusion","maitriser","maÃ®triser","comprendre"],
      ["nuance","consigne","relire"],
      ["justifier","preuves","precision","prÃ©cision"],
      ["equilibre","Ã©quilibre","controle","contrÃ´le"]
    ],
    connectors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche"],
      ["donc","ainsi","par consÃ©quent"],
      ["en conclusion","pour conclure","finalement"]
    ],
    modelAnswer:
`Dâ€™abord, la vitesse peut Ãªtre un avantage : on gagne du temps et on rÃ©pond plus efficacement, comme OWing. Cela Ã©vite aussi de bloquer trop longtemps. Cependant, la vitesse peut crÃ©er une illusion de maÃ®trise : si une nuance de consigne apparaÃ®t, il faut relire et justifier, sinon la prÃ©cision chute. En conclusion, la vitesse est utile seulement avec contrÃ´le : on peut aller vite, mais on doit ralentir au moment des dÃ©tails pour garder la qualitÃ©.`
  },

  {
    id:"E_P6",
    passageId:"P6",
    titre:"Mini-essai â€” Lâ€™humour de Joshua : aide ou distraction ?",
    passage:`Joshua plaisante sur son â€œtrÃ¨s trÃ¨s trÃ¨s trÃ¨s trÃ¨s violet foncÃ©â€, mais il respecte finalement la rÃ¨gle. Red accepte lâ€™humour tant que la copie reste claire et que lâ€™objectif nâ€™est pas perdu.`,
    consigne:`RÃ©dige environ 90 mots. Dans quelle mesure lâ€™humour peut-il amÃ©liorer une sÃ©ance de travail ?`,
    structureAnchors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche","nÃ©anmoins"],
      ["en conclusion","pour conclure","finalement","en somme"]
    ],
    ideaGroups:[
      ["humour","blague","rire","detendre","dÃ©tendre"],
      ["tension","stress","respirer"],
      ["distraction","perdre l objectif","perdre lâ€™objectif"],
      ["regle","rÃ¨gle","respectee","respectÃ©e","copie claire"],
      ["equilibre","Ã©quilibre","mesure"]
    ],
    connectors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche"],
      ["donc","ainsi","par consÃ©quent"],
      ["en conclusion","pour conclure","finalement"]
    ],
    modelAnswer:
`Dâ€™abord, lâ€™humour peut aider : une blague comme celle de Joshua dÃ©tend lâ€™ambiance et empÃªche le stress de devenir une dispute. On respire mieux et on repart avec plus dâ€™Ã©nergie. Cependant, lâ€™humour peut aussi distraire : si on perd lâ€™objectif, la sÃ©ance devient du bruit. En conclusion, lâ€™humour est positif dans la mesure oÃ¹ la rÃ¨gle est respectÃ©e et oÃ¹ la copie reste claire : câ€™est un outil, pas un remplacement du travail.`
  },

  {
    id:"E_P7",
    passageId:"P7",
    titre:"Mini-essai â€” Style et prÃ©cision : peut-on garder lâ€™univers de Thomas ?",
    passage:`Thomas Ã©crit avec un style dramatique et un univers sombre. Shireen propose de garder lâ€™image, mais de contrÃ´ler la structure et dâ€™ajouter des preuves.`,
    consigne:`RÃ©dige environ 90 mots. Faut-il privilÃ©gier le style ou la clartÃ© dans une Ã©preuve ?`,
    structureAnchors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche","nÃ©anmoins"],
      ["en conclusion","pour conclure","finalement","en somme"]
    ],
    ideaGroups:[
      ["style","image","atmosphere","atmosphÃ¨re"],
      ["precision","prÃ©cision","clartÃ©","clair"],
      ["structure","connecteurs","preuves"],
      ["consigne","respecter"],
      ["compromis","equilibre","Ã©quilibre"]
    ],
    connectors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche"],
      ["donc","ainsi","par consÃ©quent"],
      ["en conclusion","pour conclure","finalement"]
    ],
    modelAnswer:
`Dâ€™abord, le style peut Ãªtre un atout : une image forte rend le texte vivant et peut mieux exprimer une idÃ©e, comme chez Thomas. Cependant, dans une Ã©preuve, la note dÃ©pend surtout de la clartÃ© : sans structure, connecteurs et preuves, le style devient confusion. En conclusion, il faut un compromis : garder une touche personnelle, mais contrÃ´ler la structure et respecter la consigne. Le style doit servir la prÃ©cision, pas la remplacer.`
  },

  {
    id:"E_P8",
    passageId:"P8",
    titre:"Mini-essai â€” Les rÃ¨gles comme â€œbouclierâ€ : la vision de Wyatt",
    passage:`Wyatt suit les rÃ¨gles car il dÃ©teste perdre des points pour un dÃ©tail Ã©vitable. Pour lui, la discipline protÃ¨ge la note et transforme la correction en plan dâ€™action.`,
    consigne:`RÃ©dige environ 90 mots. Les rÃ¨gles strictes rendent-elles lâ€™Ã©valuation plus juste ?`,
    structureAnchors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche","nÃ©anmoins"],
      ["en conclusion","pour conclure","finalement","en somme"]
    ],
    ideaGroups:[
      ["juste","justice","egalite","Ã©galitÃ©"],
      ["details evitables","dÃ©tails Ã©vitables","penalite","pÃ©nalitÃ©"],
      ["discipline","bouclier"],
      ["liberte","libertÃ©","a l interieur","Ã  lâ€™intÃ©rieur"],
      ["limites","trop strict","fatigue"]
    ],
    connectors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche"],
      ["donc","ainsi","par consÃ©quent"],
      ["en conclusion","pour conclure","finalement"]
    ],
    modelAnswer:
`Dâ€™abord, des rÃ¨gles strictes peuvent rendre lâ€™Ã©valuation plus juste : elles crÃ©ent des conditions identiques et Ã©vitent des dÃ©tails Ã©vitables qui faussent la note. Pour Wyatt, la discipline est un bouclier. Cependant, trop de rigiditÃ© peut fatiguer et pÃ©naliser mÃªme quand lâ€™idÃ©e est bonne. En conclusion, les rÃ¨gles sont utiles si elles restent proportionnÃ©es : elles doivent protÃ©ger la justice sans Ã©craser la libertÃ© dâ€™argumenter Ã  lâ€™intÃ©rieur du cadre.`
  },

  {
    id:"E_P9",
    passageId:"P9",
    titre:"Mini-essai â€” Une remarque pour changer la noteâ€¦ ou pour supprimer le doute ?",
    passage:`Angus Drummond veut une correction dÃ©montrable : preuves, critÃ¨res, consigne. Red montre que la remarque sert parfois surtout Ã  rendre la note impossible Ã  contester.`,
    consigne:`RÃ©dige environ 90 mots. Quel est, selon toi, le meilleur objectif dâ€™une remarque ?`,
    structureAnchors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche","nÃ©anmoins"],
      ["en conclusion","pour conclure","finalement","en somme"]
    ],
    ideaGroups:[
      ["preuves","criteres","critÃ¨res","consigne"],
      ["coherence","cohÃ©rence","clair","clartÃ©"],
      ["doute","contester"],
      ["changer la note","modifier la note"],
      ["objectif","meilleur","utile"]
    ],
    connectors:[
      ["dâ€™abord","tout dâ€™abord"],
      ["cependant","pourtant","en revanche"],
      ["donc","ainsi","par consÃ©quent"],
      ["en conclusion","pour conclure","finalement"]
    ],
    modelAnswer:
`Dâ€™abord, une remarque peut servir Ã  changer la note si une erreur est prouvÃ©e. Cela protÃ¨ge le candidat. Cependant, le meilleur objectif est souvent de supprimer le doute : montrer les critÃ¨res, la consigne et les preuves rend la dÃ©cision cohÃ©rente et claire. MÃªme si la note change peu, la confiance augmente. En conclusion, une remarque utile nâ€™est pas forcÃ©ment celle qui â€œdonne des pointsâ€, mais celle qui rend la note dÃ©montrable et difficile Ã  contester.`
  }
];

/* =========================================================
   TRADUCTIONS (EN -> FR) : Otono Team / Lâ€™Encroyable Drummond
   20 points : 5 idÃ©es-clÃ©s Ã— 4
========================================================= */

const TRANSLATIONS_A = [
  {
    id:"T1",
    titre:"Traduction â€” La remarque",
    theme:"Lâ€™Encroyable Drummond",
    textEN:"During a remark, Red reads the paper again and explains every point. He says it is not a gift but a serious second reading. If he cannot justify a mark, he does not give it.",
    keyBundles:[
      ["pendant une remarque","lors d une remarque","lors dâ€™une remarque"],
      ["relit","relire","lit a nouveau","lit Ã  nouveau","deuxieme lecture","seconde lecture"],
      ["explique","justifie","justifier","preuve","preuves"],
      ["pas un cadeau","ce n est pas un cadeau","ce nâ€™est pas un cadeau"],
      ["s il ne peut pas justifier","sâ€™il ne peut pas justifier","il ne donne pas","il ne la donne pas","il ne donne pas le point"]
    ],
    sampleFR:"Lors dâ€™une remarque, Red relit la copie et explique chaque point. Il dit que ce nâ€™est pas un cadeau, mais une seconde lecture sÃ©rieuse. Sâ€™il ne peut pas justifier un point, il ne le donne pas."
  },
  {
    id:"T2",
    titre:"Traduction â€” Enveloppe violette et transparence",
    theme:"Lâ€™Encroyable Drummond",
    textEN:"The purple envelope contains a detailed results sheet and the original paper. Candidates can look at it, but they cannot change it. If there is a penalty, Red writes the original score and the penalized score.",
    keyBundles:[
      ["enveloppe violette","enveloppes violettes"],
      ["feuille de resultats","feuille de rÃ©sultats","resultats detailles","rÃ©sultats dÃ©taillÃ©s"],
      ["copie originale","original paper","copie"],
      ["peuvent regarder","peuvent consulter","mais ne peuvent pas modifier","ne peuvent pas changer"],
      ["penalite","pÃ©nalitÃ©","score original","note originale","score penalise","score pÃ©nalisÃ©"]
    ],
    sampleFR:"Lâ€™enveloppe violette contient une feuille de rÃ©sultats dÃ©taillÃ©e et la copie originale. Les candidats peuvent la consulter, mais ils ne peuvent pas la modifier. En cas de pÃ©nalitÃ©, Red Ã©crit le score original et le score pÃ©nalisÃ©."
  },
  {
    id:"T3",
    titre:"Traduction â€” Comparaison",
    theme:"Otono Team",
    textEN:"Some people compare their scores to feel safer. But comparison can become a trap and turn progress into permanent competition. Red reminds everyone that a grade is not an identity.",
    keyBundles:[
      ["certaines personnes","quelques personnes"],
      ["comparent","comparaison","comparer leurs scores","leurs notes"],
      ["pour se sentir","securiser","plus en securite","plus en sÃ©curitÃ©"],
      ["piÃ¨ge","trap","competition permanente","compÃ©tition permanente","progres","progrÃ¨s"],
      ["une note n est pas une identite","une note nâ€™est pas une identitÃ©","pas une identite","pas une identitÃ©"]
    ],
    sampleFR:"Certaines personnes comparent leurs notes pour se sentir plus en sÃ©curitÃ©. Mais la comparaison peut devenir un piÃ¨ge et transformer le progrÃ¨s en compÃ©tition permanente. Red rappelle quâ€™une note nâ€™est pas une identitÃ©."
  },
   {
    id:"T4",
    titre:"Traduction â€” OWing et la vitesse",
    theme:"Otono Team",
    textEN:"OWing works fast and goes straight to the point. Red admires his energy, but he warns that speed can create the illusion of mastery. When a nuance appears in the instruction, OWing stops, rereads, and corrects his approach.",
    keyBundles:[
      ["owing travaille vite","owing va vite","owing est rapide"],
      ["va droit au but","direct","straight to the point"],
      ["red admire","red apprÃ©cie","red admire son Ã©nergie"],
      ["illusion de maÃ®triser","illusion de maÃ®trise","illusion de maitrise"],
      ["nuance","consigne","il s arrÃªte","il sâ€™arrÃªte","relit","corrige sa trajectoire","corrige son approche"]
    ],
    sampleFR:"OWing travaille vite et va droit au but. Red admire son Ã©nergie, mais il prÃ©vient que la vitesse peut crÃ©er une illusion de maÃ®trise. Quand une nuance apparaÃ®t dans la consigne, OWing sâ€™arrÃªte, relit et corrige son approche."
  },

  {
    id:"T5",
    titre:"Traduction â€” Le violet foncÃ© de Joshua",
    theme:"Otono Team",
    textEN:"Joshua jokes that he does not use black ink but a very, very, very, very, very dark purple. Red asks him calmly whether he wants a joke or a mark. In the end, Joshua uses a real black pen, and the atmosphere becomes less tense.",
    keyBundles:[
      ["joshua plaisante","joshua fait une blague","joshua plaisante en disant"],
      ["encre noire","stylo noir"],
      ["trÃ¨s trÃ¨s trÃ¨s trÃ¨s trÃ¨s violet foncÃ©","violet trÃ¨s foncÃ©","violet foncÃ©"],
      ["tu veux une blague ou tu veux un point","blague ou un point","calmement"],
      ["au final","finalement","il utilise un vrai stylo noir","l ambiance devient moins tendue","lâ€™atmosphÃ¨re devient moins tendue"]
    ],
    sampleFR:"Joshua plaisante en disant quâ€™il nâ€™utilise pas dâ€™encre noire, mais du trÃ¨s trÃ¨s trÃ¨s trÃ¨s trÃ¨s violet foncÃ©. Red lui demande calmement sâ€™il veut une blague ou un point. Finalement, Joshua utilise un vrai stylo noir, et lâ€™atmosphÃ¨re devient moins tendue."
  },

  {
    id:"T6",
    titre:"Traduction â€” Thomas et la clartÃ©",
    theme:"Otono Team",
    textEN:"Thomas writes with dramatic images, but the exam still requires clarity. Shireen suggests keeping the style while controlling the structure and adding evidence. Red concludes that a personal universe is allowed if the instruction is respected.",
    keyBundles:[
      ["thomas Ã©crit","images dramatiques","style dramatique"],
      ["l examen exige","lâ€™Ã©preuve exige","clartÃ©"],
      ["garder le style","tout en contrÃ´lant la structure","controler la structure","contrÃ´ler la structure"],
      ["ajouter des preuves","preuve","preuves"],
      ["univers personnel","autorisÃ©","Ã  condition de respecter la consigne","si la consigne est respectÃ©e"]
    ],
    sampleFR:"Thomas Ã©crit avec des images dramatiques, mais lâ€™Ã©preuve exige toujours de la clartÃ©. Shireen propose de garder le style tout en contrÃ´lant la structure et en ajoutant des preuves. Red conclut quâ€™un univers personnel est autorisÃ© si la consigne est respectÃ©e."
  },

  {
    id:"T7",
    titre:"Traduction â€” Wyatt et les dÃ©tails Ã©vitables",
    theme:"Otono Team",
    textEN:"Wyatt hates losing marks for avoidable details. For him, discipline is a shield and the correction should become an action plan. Red reminds him that writing too fast can reduce clarity.",
    keyBundles:[
      ["wyatt dÃ©teste","perdre des points","perdre des notes","points"],
      ["dÃ©tails Ã©vitables","detail evitable","Ã©vitable"],
      ["discipline","bouclier"],
      ["plan d action","plan dâ€™action","devenir un plan d action"],
      ["Ã©crire trop vite","trop vite","rÃ©duire la clartÃ©","moins clair","clartÃ©"]
    ],
    sampleFR:"Wyatt dÃ©teste perdre des points pour des dÃ©tails Ã©vitables. Pour lui, la discipline est un bouclier et la correction doit devenir un plan dâ€™action. Red lui rappelle quâ€™Ã©crire trop vite peut rÃ©duire la clartÃ©."
  },

  {
    id:"T8",
    titre:"Traduction â€” Angus Drummond et la preuve",
    theme:"Lâ€™Encroyable Drummond",
    textEN:"Angus Drummond does not fear a low grade; he fears an unclear one. He wants every mark to be demonstrable with criteria and evidence. Red shows that a remark is sometimes useful not to change the score, but to remove doubt and make the decision coherent.",
    keyBundles:[
      ["angus drummond","angus"],
      ["n a pas peur d une mauvaise note","nâ€™a pas peur dâ€™une mauvaise note","plutÃ´t d une note floue","dâ€™une note floue"],
      ["dÃ©montrable","demonstrable","criteres","critÃ¨res","preuves","preuve"],
      ["remarque","utile"],
      ["pas pour changer la note","mais pour supprimer le doute","retirer le doute","rendre la decision coherente","rendre la dÃ©cision cohÃ©rente"]
    ],
    sampleFR:"Angus Drummond nâ€™a pas peur dâ€™une mauvaise note ; il a peur dâ€™une note floue. Il veut que chaque point soit dÃ©montrable avec des critÃ¨res et des preuves. Red montre quâ€™une remarque est parfois utile non pour changer le score, mais pour supprimer le doute et rendre la dÃ©cision cohÃ©rente."
  }
];

/* =========================================================
   UTILITAIRES
========================================================= */
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));

function nowISO(){ return new Date().toISOString(); }

function norm(s){
  return (s ?? "")
    .toString()
    .toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-z0-9\s]/g," ")
    .replace(/\s+/g," ")
    .trim();
}
function countWords(s){
  const t = (s ?? "").toString().trim();
  if(!t) return 0;
  return t.split(/\s+/).filter(Boolean).length;
}
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}
function pickRandom(arr, n){ return shuffle(arr).slice(0,n); }
function pickOnePercentEasterEgg(passages, eggId="P11", chance=0.01){
  const egg = passages.find(p => p.id === eggId);
  const others = passages.filter(p => p.id !== eggId);

  // If egg doesn't exist, fall back safely
  if(!egg) return { chosenEgg:false, passage: others[Math.floor(Math.random()*others.length)] };

  // 1% chance for the egg overall
  if(Math.random() < chance) return { chosenEgg:true, passage: egg };

  // Otherwise choose a normal one
  return { chosenEgg:false, passage: others[Math.floor(Math.random()*others.length)] };
}
function escapeHtml(str){
  return (str ?? "").toString()
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#039;");
}

/* Otono grading (inchangÃ©) */
function otonoLetterGrade(score){
  if(score >= 101) return "S";
  if(score >= 95) return "A*";
  if(score >= 90) return "A";
  if(score >= 80) return "B";
  if(score >= 70) return "C";
  if(score >= 66) return "D";
  if(score >= 55) return "E";
  if(score >= 45) return "F";
  if(score >= 30) return "G";
  if(score >= 15) return "H";
  return "U";
}
function passMeritDistinction(score){
  if(score >= 90) return "DISTINCTION";
  if(score >= 80) return "MERIT";
  if(score >= 66) return "PASS";
  return "FAIL";
}
function gcseEstimate(score){
  if(score >= 90) return 9;
  if(score >= 80) return 8;
  if(score >= 70) return 7;
  if(score >= 60) return 6;
  if(score >= 50) return 5;
  if(score >= 40) return 4;
  if(score >= 30) return 3;
  if(score >= 20) return 2;
  if(score >= 10) return 1;
  return "U";
}
function badgeForScore(score){
  if(score >= 90) return ["badge good","ğŸ† Excellent"];
  if(score >= 80) return ["badge good","â­ TrÃ¨s bien"];
  if(score >= 66) return ["badge warn","âœ… Ok"];
  return ["badge bad","âŒ Mal"];
}

/* =========================================================
   STOCKAGE LOCAL
========================================================= */
const STORE_KEY = "otonoFrench_AlevelReadingDrummond_results_v2";
function loadResults(){
  try{ return JSON.parse(localStorage.getItem(STORE_KEY) || "[]"); }
  catch(e){ return []; }
}
function saveResults(list){ localStorage.setItem(STORE_KEY, JSON.stringify(list)); }
function addResult(attempt){
  const list = loadResults();
  list.unshift(attempt);
  saveResults(list);
}

/* =========================================================
   Ã‰TAT
========================================================= */
let state = {
  mode: "home",
  timer: null,
  remainingSec: 0,
  startedAt: null,

  centreNo: "50749",
  candidateNo: null,
  candSurname: "",
  candForenames: "",

  selection: null,         // { passages:[...], essay:{...}, translation:{...} }
  answers: {},             // qid -> string
  choiceCorrectValue: {},  // qid -> correct index after shuffle
  submitted: false
};

/* =========================================================
   CENTRE
========================================================= */
function setCentre(no){
  state.centreNo = String(no);
  $("#centreNo").value = state.centreNo;
  $("#centreTop").textContent = state.centreNo;
}
$("#btnEditCentre").addEventListener("click", () => {
  const val = prompt("Entre le numÃ©ro de centre (chiffres uniquement) :", state.centreNo);
  if(val === null) return;
  const clean = String(val).replace(/\D/g,"").slice(0,10);
  if(clean.length < 3){
    alert("Le numÃ©ro de centre doit contenir au moins 3 chiffres.");
    return;
  }
  setCentre(clean);
});
$("#btnResetCentre").addEventListener("click", () => setCentre("50749"));

/* =========================================================
   NUMÃ‰RO CANDIDAT (4 cases)
========================================================= */
const digitIds = ["#candD1","#candD2","#candD3","#candD4"];
function focusDigit(i){ const el = $(digitIds[i]); if(el) el.focus(); }
function getCandidateNoFromSquares(){
  const d = digitIds.map(id => ($(id).value || "").trim());
  if(d.some(x => x.length !== 1 || !/^\d$/.test(x))) return "";
  return d.join("");
}
(function wireDigitSquares(){
  digitIds.forEach((id, idx) => {
    const el = $(id);
    el.addEventListener("input", () => {
      el.value = (el.value || "").replace(/\D/g,"").slice(0,1);
      if(el.value && idx < 3) focusDigit(idx+1);
    });
    el.addEventListener("keydown", (e) => {
      if(e.key === "Backspace" && !el.value && idx > 0){ focusDigit(idx-1); }
      if(e.key === "ArrowLeft" && idx > 0){ e.preventDefault(); focusDigit(idx-1); }
      if(e.key === "ArrowRight" && idx < 3){ e.preventDefault(); focusDigit(idx+1); }
    });
    el.addEventListener("paste", (e) => {
      e.preventDefault();
      const txt = (e.clipboardData || window.clipboardData).getData("text") || "";
      const digits = txt.replace(/\D/g,"").slice(0,4).split("");
      digits.forEach((ch, j) => { const t = $(digitIds[j]); if(t) t.value = ch; });
      const joined = getCandidateNoFromSquares();
      if(joined.length === 4) focusDigit(3);
      else{
        const firstEmpty = digitIds.findIndex(did => !$(did).value);
        if(firstEmpty >= 0) focusDigit(firstEmpty);
      }
    });
  });
})();

/* =========================================================
   GÃ‰NÃ‰RATION DU SUJET
========================================================= */
function generateSelection(){

  const pool = PASSAGES_A.slice();

  // 1% chance for P11
  let chosen = [];

  if(Math.random() < 0.01){
    const p11 = pool.find(p => p.id === "P11");
    if(p11){
      chosen.push(p11);
    }
  }

  // remove chosen from pool
  const remaining = pool.filter(p => !chosen.includes(p));

  // fill remaining slots normally
  chosen.push(...pickRandom(remaining, 3 - chosen.length));

  const passages = chosen;

  const eligibleEssays = ESSAYS.filter(e => passages.some(p => p.id === e.passageId));
  const essay = (eligibleEssays.length ? pickRandom(eligibleEssays,1)[0] : pickRandom(ESSAYS,1)[0]);

  const translation = pickRandom(TRANSLATIONS_A, 1)[0];

  return { passages, essay, translation };
}

/* =========================================================
   NAV / RENDU
========================================================= */
function setBadge(text, cls="badge"){
  const b = $("#statusBadge");
  b.className = cls;
  b.textContent = text;
}
function stopTimer(){
  if(state.timer){ clearInterval(state.timer); state.timer = null; }
}
function startTimer(minutes){
  stopTimer();
  state.remainingSec = Math.max(1, Math.floor(minutes*60));
  state.startedAt = Date.now();

  const tick = () => {
    if(state.submitted) return;
    const m = Math.floor(state.remainingSec/60);
    const s = state.remainingSec%60;
    $("#timerText").textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    state.remainingSec--;
    if(state.remainingSec < 0){
      stopTimer();
      const auto = $("#autoSubmit").value === "yes";
      if(auto) submitPaper(true);
      else alert("Temps Ã©coulÃ©. Tu peux encore soumettre manuellement.");
    }
  };
  tick();
  state.timer = setInterval(tick, 1000);
}

function renderHome(){
  $("#homeBody").classList.remove("hide");
  $("#testBody").classList.add("hide");
  $("#resultsBody").classList.add("hide");
  $("#sideTitle").textContent = "Notation Otono";
  $("#sideMeta").textContent = "Score â†’ note Otono + estimation GCSE + Pass/Merit/Distinction.";
  $("#sideBody").classList.remove("hide");
  setBadge("PrÃªt","badge");
  $("#timerText").textContent = "--:--";
}
function renderResults(){
  $("#homeBody").classList.add("hide");
  $("#testBody").classList.add("hide");
  $("#sideBody").classList.add("hide");
  $("#resultsBody").classList.remove("hide");
  $("#sideTitle").textContent = "RÃ©sultats enregistrÃ©s";
  $("#sideMeta").textContent = "StockÃ©s sur ce navigateur (localStorage).";
  setBadge("RÃ©sultats","badge");
  $("#timerText").textContent = "--:--";
  drawResults();
}
function renderTest(){
  $("#homeBody").classList.add("hide");
  $("#testBody").classList.remove("hide");
  $("#resultsBody").classList.add("hide");
  $("#sideBody").classList.remove("hide");

  const candNameLine = [
    state.candSurname ? state.candSurname : "",
    state.candForenames ? state.candForenames : ""
  ].filter(Boolean).join(", ");

  const cand = `${state.candidateNo}${candNameLine ? " â€¢ " + candNameLine : ""}`;
  $("#kpiCandidate").textContent = cand;
  $("#kpiPassages").textContent = state.selection.passages.map(p=>p.id).join(" ");
  $("#kpiEssay").textContent = state.selection.essay.id;

  $("#paper").innerHTML = "";
  state.choiceCorrectValue = {};

  const shuffleMode = $("#shuffleMode").value;

  const head = document.createElement("div");
  head.className = "note";
  head.innerHTML =
    `<strong>Contenu sÃ©lectionnÃ©</strong><br/>` +
    state.selection.passages.map(p => `â€¢ ${escapeHtml(p.titre)} (${escapeHtml(p.id)})`).join("<br/>") +
    `<br/>â€¢ ${escapeHtml(state.selection.essay.titre)} (${escapeHtml(state.selection.essay.id)})` +
    `<br/>â€¢ ${escapeHtml(state.selection.translation.titre)} (${escapeHtml(state.selection.translation.id)})`;
  $("#paper").appendChild(head);

  // Passages
  state.selection.passages.forEach(p => {
    const block = document.createElement("div");
    block.className = "card";
    block.style.marginTop = "14px";
    block.innerHTML = `
      <div class="hd">
        <div>
          <h2>${escapeHtml(p.titre)}</h2>
          <div class="meta">${escapeHtml(p.theme)} â€¢ <strong>20 points</strong></div>
        </div>
        <span class="badge">${escapeHtml(p.id)}</span>
      </div>
      <div class="bd">
        <div class="passage">${escapeHtml(p.texte).replace(/\n/g,"<br/>")}</div>
        <div class="divider"></div>
        <div class="small">Choix (QCM/labels) : options toujours mÃ©langÃ©es. RÃ©dactions : correction par idÃ©es/mots-clÃ©s.</div>
        <div class="qs"></div>
      </div>
    `;
    const qs = block.querySelector(".qs");
    let qsList = p.questions.slice();
    if(shuffleMode === "shuffleAll") qsList = shuffle(qsList);

    qsList.forEach(q => {
      const qWrap = document.createElement("div");
      qWrap.className = "q";
      qWrap.dataset.qid = q.id;
      qWrap.innerHTML = `
        <h3>${escapeHtml(q.prompt)} <span class="badge">${q.marks} pts</span></h3>
        ${renderQuestion(q)}
        <div class="small" style="margin-top:8px">${escapeHtml(instructionFor(q.type))}</div>
      `;
      qs.appendChild(qWrap);
    });

    $("#paper").appendChild(block);
  });

  // Mini-essai
  const e = state.selection.essay;
  const essayBlock = document.createElement("div");
  essayBlock.className = "card";
  essayBlock.style.marginTop = "14px";
  essayBlock.innerHTML = `
    <div class="hd">
      <div>
        <h2>${escapeHtml(e.titre)}</h2>
        <div class="meta">RÃ©ponse courte (~90 mots) â€¢ <strong>20 points</strong></div>
      </div>
      <span class="badge">MINI-ESSAI</span>
    </div>
    <div class="bd">
      <div class="passage">${escapeHtml(e.passage).replace(/\n/g,"<br/>")}</div>
      <div class="divider"></div>
      <div class="note"><strong>Consigne :</strong><br/>${escapeHtml(e.consigne)}</div>
      <div class="essayHelp">
        <strong>Auto-correction :</strong>
        <div>â€¢ Cherche 3 Ã©lÃ©ments : <strong>pour</strong> + <strong>contre</strong> + <strong>conclusion</strong>.</div>
        <div>â€¢ Objectif : <strong>75â€“110 mots</strong> (idÃ©al ~90). Trop court â†’ pÃ©nalitÃ© douce.</div>
        <div>â€¢ Utilise au moins un connecteur : <em>dâ€™abord</em>, <em>cependant</em>, <em>en conclusion</em>â€¦</div>
      </div>
      <div class="q" data-qid="essay">
        <h3>RÃ©daction (en franÃ§ais) <span class="badge">20 pts</span></h3>
        <textarea id="ans_essay" placeholder="Ã‰cris ton mini-essai ici (~90 mots)â€¦"></textarea>
        <div class="small" id="essayCount" style="margin-top:6px">Mots : 0</div>
      </div>
    </div>
  `;
  $("#paper").appendChild(essayBlock);

  // Traduction
  const t = state.selection.translation;
  const tBlock = document.createElement("div");
  tBlock.className = "card";
  tBlock.style.marginTop = "14px";
  tBlock.innerHTML = `
    <div class="hd">
      <div>
        <h2>${escapeHtml(t.titre)}</h2>
        <div class="meta">${escapeHtml(t.theme)} â€¢ <strong>20 points</strong></div>
      </div>
      <span class="badge">TRADUCTION</span>
    </div>
    <div class="bd">
      <div class="note"><strong>Texte (anglais) :</strong><br/>${escapeHtml(t.textEN)}</div>
      <div class="divider"></div>
      <div class="q" data-qid="translation">
        <h3>Traduire en franÃ§ais <span class="badge">20 pts</span></h3>
        <textarea id="ans_translation" placeholder="Ã‰cris ta traduction en franÃ§aisâ€¦"></textarea>
        <div class="small" style="margin-top:8px">Auto-corr : 5 idÃ©es-clÃ©s (sens) â€¢ 4 points chacune.</div>
      </div>
    </div>
  `;
  $("#paper").appendChild(tBlock);

  bindInputs();

  const mins = parseInt($("#timeAllowed").value,10);
  startTimer(mins);
  state.submitted = false;

  $("#markingBox").classList.add("hide");
  $("#markingBox").innerHTML = "";
  setBadge("En cours","badge warn");
}

function instructionFor(type){
  if(type === "mcq") return "Choisis UNE rÃ©ponse.";
  if(type === "tfnm") return "Choisis : Vrai / Faux / Non mentionnÃ©.";
  if(type === "pn") return "Choisis : P / N / P+N.";
  if(type === "syn") return "Ã‰cris le mot exact (ou lâ€™expression) trouvÃ©(e) dans le texte.";
  if(type === "match") return "Ã‰cris le mot exact demandÃ© (un mot du texte).";
  return "RÃ©ponse rÃ©digÃ©e : sois concis et prÃ©cis (auto-corr par mots-clÃ©s).";
}

function renderQuestion(q){
  if(q.type === "mcq"){
    const opts = q.options.map((text, idx) => ({ text, isCorrect: idx === q.answerIndex }));
    return renderChoice(q, opts);
  }
  if(q.type === "pn"){
    const opts = [
      { text:"P", isCorrect: q.correct === "P" },
      { text:"N", isCorrect: q.correct === "N" },
      { text:"P+N", isCorrect: q.correct === "P+N" }
    ];
    return renderChoice(q, opts);
  }
  if(q.type === "tfnm"){
    const opts = [
      { text:"Vrai", isCorrect: q.correct === "Vrai" },
      { text:"Faux", isCorrect: q.correct === "Faux" },
      { text:"Non mentionnÃ©", isCorrect: q.correct === "Non mentionnÃ©" }
    ];
    return renderChoice(q, opts);
  }
  if(q.type === "syn"){
    return `<input type="text" id="ans_${q.id}" placeholder="Mot exact du texteâ€¦" />`;
  }
  if(q.type === "match"){
    return `<input type="text" id="ans_${q.id}" placeholder="Un mot exact du texteâ€¦" />`;
  }
  return `<textarea id="ans_${q.id}" placeholder="RÃ©ponds en franÃ§aisâ€¦"></textarea>`;
}

function renderChoice(q, optionObjects){
  const name = `ans_${q.id}`;
  const shuffled = shuffle(optionObjects);
  const correctIndex = shuffled.findIndex(o => o.isCorrect);
  state.choiceCorrectValue[q.id] = String(correctIndex);

  return `
    <div class="opts">
      ${shuffled.map((opt, idx) => `
        <label class="opt">
          <input type="radio" name="${name}" value="${idx}" />
          <div><div><strong>${String.fromCharCode(65+idx)}.</strong> ${escapeHtml(opt.text)}</div></div>
        </label>
      `).join("")}
    </div>
  `;
}

function bindInputs(){
  $$("input[type='radio']").forEach(r => {
    r.addEventListener("change", () => {
      const qid = r.name.replace("ans_","");
      state.answers[qid] = r.value;
    });
  });

  $$("textarea").forEach(t => {
    t.addEventListener("input", () => {
      const id = t.id.replace("ans_","");
      state.answers[id] = t.value;
      if(id === "essay"){
        $("#essayCount").textContent = "Mots : " + countWords(t.value);
      }
    });
  });

  $$("input[type='text']").forEach(inp => {
    if(inp.id === "centreNo" || inp.id.startsWith("candD") || inp.id === "candSurname" || inp.id === "candForenames") return;
    inp.addEventListener("input", () => {
      const id = inp.id.replace("ans_","");
      state.answers[id] = inp.value;
    });
  });
}

/* =========================================================
   AUTO-CORRECTION
========================================================= */
function markChoice(qid, chosenValue, marks){
  const correctValue = state.choiceCorrectValue[qid];
  const ok = String(chosenValue ?? "") === String(correctValue);
  return { score: ok ? marks : 0, max: marks, detail: ok ? "Correct." : "Incorrect." };
}
function markExactWord(q, userText){
  const t = norm(userText);
  if(!t) return {score:0, max:q.marks, detail:"RÃ©ponse vide."};
  const acc = (q.acceptable || []).map(x => norm(x));
  const ok = acc.includes(t);
  return {score: ok ? q.marks : 0, max:q.marks, detail: ok ? "Correct (mot du texte)." : "Incorrect (mot attendu du texte)." };
}
function markShort(q, userText){
  const t = norm(userText);
  if(!t) return {score:0, max:q.marks, detail:"RÃ©ponse vide."};

  const groups = q.keywords || [];
  if(groups.length === 0) return {score:0, max:q.marks, detail:"Rubrique non configurÃ©e."};

  let hits = 0;
  groups.forEach(g => {
    const found = g.some(k => t.includes(norm(k)));
    if(found) hits++;
  });

  const per = q.marks / groups.length;
  const raw = hits * per;
  const score = Math.max(0, Math.min(q.marks, Math.round(raw*2)/2));
  let detail = `Groupes de mots-clÃ©s trouvÃ©s : ${hits}/${groups.length}.`;
  if(q.rubric) detail += ` Attendu : ${q.rubric}`;
  return {score, max:q.marks, detail};
}

function markMiniEssay(essayObj, userText){
  const raw = (userText ?? "").toString();
  const t = norm(raw);
  if(!t) return {score:0, max:20, detail:"Mini-essai vide.", wordCount:0};

  const wc = countWords(raw);

  // Structure (6) : intro + opposition + conclusion (2 pts chacun)
  let structHits = 0;
  (essayObj.structureAnchors || []).forEach(group => {
    const ok = group.some(k => t.includes(norm(k)));
    if(ok) structHits++;
  });
  const structureScore = Math.min(6, structHits * 2);

  // IdÃ©es (10) : 5 groupes Ã— 2
  let ideaHits = 0;
  (essayObj.ideaGroups || []).forEach(group => {
    const ok = group.some(k => t.includes(norm(k)));
    if(ok) ideaHits++;
  });
  const ideaScore = Math.min(10, ideaHits * 2);

  // Connecteurs (4) : 4 familles, 1 pt chacune
  let connHits = 0;
  (essayObj.connectors || []).forEach(group => {
    const ok = group.some(k => t.includes(norm(k)));
    if(ok) connHits++;
  });
  const connScore = Math.min(4, connHits);

  // Longueur (pÃ©nalitÃ© douce)
  let lengthAdj = 0;
  if(wc < 60) lengthAdj = -6;
  else if(wc < 75) lengthAdj = -3;
  else if(wc > 140) lengthAdj = -2; // trop long pour â€œstyle 90 motsâ€
  else lengthAdj = 0;

  const total = Math.max(0, Math.min(20, structureScore + ideaScore + connScore + lengthAdj));
  const detail =
    `Structure : ${structureScore}/6 â€¢ IdÃ©es : ${ideaScore}/10 â€¢ Connecteurs : ${connScore}/4 â€¢ Longueur : ${wc} mots (${lengthAdj<0 ? lengthAdj+" pts" : "OK"}).`;
  return {score: Math.round(total*2)/2, max:20, detail, wordCount:wc};
}

function markTranslation(trObj, userText){
  const t = norm(userText);
  if(!t) return {score:0, max:20, detail:"Traduction vide."};

  // 5 paquets (bundles) Ã— 4
  let hits = 0;
  (trObj.keyBundles || []).forEach(bundle => {
    const ok = bundle.some(k => t.includes(norm(k)));
    if(ok) hits++;
  });
  const score = Math.min(20, hits * 4);
  const detail = `IdÃ©es-clÃ©s : ${hits}/5 (score ${score}/20).`;
  return {score, max:20, detail};
}

function computeTotal(){
  let total = 0;
  let breakdown = [];

  // Passages
  state.selection.passages.forEach(p => {
    p.questions.forEach(q => {
      const ans = state.answers[q.id];
      let res;
      if(["mcq","pn","tfnm"].includes(q.type)){
        res = markChoice(q.id, ans, q.marks);
      }else if(q.type === "syn" || q.type === "match"){
        res = markExactWord(q, ans);
      }else{
        res = markShort(q, ans);
      }
      total += res.score;
      breakdown.push({
        qid: q.id, bloc: p.id, type: q.type, prompt: q.prompt,
        score: res.score, max: res.max, detail: res.detail
      });
    });
  });

  // Mini-essai
  const essayAns = state.answers["essay"] ?? $("#ans_essay")?.value ?? "";
  const eRes = markMiniEssay(state.selection.essay, essayAns);
  total += eRes.score;
  breakdown.push({
    qid:"essay", bloc:"MINI-ESSAI", type:"essay90", prompt:"Mini-essai (~90 mots)",
    score:eRes.score, max:eRes.max, detail:eRes.detail
  });

  // Traduction
  const trAns = state.answers["translation"] ?? $("#ans_translation")?.value ?? "";
  const tRes = markTranslation(state.selection.translation, trAns);
  total += tRes.score;
  breakdown.push({
    qid:"translation", bloc:"TRADUCTION", type:"translation", prompt:"Traduction anglais â†’ franÃ§ais",
    score:tRes.score, max:tRes.max, detail:tRes.detail
  });

  return { total: Math.round(total*2)/2, max: 100, breakdown };
}

/* =========================================================
   SOUMISSION + SAUVEGARDE
========================================================= */
function submitPaper(fromAutoTimer=false){
  if(state.submitted) return;

  const { total, max, breakdown } = computeTotal();
  state.submitted = true;
  stopTimer();

  const letter = otonoLetterGrade(total);
  const pmd = passMeritDistinction(total);
  const gcse = gcseEstimate(total);
  const [badgeCls, badgeText] = badgeForScore(total);

  const attempt = {
    paper: "Otono French â€” A Level â€¢ Lecture + Mini-essai + Traduction â€” Lâ€™Encroyable Drummond",
    centre: state.centreNo,
    candidateNo: String(state.candidateNo),
    candidateSurname: state.candSurname || "",
    candidateForenames: state.candForenames || "",
    submittedAt: nowISO(),
    timeAllowedMin: parseInt($("#timeAllowed").value,10),
    selectedPassages: state.selection.passages.map(p=>p.id),
    selectedEssay: state.selection.essay.id,
    selectedTranslation: state.selection.translation.id,
    score: total,
    maxScore: max,
    otonoGrade: letter,
    gcseEstimated: gcse,
    outcome: pmd,
    breakdown
  };
  addResult(attempt);

  const nameLine = [attempt.candidateSurname, attempt.candidateForenames].filter(Boolean).join(", ");

  const box = $("#markingBox");
  box.classList.remove("hide");
  box.innerHTML = `
    <div class="card">
      <div class="hd">
        <div>
          <h2>âœ… CorrigÃ©${fromAutoTimer ? " (soumission auto)" : ""}</h2>
          <div class="meta">
            EnregistrÃ© dans RÃ©sultats â€¢ Centre ${escapeHtml(attempt.centre)} â€¢ Candidat ${escapeHtml(attempt.candidateNo)}${nameLine ? " â€¢ " + escapeHtml(nameLine) : ""}
          </div>
        </div>
        <span class="${badgeCls}">${escapeHtml(badgeText)}</span>
      </div>
      <div class="bd">
        <div class="kpi">
          <div class="box"><div class="t">Score</div><div class="v">${attempt.score} / ${attempt.maxScore}</div></div>
          <div class="box"><div class="t">Note Otono</div><div class="v">${escapeHtml(attempt.otonoGrade)}</div></div>
          <div class="box"><div class="t">Estimation GCSE</div><div class="v">${escapeHtml(String(attempt.gcseEstimated))}</div></div>
          <div class="box"><div class="t">Statut</div><div class="v">${escapeHtml(attempt.outcome)}</div></div>
        </div>

        <div class="divider"></div>

        <div class="note">
          <strong>Notes dâ€™auto-correction</strong><br/>
          â€¢ QCM / V-F-NM / P-N-P+N : correction exacte (options mÃ©langÃ©es).<br/>
          â€¢ â€œMot du texteâ€ : attendu exact (orthographe normalisÃ©e).<br/>
          â€¢ RÃ©ponses rÃ©digÃ©es + mini-essai : correction par idÃ©es/mots-clÃ©s â†’ reformulation trÃ¨s diffÃ©rente = possible sous-note.
        </div>

        <div class="divider"></div>

        <button class="btn" id="btnShowBreakdown">Afficher le dÃ©tail</button>
        <div id="breakdown" class="hide" style="margin-top:12px"></div>

        <div class="divider"></div>

        <div class="note">
          <strong>ModÃ¨le (mini-essai / traduction) â€” pour rÃ©fÃ©rence</strong><br/>
          <div class="divider"></div>
          <div><strong>Mini-essai :</strong><br/>${escapeHtml(state.selection.essay.modelAnswer).replace(/\n/g,"<br/>")}</div>
          <div class="divider"></div>
          <div><strong>Traduction :</strong><br/>${escapeHtml(state.selection.translation.sampleFR)}</div>
        </div>
      </div>
    </div>
  `;

  $("#btnShowBreakdown").addEventListener("click", () => {
    const bd = $("#breakdown");
    bd.classList.toggle("hide");
    if(!bd.classList.contains("hide")){
      bd.innerHTML = breakdown.map(b => `
        <div class="attempt">
          <div class="top">
            <div><strong>${escapeHtml(b.qid)}</strong> â€¢ ${escapeHtml(b.bloc)} â€¢ ${escapeHtml(String(b.type))}</div>
            <div><span class="badge">${b.score} / ${b.max}</span></div>
          </div>
          <div class="meta">
            <div><strong>Question :</strong> ${escapeHtml(b.prompt)}</div>
            <div><strong>Auto-corr :</strong> ${escapeHtml(b.detail)}</div>
          </div>
        </div>
      `).join("");
    }
  });

  setBadge("Soumis","badge good");
}

/* =========================================================
   RÃ‰SULTATS UI
========================================================= */
function drawResults(){
  const listEl = $("#resultsList");
  const all = loadResults();
  const filter = ($("#filterCandidate").value || "").replace(/\D/g,"").slice(0,4);
  const filtered = filter ? all.filter(a => String(a.candidateNo) === String(filter)) : all;

  if(filtered.length === 0){
    listEl.innerHTML = `<div class="note">Aucune tentative enregistrÃ©e${filter ? " pour ce candidat" : ""}.</div>`;
    return;
  }

  listEl.innerHTML = filtered.map(a => {
    const [cls, txt] = badgeForScore(a.score);
    const nameLine = [a.candidateSurname, a.candidateForenames].filter(Boolean).join(", ");
    return `
      <div class="attempt">
        <div class="top">
          <div>
            <strong>${escapeHtml(a.candidateNo)}</strong>${nameLine ? " â€¢ " + escapeHtml(nameLine) : ""}
            <span class="badge" style="margin-left:8px">Centre ${escapeHtml(a.centre)}</span>
          </div>
          <div class="${cls}">${escapeHtml(txt)} â€¢ ${escapeHtml(String(a.score))}/100</div>
        </div>
        <div class="meta">
          <div><strong>Date :</strong> ${escapeHtml(new Date(a.submittedAt).toLocaleString())}</div>
          <div><strong>SÃ©lection :</strong> Passages ${escapeHtml(a.selectedPassages.join(", "))} â€¢ Essai ${escapeHtml(a.selectedEssay)} â€¢ Trad ${escapeHtml(a.selectedTranslation)}</div>
          <div><strong>Notes :</strong> Otono ${escapeHtml(a.otonoGrade)} â€¢ GCSE ${escapeHtml(String(a.gcseEstimated))} â€¢ ${escapeHtml(a.outcome)}</div>
        </div>
      </div>
    `;
  }).join("");
}

function exportResults(){
  const all = loadResults();
  $("#exportText").textContent = JSON.stringify(all, null, 2);
  $("#exportBox").classList.remove("hide");
}

function clearResults(){
  if(!confirm("Effacer TOUTES les tentatives enregistrÃ©es sur ce navigateur ?")) return;
  localStorage.removeItem(STORE_KEY);
  drawResults();
  $("#exportBox").classList.add("hide");
}

/* =========================================================
   BOUTONS
========================================================= */
$("#btnHome").addEventListener("click", () => { state.mode="home"; renderHome(); });
$("#btnResults").addEventListener("click", () => { state.mode="results"; renderResults(); });

$("#btnPreview").addEventListener("click", () => {
  const c = getCandidateNoFromSquares();
  if(!c){ alert("Entre dâ€™abord un NumÃ©ro candidat."); focusDigit(0); return; }
  const sel = generateSelection();
  const box = $("#previewBox");
  box.classList.remove("hide");
  box.innerHTML = `<strong>AperÃ§u (sans dÃ©marrer) :</strong><br/>${escapeHtml(selectionSummary(sel))}<br/>` +
    sel.passages.map(p => `â€¢ ${escapeHtml(p.titre)} (${escapeHtml(p.id)})`).join("<br/>") +
    `<br/>â€¢ ${escapeHtml(sel.essay.titre)} (${escapeHtml(sel.essay.id)})` +
    `<br/>â€¢ ${escapeHtml(sel.translation.titre)} (${escapeHtml(sel.translation.id)})`;
});

$("#btnStart").addEventListener("click", () => {
  const c = getCandidateNoFromSquares();
  if(!c){ alert("Le NumÃ©ro candidat est obligatoire."); focusDigit(0); return; }

  state.candidateNo = c;
  state.candSurname = ($("#candSurname").value || "").trim();
  state.candForenames = ($("#candForenames").value || "").trim();

  state.selection = generateSelection();
  state.answers = {};
  renderTest();
});

$("#btnSubmit").addEventListener("click", () => submitPaper(false));

$("#btnReset").addEventListener("click", () => {
  if(!confirm("RÃ©initialiser et gÃ©nÃ©rer un NOUVEAU sujet ? Les rÃ©ponses actuelles seront perdues.")) return;
  stopTimer();
  state.answers = {};
  state.submitted = false;
  state.selection = generateSelection();
  renderTest();
});

/* RÃ©sultats */
$("#filterCandidate").addEventListener("input", (e) => {
  e.target.value = e.target.value.replace(/\D/g,"").slice(0,4);
  drawResults();
});
$("#tabAll").addEventListener("click", () => {
  $("#tabAll").classList.add("active");
  $("#tabCandidate").classList.remove("active");
  $("#filterCandidate").value = "";
  drawResults();
});
$("#tabCandidate").addEventListener("click", () => {
  $("#tabCandidate").classList.add("active");
  $("#tabAll").classList.remove("active");
  $("#filterCandidate").focus();
});
$("#btnExport").addEventListener("click", exportResults);
$("#btnClear").addEventListener("click", clearResults);

/* INIT */
setCentre("50749");
renderHome();
</script>
</body>
</html>
