<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otono Airways A380 Plan des si√®ges</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'Playfair Display', serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Fuselage and Seat Look --- */
        .fuselage-style {
            background-color: white;
            border: 4px solid #cbd5e1; /* slate-300 */
            border-top-left-radius: 50% 100px;
            border-top-right-radius: 50% 100px;
            border-bottom-left-radius: 50% 250px;
            border-bottom-right-radius: 50% 250px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.2);
            padding: 0 10px 350px 10px;
        }
        
        .seat-style {
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
            border-width: 1px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .seat-occupied-style {
            background-color: #e5e7eb !important; /* gray-200 */
            border-color: #9ca3af !important; /* gray-400 */
            color: #4b5563 !important; /* gray-600 */
            cursor: not-allowed !important;
            pointer-events: none;
            transform: none !important;
            box-shadow: none !important;
            opacity: 0.8;
        }

        .seat-selected-style {
            background-color: #3fd166 !important; /* green */
            border-color: #298c43 !important;
            color: black !important;
            transform: scale(1.15);
            z-index: 20;
            box-shadow: 0 0 15px rgba(0, 255, 21, 0.8);
        }
        /* Custom Otono/Bad Seat Styles */
        .good-seat-badge {
            background-color: #e9d5ff; /* Light Purple (like purple-200) */
            color: #6d28d9; /* Deep Purple (like purple-800) */
            border: 1px solid #d8b4fe; /* Border purple */
        }
        .bad-seat-badge {
            background-color: #bfdbfe; /* Light Blue (like blue-200) */
            color: #1e40af; /* Dark Blue (like blue-800) */
            border: 1px solid #93c5fd; /* Border blue */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

<div id="root"></div>

<script type="text/babel">
    const { useState, useMemo } = React;

    // --- Icons ---
    const IconWrapper = ({ children, size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
    );
    const Plane = (props) => <IconWrapper {...props}><path d="M2 12h20"/><path d="M13 2l9 10-9 10"/><path d="M2 12l5-5m-5 5l5 5"/></IconWrapper>;
    const Star = (props) => <IconWrapper {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></IconWrapper>;
    const Coffee = (props) => <IconWrapper {...props}><path d="M18 8h1a4 4 0 0 1 0 8h-1" /><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z" /><line x1="6" y1="1" x2="6" y2="4" /><line x1="10" y1="1" x2="10" y2="4" /><line x1="14" y1="1" x2="14" y2="4" /></IconWrapper>;
    const User = (props) => <IconWrapper {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></IconWrapper>;
    const Bath = (props) => <IconWrapper {...props}><path d="M9 6 6.5 3.5a1.5 1.5 0 0 0-1-1C5.5 2.5 5 3 5 4v8" /><line x1="10" y1="5" x2="8" y2="7" /><path d="M2 12h20" /><path d="M7 19v2" /><path d="M17 19v2" /></IconWrapper>;
    const ArrowUp = (props) => <IconWrapper {...props}><line x1="12" y1="19" x2="12" y2="5" /><polyline points="5 12 12 5 19 12" /></IconWrapper>;
    const Wifi = (props) => <IconWrapper {...props}><path d="M5 12.55a11 11 0 0 1 14.08 0" /><path d="M1.44 9a16 16 0 0 1 21.16 0" /><path d="M8.53 16.11a6 6 0 0 1 6.95 0" /><line x1="12" y1="20" x2="12.01" y2="20" /></IconWrapper>;
    const ThumbsUp = (props) => <IconWrapper {...props}><path d="M7 10v12" /><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z" /></IconWrapper>;
    const ThumbsDown = (props) => <IconWrapper {...props}><path d="M17 14V2" /><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z" /></IconWrapper>;

    // --- Configuration ---
    const DECK_UPPER = 'UPPER';
    const DECK_LOWER = 'LOWER';

    const CLASS_OTONO_ONE = 'Otono One';
    const CLASS_FIRST = 'La Premi√®re';
    const CLASS_BUSINESS = 'Affaires';
    const CLASS_PREM_ECO = '√âconomique Premium';
    const CLASS_ECONOMY = '√âconomique';

    const CLASS_COLORS = {
      [CLASS_OTONO_ONE]: 'bg-purple-900 border-yellow-400 text-yellow-100', 
      [CLASS_FIRST]: 'bg-purple-700 border-purple-300 text-white',
      [CLASS_BUSINESS]: 'bg-red-900 border-red-700 text-white',
      [CLASS_PREM_ECO]: 'bg-red-700 border-red-500 text-white',
      [CLASS_ECONOMY]: 'bg-red-500 border-red-400 text-white hover:bg-red-400 hover:border-red-300', 
    };

    // --- Pricing Logic ---
    const getPrice = (type, row, features) => {
        // Otono One
        if (type === CLASS_OTONO_ONE) return '‚Ç¨16,000';
        
        // First Class
        if (type === CLASS_FIRST) return '‚Ç¨7,500';

        // Business
        if (type === CLASS_BUSINESS) return '‚Ç¨3,750';

        // Premium Economy
        if (type === CLASS_PREM_ECO) return '‚Ç¨2,500';

        // Economy
        if (type === CLASS_ECONOMY) {
            // Plus d'espace pour les jambes or Preferred
            if (features.includes("Plus d'espace pour les jambes") || features.includes('Preferred Seat')) {
                return '‚Ç¨1,900';
            }
            // Rear Cabin (Rows 68-77)
            if (row >= 68 && row <= 77) {
                return '‚Ç¨1,600';
            }
            // Standard
            return '‚Ç¨1,750';
        }
        return 'N/A';
    };

    const createSeat = (id, type, row, col, isAisle = false, features = []) => {
        let finalFeatures = [...features];
        
        // Add WiFi based on class
        const wifiFeature = (type === CLASS_OTONO_ONE || type === CLASS_FIRST || type === CLASS_BUSINESS)
            ? 'Gratuit WiFi haut d√©bit'
            : (type === CLASS_PREM_ECO)
            ? '‚Ç¨4 pour WiFi haut d√©bit et Messagerie WiFi gratuit'
            : '‚Ç¨9 pour WiFi haut d√©bit et Messagerie WiFi gratuit';

        finalFeatures.push(wifiFeature);

        // Add standard service marker
        if (type === CLASS_ECONOMY || type === CLASS_PREM_ECO) {
            finalFeatures.push("Service Standard D'Otono");
        }

        return {
            id, type, row, col, isAisle,
            isOccupied: Math.random() > 0.85,
            features: finalFeatures,
            price: getPrice(type, row, finalFeatures),
        };
    };

    // --- Helper: Get Seat Quality Label ---
    const getSeatQuality = (seat) => {
        const r = seat.row;
        const c = seat.col;

        // 1. GOOD SEATS (Otono Purple Badge)
        // General Bulkheads/Plus d'espace pour les jambes
        if (seat.features.includes("Plus d'espace pour les jambes")) {
            return { type: 'GOOD', label: 'Bon Si√®ge', reason: "Plus d'espace pour les jambes", icon: ThumbsUp };
        }
        // Otono One is always good
        if (seat.type === CLASS_OTONO_ONE) {
            return { type: 'GOOD', label: 'Suite incroyable', reason: 'Suite Luxe', icon: ThumbsUp };
        }

        // Specific Economy Good Seats (requested)
        if (r === 67 && ['A', 'B', 'C', 'H', 'J', 'K'].includes(c)) {
             return { type: 'GOOD', label: 'Si√®ge Pr√©f√®r√©', reason: 'Pr√®s de la sortie', icon: ThumbsUp };
        }

        if (r === 82 && ['A', 'B', 'C', 'H', 'J', 'K'].includes(c)) {
             return { type: 'GOOD', label: 'Si√®ge Pr√©f√®r√©', reason: 'Pr√®s de la sortie', icon: ThumbsUp };
        }

        if (r === 83 && ['D', 'G', 'C', 'H', 'J', 'K'].includes(c)) {
             return { type: 'GOOD', label: 'Si√®ge Pr√©f√®r√©', reason: 'Pr√®s de la sortie', icon: ThumbsUp };
        }

        if (r >=11 && r <=16 && ['A', 'D', 'G', 'K'].includes(c)) {
             return { type: 'GOOD', label: 'Si√®ge Pr√©f√®r√©', reason: 'Pr√®s de la sortie', icon: ThumbsUp };
        }

        // Example: Upper Deck Window pairs in the rear (A/K)
        if (r >= 83 && r <= 92 && ['A', 'C', 'H', 'K'].includes(c)) {
             return { type: 'GOOD', label: 'Paire de fen√™tres silencieuses', reason: 'Sentiment priv√©', icon: ThumbsUp };
        }

        // 2. BAD SEATS (Light Blue Badge)
        // Back of cabins (potential noise/galley/limited recline)
        if ([25, 37, 52, 93].includes(r)) {
            return { type: 'BAD', label: 'Mauvais Si√®ge', reason: 'Pr√®s de la cuisine / Inclinaison limit√©e', icon: ThumbsDown };
        }
        
        // Specific Economy Bad Seats (requested)
        if (r === 67 && ['D', 'E', 'F', 'G'].includes(c)) {
             return { type: 'BAD', label: 'Mauvais Si√®ge', reason: 'Pr√®s de la cuisine', icon: ThumbsDown };
        }
        if (r === 76 && ['D', 'E', 'F', 'G'].includes(c)) {
             return { type: 'BAD', label: 'Mauvais Si√®ge', reason: 'Pr√®s de la cuisine', icon: ThumbsDown };
        }
        
        // Example: Seats near the lower deck stairs/lavatories (R77)
        if (r === 77) {
             return { type: 'GOOD', label: 'Trio de fen√™tres silencieuses', reason: 'Casse sup√©rieure priv√©e', icon: ThumbsUp };
        }

        // 3. NEUTRAL (Most seats, return null)
        return null;
    };

    // --- Compteur de passagers (AJOUT√â) ---
    // NOTE : Chaque suite Otono One transporte DEUX passagers.
    const flattenCabins = (cabins) => cabins.reduce((acc, c) => acc.concat(c.seats), []);

    const buildSeatStats = (seats) => {
        const totals = {
            total: 0,
            occupied: 0,
            available: 0,
            byClass: {
                [CLASS_OTONO_ONE]: { total: 0, occupied: 0, available: 0 },
                [CLASS_FIRST]: { total: 0, occupied: 0, available: 0 },
                [CLASS_BUSINESS]: { total: 0, occupied: 0, available: 0 },
                [CLASS_PREM_ECO]: { total: 0, occupied: 0, available: 0 },
                [CLASS_ECONOMY]: { total: 0, occupied: 0, available: 0 },
            }
        };

        for (const s of seats) {
            const cls = s.type;
            const paxValue = (cls === CLASS_OTONO_ONE) ? 2 : 1;

            totals.total += paxValue;
            totals.byClass[cls].total += paxValue;

            if (s.isOccupied) {
                totals.occupied += paxValue;
                totals.byClass[cls].occupied += paxValue;
            } else {
                totals.available += paxValue;
                totals.byClass[cls].available += paxValue;
            }
        }

        return totals;
    };

    const SeatCounterPanel = ({ stats }) => {
        const classOrder = [CLASS_OTONO_ONE, CLASS_FIRST, CLASS_BUSINESS, CLASS_PREM_ECO, CLASS_ECONOMY];

        return (
            <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                <h2 className="text-sm font-bold text-gray-500 uppercase mb-3">Disponibilit√© des passagers</h2>

                <div className="grid grid-cols-3 gap-2 mb-4">
                    <div className="rounded-lg border border-gray-100 p-3">
                        <div className="text-[11px] text-gray-500 font-bold uppercase">Total</div>
                        <div className="text-2xl font-extrabold text-purple-700">{stats.total}</div>
                    </div>
                    <div className="rounded-lg border border-gray-100 p-3">
                        <div className="text-[11px] text-gray-500 font-bold uppercase">Occup√©</div>
                        <div className="text-2xl font-extrabold text-red-600">{stats.occupied}</div>
                    </div>
                    <div className="rounded-lg border border-gray-100 p-3">
                        <div className="text-[11px] text-gray-500 font-bold uppercase">Disponible</div>
                        <div className="text-2xl font-extrabold text-green-600">{stats.available}</div>
                    </div>
                </div>

                <div className="border-t border-gray-100 pt-3">
                    <div className="text-[11px] text-gray-500 font-bold uppercase mb-2">Par classe</div>

                    <div className="space-y-2">
                        {classOrder.map(cls => {
                            const c = stats.byClass[cls];
                            const badgeBg = CLASS_COLORS[cls] ? CLASS_COLORS[cls].split(' ')[0] : 'bg-slate-200';

                            return (
                                <div key={cls} className="rounded-lg border border-gray-100 p-3">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-2">
                                            <span className={`w-3 h-3 rounded-sm ${badgeBg} border border-black/10`}></span>
                                            <span className="font-bold text-gray-700 text-sm">{cls}</span>
                                        </div>
                                        <div className="text-xs font-bold text-purple-700">{c.total} pax</div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-2 mt-2">
                                        <div className="rounded-md bg-gray-50 p-2">
                                            <div className="text-[10px] uppercase font-bold text-gray-500">Occup√©</div>
                                            <div className="text-lg font-extrabold text-red-600">{c.occupied}</div>
                                        </div>
                                        <div className="rounded-md bg-gray-50 p-2">
                                            <div className="text-[10px] uppercase font-bold text-gray-500">Disponible</div>
                                            <div className="text-lg font-extrabold text-green-600">{c.available}</div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            </div>
        );
    };
    // --- FIN Compteur de passagers (AJOUT√â) ---

    // --- Data Generation Logic ---

    // UPPER DECK
    const generateUpperDeck = () => {
        let cabins = [];
        
        // Cabin 1: Otono One (Rows 1-2)
        let c1 = [];
        [1, 2].forEach(row => {
            c1.push(createSeat(`${row}A`, CLASS_OTONO_ONE, row, 'A', false, ['Le plus grand √©cran IFE', 'Acc√®s √† la douche', 'Suite priv√©e', 'Cuisine raffin√©e']));
            c1.push(createSeat(`${row}K`, CLASS_OTONO_ONE, row, 'K', false, ['Le plus grand √©cran IFE', 'Acc√®s √† la douche', 'Suite priv√©e', 'Cuisine raffin√©e']));
        });
        cabins.push({ name: "Cabin 1", seats: c1 });

        let c2 = [];
        // Cabin 2: First Class (Rows 5-9)
        [5, 6, 7, 8, 9].forEach(row => {
        let rowSeats = [];
        
        // Row 9 does NOT have A or K
        if (row !== 9) {
            rowSeats.push(createSeat(
                `${row}A`,
                CLASS_FIRST,
                row,
                'A',
                true,
                ['√âcran IFE plus grand', 'Acc√®s √† la douche', 'Suite priv√©e', 'Si√®ge fen√™tres']
            ));
            rowSeats.push(createSeat(
                `${row}K`,
                CLASS_FIRST,
                row,
                'K',
                true,
                ['√âcran IFE plus grand', 'Acc√®s √† la douche', 'Suite priv√©e', 'Si√®ge fen√™tres']
            ));
        }

        // Row 7 has NO D/G
        if (row !== 7) {
            rowSeats.push(createSeat(
                `${row}D`,
                CLASS_FIRST,
                row,
                'D',
                true,
                ['√âcran IFE plus grand', 'Acc√®s √† la douche', 'Suite priv√©e', 'Paire centrale']
            ));
            rowSeats.push(createSeat(
                `${row}G`,
                CLASS_FIRST,
                row,
                'G',
                true,
                ['√âcran IFE plus grand', 'Acc√®s √† la douche', 'Suite priv√©e', 'Paire centrale']
            ));
        }

        rowSeats.forEach(seat => c2.push(seat));});
        cabins.push({ name: "Cabin 2", seats: c2 });

        // Cabin 3: Premium Economy (Rows 44-50)
        let c3 = [];
        for (let row = 44; row <= 52; row++) {
            const isExtraLegroom = row === 44;
            const feats = isExtraLegroom ? ["Plus d'espace pour les jambes"] : [];
            
            ['A','C','D','F','G','H','K'].forEach(col => {
                let isAisle = ['C','D','G','H'].includes(col);
                let seatFeats = [...feats]; 
                if (col === 'A' || col === 'K') seatFeats.push('Casier de rangement');
                let seat = createSeat(`${row}${col}`, CLASS_PREM_ECO, row, col, isAisle, seatFeats);
                c3.push(seat);
            });
        }
        cabins.push({ name: "Cabin 3", seats: c3 });

        // Cabin 4: Economy Upper (Rows 80-93)
        let c4 = [];
        for (let row = 80; row <= 93; row++) {
            const cols = ['A','C','D','E','F','G','H','K'];
            cols.forEach(col => {
                if (row === 83 && ['A','C','H','K'].includes(col)) return;

                let feats = [];
                // *** NEW: Row 80 Plus d'espace pour les jambes ***
                if (row === 80) feats.push("Plus d'espace pour les jambes");
                // Previous Plus d'espace pour les jambes row 
                if (row === 84 && ['A','C','H','K'].includes(col)) feats.push("Plus d'espace pour les jambes");
                if (col === 'A' || col === 'K') feats.push('Casier de rangement');

                let isAisle = ['C','D','G','H'].includes(col);
                c4.push(createSeat(`${row}${col}`, CLASS_ECONOMY, row, col, isAisle, feats));
            });
        }
        cabins.push({ name: "Cabin 4", seats: c4 });

        return cabins;
    };

    // LOWER DECK
    const generateLowerDeck = () => {
        let cabins = [];

        // Cabin 1: Business (11, 12, 15-19)
        let c1 = [];
        const c1Rows = [11, 12, 15, 16, 17, 18, 19];
        c1Rows.forEach(row => {
            c1.push(createSeat(`${row}A`, CLASS_BUSINESS, row, 'A', false, ['Si√®ges-lits', "Acc√®s direct √† l‚Äôall√©e", 'Service de repas gastronomiques']));
            c1.push(createSeat(`${row}K`, CLASS_BUSINESS, row, 'K', false, ['Si√®ges-lits', "Acc√®s direct √† l‚Äôall√©e", 'Service de repas gastronomiques']));
            
            if (row !== 11 && row !== 12) {
                 c1.push(createSeat(`${row}D`, CLASS_BUSINESS, row, 'D', true, ['Si√®ges-lits', "Acc√®s direct √† l‚Äôall√©e", 'Service de repas gastronomiques', 'Centre']));
                 c1.push(createSeat(`${row}G`, CLASS_BUSINESS, row, 'G', true, ['Si√®ges-lits', "Acc√®s direct √† l‚Äôall√©e", 'Service de repas gastronomiques', 'Centre']));
            }
        });
        cabins.push({ name: "Cabin 1", seats: c1 });

        // Cabin 2: Business (25-37)
        let c2 = [];
        for (let row = 25; row <= 37; row++) {
            c2.push(createSeat(`${row}A`, CLASS_BUSINESS, row, 'A', false, ['Si√®ges-lits', "Acc√®s direct √† l‚Äôall√©e", 'Service de repas gastronomiques']));
            c2.push(createSeat(`${row}K`, CLASS_BUSINESS, row, 'K', false, ['Si√®ges-lits', "Acc√®s direct √† l‚Äôall√©e", 'Service de repas gastronomiques']));
            if (row !== 25 && row !== 37) {
                c2.push(createSeat(`${row}D`, CLASS_BUSINESS, row, 'D', true, ['Si√®ges-lits', "Acc√®s direct √† l‚Äôall√©e", 'Service de repas gastronomiques', 'Centre']));
                c2.push(createSeat(`${row}G`, CLASS_BUSINESS, row, 'G', true, ['Si√®ges-lits', "Acc√®s direct √† l‚Äôall√©e", 'Service de repas gastronomiques', 'Centre']));
            }
        }
        cabins.push({ name: "Cabin 2", seats: c2 });

        // Cabin 3: Economy (56-67)
        let c3 = [];
        for (let row = 56; row <= 67; row++) {
            const cols = ['A','B','C', 'D','E','F','G', 'H','J','K'];
            cols.forEach(col => {
                // Row 67 Exception: No A, No K
                if (row === 67 && (col === 'A' || col === 'K')) return;

                // Features
                let feats = [];
                if (row === 56) feats.push("Plus d'espace pour les jambes");
                // Removed generic 'Preferred Seat' here, relies on getSeatQuality now
                
                let isAisle = ['C','D','G','H'].includes(col);
                c3.push(createSeat(`${row}${col}`, CLASS_ECONOMY, row, col, isAisle, feats));
            });
        }
        cabins.push({ name: "Cabin 3", seats: c3 });

        // Cabin 4: Economy (68-77)
        let c4 = [];
        for (let row = 68; row <= 77; row++) {
            ['A','B','C', 'D','E','F','G', 'H','J','K'].forEach(col => {
                if (row === 77 && ['D','E','F','G'].includes(col)) return;

                let feats = [];
                if (row === 68) feats.push("Plus d'espace pour les jambes");
                // Removed generic 'Preferred Seat' here, relies on getSeatQuality now
                
                let isAisle = ['C','D','G','H'].includes(col);
                c4.push(createSeat(`${row}${col}`, CLASS_ECONOMY, row, col, isAisle, feats));
            });
        }
        cabins.push({ name: "Cabin 4", seats: c4 });

        return cabins;
    };

    // --- Components ---

    const Seat = ({ seat, onSelect, isSelected }) => {
        const baseClasses = "w-7 h-8 m-[1px] md:m-0.5 text-[9px] flex items-center justify-center font-bold cursor-pointer transition-all duration-200 seat-style";
        let typeClasses = CLASS_COLORS[seat.type];
        
        let borderClass = "";
        if (seat.features.includes("Plus d'espace pour les jambes")) borderClass = "border-b-4 border-yellow-400";
        
        if (seat.isOccupied) {
            typeClasses = "seat-occupied-style"; 
            borderClass = "";
        } else if (isSelected) {
            typeClasses = "seat-selected-style"; 
        } else {
            typeClasses += " hover:scale-110 hover:z-10";
        }

        // Otono One
        if (seat.type === CLASS_OTONO_ONE) {
            return (
                <div
                    onClick={() => !seat.isOccupied && onSelect(seat)}
                    className={`w-16 h-16 m-2 rounded-lg text-xs flex flex-col items-center justify-center font-serif border-2 ${typeClasses.includes('seat-occupied-style') ? 'seat-occupied-style' : typeClasses} ${seat.isOccupied ? '' : 'hover:shadow-xl'} ${isSelected ? 'seat-selected-style' : ''}`}
                >
                    <span>{seat.id}</span>
                    <span className="text-[8px] opacity-75">SUITE</span>
                </div>
            );
        }
        
        // First Class
        if (seat.type === CLASS_FIRST) {
            return (
               <div
                    onClick={() => !seat.isOccupied && onSelect(seat)}
                    className={`w-10 h-10 m-1 rounded-md text-[10px] flex items-center justify-center border ${typeClasses.includes('seat-occupied-style') ? 'seat-occupied-style' : typeClasses} ${isSelected ? 'seat-selected-style' : ''}`}
               >
                 {seat.id}
               </div>
            );
        }

        return (
            <div
                onClick={() => !seat.isOccupied && onSelect(seat)}
                className={`${baseClasses} ${typeClasses} ${borderClass}`}
                title={seat.features.join(', ')}
            >
                {seat.id.replace(/[0-9]/g, '')}
            </div>
        );
    };

    const ShowerSuite = () => (
        <div className="flex flex-col items-center justify-center bg-blue-100 border border-blue-300 text-blue-800 p-2 rounded-lg w-24 h-24 m-2 text-xs text-center shadow-inner">
            <Bath size={24} className="mb-1" />
            <span className="font-bold">Douche Spa</span>
            <span className="text-[9px]">Otono One et La Premi√®re</span>
        </div>
    );

    const Stairs = ({ label, isLower = false }) => (
        <div className={`w-full ${isLower ? 'h-16 w-32 mx-auto rounded-lg border-2' : 'h-10 border-y-2'} bg-gray-200 border-gray-300 flex flex-col items-center justify-center my-2 opacity-60 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]`}>
            {isLower && <ArrowUp size={16} className="text-gray-500 mb-1" />}
            <span className="text-gray-500 text-[10px] font-bold uppercase tracking-widest text-center leading-tight">{label}</span>
        </div>
    );

    const Lounge = () => (
        <div className="w-full bg-purple-900 text-white p-6 rounded-b-3xl flex flex-col items-center justify-center mt-4 border-t-4 border-red-600 shadow-2xl relative overflow-hidden">
            <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
            <div className="z-10 flex items-center space-x-4">
                <Coffee size={32} />
                <div className="text-center">
                    <h3 className="text-xl font-bold font-serif">Le salon Otono</h3>
                    <p className="text-xs text-purple-200">Ouvert √† toutes les classes</p>
                    <p className="text-xs text-purple-200">"Grandpa Belt's Favorite Spot"</p>
                </div>
            </div>
        </div>
    );

    const DeckMap = ({ deck, cabins, onSelect, selectedSeat }) => {
        return (
            <div className="flex flex-col items-center bg-white rounded-3xl shadow-2xl border-4 border-gray-300 p-2 md:p-4 w-full max-w-2xl mx-auto relative overflow-hidden min-h-[800px] fuselage-style">
                {/* Fuselage Top */}
                
                <div className="mt-8 mb-4 w-full flex justify-center z-10">
                    {deck === DECK_UPPER ? (
                        <div className="flex justify-between w-full px-4 md:px-8">
                            <ShowerSuite />
                            <div className="flex flex-col justify-end pb-4 w-full mx-2">
                                <Stairs label="Escalier d'honneur" />
                            </div>
                            <ShowerSuite />
                        </div>
                    ) : (
                        <div className="w-full text-center py-4 text-gray-400 font-bold">COCKPIT CI-DESSOUS</div>
                    )}
                </div>

                <div className="w-full flex flex-col items-center space-y-2">
                    
                    {cabins.map((cabin, cIdx) => {
                        const rows = {};
                        cabin.seats.forEach(s => {
                            if (!rows[s.row]) rows[s.row] = [];
                            rows[s.row].push(s);
                        });
                        const rowNumbers = Object.keys(rows).sort((a,b) => a-b);

                        return (
                            <div key={cabin.name} className="w-full flex flex-col items-center">
                                {/* Cabin Separator */}
                                {cIdx > 0 && (
                                    <div className="w-full flex items-center justify-center my-4">
                                        <div className="h-12 w-full bg-gray-100 border-y border-gray-200 flex items-center justify-center">
                                            <span className="text-[10px] text-gray-400 tracking-widest uppercase">Cuisine / Sortie</span>
                                        </div>
                                    </div>
                                )}

                                {rowNumbers.map(rowNum => {
                                    const rowSeats = rows[rowNum].sort((a,b) => a.col.localeCompare(b.col));
                                    const rInt = parseInt(rowNum);
                                    
                                    // Check if this row is part of the Grand Staircase block (Lower Deck 11 & 12)
                                    const isGrandStairRow = deck === DECK_LOWER && (rInt === 11 || rInt === 12);

                                    return (
                                        <div key={rowNum} className="flex items-center justify-center w-full my-0.5">
                                            <span className="w-6 text-[10px] text-gray-400 text-right mr-1 font-mono">{rowNum}</span>
                                            <div className="flex relative">
                                                
                                                {/* Grand Staircase Visual Block on Lower Deck */}
                                                {isGrandStairRow && (
                                                    <div className="absolute left-1/2 top-0 -translate-x-1/2 w-24 h-full bg-gray-200 border-x border-gray-300 flex items-center justify-center z-0">
                                                        {rInt === 11 && <span className="text-[8px] text-gray-400 font-bold uppercase">Escalier</span>}
                                                        {rInt === 12 && <span className="text-[8px] text-gray-400 font-bold uppercase">d'honneur</span>}
                                                    </div>
                                                )}

                                                {rowSeats.map((seat, i) => {
                                                    // Aisle Spacing Logic
                                                    let spacer = null;
                                                    
                                                    // Lower Deck Economy (3-4-3)
                                                    if (deck === DECK_LOWER && seat.type === CLASS_ECONOMY) {
                                                        if (seat.col === 'D' && i > 0) spacer = <div className="w-3 md:w-6"></div>;
                                                        if (seat.col === 'H') spacer = <div className="w-3 md:w-6"></div>;
                                                    }
                                                    // Upper Deck Economy / Premium Economy (2-4-2)
                                                    else if (deck === DECK_UPPER && (seat.type === CLASS_ECONOMY || seat.type === CLASS_PREM_ECO)) {
                                                        if (seat.col === 'D') spacer = <div className="w-3 md:w-6"></div>;
                                                        if (seat.col === 'H') spacer = <div className="w-3 md:w-6"></div>;
                                                    }
                                                    // Business (1-2-1 / 1-1-1 on stairs)
                                                    else if (seat.type === CLASS_BUSINESS) {
                                                        if (isGrandStairRow) {
                                                            if (seat.col === 'K') spacer = <div className="w-24 md:w-32"></div>;
                                                        } else {
                                                            if (seat.col === 'D') spacer = <div className="w-4 md:w-8"></div>;
                                                            if (seat.col === 'K') spacer = <div className="w-4 md:w-8"></div>;
                                                        }
                                                    }
                                                    // First (1-2-1) configuration
                                                    else if (seat.type === CLASS_FIRST) {
                                                        if (seat.col === 'D') spacer = <div className="w-4 md:w-8"></div>;
                                                        if (seat.col === 'K') spacer = <div className="w-4 md:w-8"></div>;
                                                    }
                                                    
                                                    return (
                                                        <React.Fragment key={seat.id}>
                                                            {spacer}
                                                            <Seat seat={seat} onSelect={onSelect} isSelected={selectedSeat?.id === seat.id} />
                                                        </React.Fragment>
                                                    );
                                                })}
                                            </div>
                                            <span className="w-6 text-[10px] text-gray-400 text-left ml-1 font-mono">{rowNum}</span>
                                        </div>
                                    );
                                })}
                            </div>
                        );
                    })}
                </div>

                <div className="mt-8 w-full z-10">
                    {deck === DECK_UPPER ? (
                        <>
                            <Stairs label="Escalier en colima√ßon" />
                            <Lounge />
                        </>
                    ) : (
                        <>
                            <div className="w-full py-4 text-center text-gray-400">
                                <div className="w-full h-8 bg-gray-100 my-2 flex items-center justify-center text-[10px] text-gray-400">CUISINE ARRI√àRE</div>
                            </div>
                            {/* Spiral Staircase Lower Deck */}
                            <Stairs label="Escalier en colima√ßon (au salon)" isLower={true} />
                        </>
                    )}
                </div>
                {/* Fuselage Bottom */}
            </div>
        );
    };

    function App() {
        const [currentDeck, setCurrentDeck] = useState(DECK_UPPER);
        const [selectedSeat, setSelectedSeat] = useState(null);
        
        const upperCabins = useMemo(() => generateUpperDeck(), []);
        const lowerCabins = useMemo(() => generateLowerDeck(), []);

        const allSeats = useMemo(() => {
            return [...flattenCabins(upperCabins), ...flattenCabins(lowerCabins)];
        }, [upperCabins, lowerCabins]);

        const seatStats = useMemo(() => buildSeatStats(allSeats), [allSeats]);

        const quality = selectedSeat ? getSeatQuality(selectedSeat) : null;

        return (
            <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-20">
                
                <header className="bg-gradient-to-r from-purple-900 to-red-700 text-white p-4 shadow-lg sticky top-0 z-50">
                    <div className="max-w-4xl mx-auto flex justify-between items-center">
                        <div className="flex items-center space-x-2">
                            <Plane className="transform -rotate-45" size={28} />
                            <div>
                                <h1 className="text-xl font-bold tracking-wider">OTONO AIRWAYS</h1>
                                <a href="index.html">Retourner a m√®nu</a>
                                <p className="text-xs text-purple-200">Airbus A380-800</p>
                            </div>
                        </div>
                        <div className="text-right hidden sm:block">
                            {/* OTONO THEME WIFI BADGE */}
                            <div className="flex items-center justify-end">
                                <Wifi size={16} className="text-yellow-400 mr-1" />
                                <span className="text-sm font-bold text-yellow-300">Messagerie WiFi gratuit</span>
                                <span className="text-xs ml-1 text-purple-200">(WiFi haut d√©bit: ‚Ç¨9 SEULEMENT )</span>
                            </div>
                            
                            <p className="text-sm font-bold italic">"PLUS DE PEUR de la classe √©conomique!"</p>
                            <a href="https://otonoteam2.github.io/Otono%20Airways%20A380.html">English üá¨üáß</a>
                            <p className="text-xs opacity-75">Paris ‚Ä¢ Londres ‚Ä¢ Le Monde</p>
                        </div>
                    </div>
                </header>

                <main className="max-w-6xl mx-auto mt-6 px-2 md:px-6 flex flex-col md:flex-row gap-8">
                        
                    <div className="w-full md:w-1/3 space-y-6">
                            
                        <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                            <h2 className="text-sm font-bold text-gray-500 uppercase mb-3">S√©lectionnez le pont</h2>
                            <div className="flex space-x-2 bg-gray-100 p-1 rounded-lg">
                                <button
                                    onClick={() => { setCurrentDeck(DECK_UPPER); setSelectedSeat(null); }}
                                    className={`flex-1 py-3 rounded-md text-sm font-bold transition-all ${currentDeck === DECK_UPPER ? 'bg-white text-purple-700 shadow-sm' : 'text-gray-500 hover:bg-gray-200'}`}
                                >
                                    Pont sup√©rieur
                                    <span className="block text-[9px] font-normal opacity-75">Suites, La Pr√®miere, Salon</span>
                                </button>
                                <button
                                    onClick={() => { setCurrentDeck(DECK_LOWER); setSelectedSeat(null); }}
                                    className={`flex-1 py-3 rounded-md text-sm font-bold transition-all ${currentDeck === DECK_LOWER ? 'bg-white text-indigo-700 shadow-sm' : 'text-gray-500 hover:bg-gray-200'}`}
                                >
                                    Pont inf√©rieur
                                    <span className="block text-[9px] font-normal opacity-75">Affaires, Economique</span>
                                </button>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-xl shadow-md border border-gray-100 min-h-[200px]">
                            {selectedSeat ? (
                                <div className="animate-fade-in">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <span className={`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wide text-white ${CLASS_COLORS[selectedSeat.type].split(' ')[0]}`}>
                                                {selectedSeat.type}
                                            </span>
                                            <h2 className="text-3xl font-bold text-gray-800 mt-2">{selectedSeat.id}</h2>
                                        </div>
                                        <div className="text-right">
                                            <span className="block text-2xl font-bold text-green-600">{selectedSeat.price}</span>
                                            <span className="text-xs text-gray-400">Sens unique</span>
                                        </div>
                                    </div>
                                    
                                    {/* --- NEW: Good/Bad Seat Badge --- */}
                                    {quality && (
                                        <div className={`p-2 rounded-lg mb-4 text-sm font-bold flex items-center shadow-inner ${quality.type === 'GOOD' ? 'good-seat-badge' : 'bad-seat-badge'}`}>
                                            <quality.icon size={18} className="mr-2" />
                                            <div className="flex flex-col">
                                                <span>{quality.label}</span>
                                                <span className="text-[10px] font-normal opacity-80 italic">{quality.reason}</span>
                                            </div>
                                        </div>
                                    )}
                                    {/* --- END NEW --- */}

                                    <div className="space-y-3">
                                        <div className="flex items-center text-sm text-gray-600">
                                            <User size={16} className="mr-2" />
                                            <span>{selectedSeat.isAisle ? "Aisle Access" : "Fen√™tre / Int√©rieur"}</span>
                                        </div>
                                        {selectedSeat.features && selectedSeat.features.map((feat, i) => (
                                            <div key={i} className="flex items-center text-sm text-gray-600">
                                                {feat.includes('WiFi') ? <Wifi size={16} className="mr-2 text-blue-500" /> : <Star size={16} className="mr-2 text-yellow-500" />}
                                                <span>{feat}</span>
                                            </div>
                                        ))}
                                        {selectedSeat.type === CLASS_ECONOMY && (
                                            <div className="flex items-center text-sm text-purple-600 font-medium">
                                                <span>34" d'espace pour les jambes garanti</span>
                                            </div>
                                        )}
                                    </div>

                                    <button
                                            className="w-full mt-6 bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 transition-colors shadow-md hover:shadow-lg flex items-center justify-center"
                                            onClick={() => {
                                                if (selectedSeat) {
                                                    // BOOKING LINK MUST REMAIN
                                                    window.location.href = 'https://otonoteam2.github.io/Otono%20Airways%20A380%20Destinations.html';
                                                } else {
                                                    alert("Veuillez d'abord chosir un si√®ge");
                                                }
                                            }}
                                        >
                                            R√©server le si√®ge {selectedSeat ? selectedSeat.id : ''}
                                        </button>
                                </div>
                            ) : (
                                <div className="h-full flex flex-col items-center justify-center text-gray-400 text-center py-8">
                                    <p>S√©lectionnez un si√®ge pour voir les d√©tails</p>
                                </div>
                            )}
                        </div>

                        <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                            <h3 className="text-xs font-bold text-gray-400 uppercase mb-3">Cl√©</h3>
                            <div className="space-y-2">
                                {Object.keys(CLASS_COLORS).map(cls => (
                                    <div key={cls} className="flex items-center">
                                        <div className={`w-4 h-4 rounded-sm mr-3 ${CLASS_COLORS[cls].split(' ')[0]} border border-black/10`}></div>
                                        <span className="text-sm font-medium text-gray-600">{cls}</span>
                                    </div>
                                ))}
                                <div className="flex items-center mt-4 pt-4 border-t border-gray-100">
                                    <div className="w-4 h-4 rounded-sm mr-3 bg-gray-300"></div>
                                    <span className="text-sm text-gray-400">Occup√©</span>
                                </div>
                                <div className="flex items-center pt-2">
                                    <div className="w-4 h-4 rounded-sm mr-3 bg-red-500 border-b-4 border-yellow-400"></div>
                                    <span className="text-sm text-gray-600">Plus d'espace pour les jambes</span>
                                </div>
                                <div className="flex items-center pt-2">
                                    <div className="w-4 h-4 rounded-sm mr-3 good-seat-badge"></div>
                                    <span className="text-sm text-gray-600">Bon Si√®ge </span>
                                </div>
                                <div className="flex items-center pt-2">
                                    <div className="w-4 h-4 rounded-sm mr-3 bad-seat-badge"></div>
                                    <span className="text-sm text-gray-600">Mauvais Si√®ge </span>
                                </div>
                            </div>
                        </div>

                        <SeatCounterPanel stats={seatStats} />

                    </div>

                    {/* MAP COLUMN */}
                    <div className="w-full md:w-2/3">
                       <DeckMap
                            deck={currentDeck}
                            cabins={currentDeck === DECK_UPPER ? upperCabins : lowerCabins}
                            onSelect={setSelectedSeat}
                            selectedSeat={selectedSeat}
                       />
                    </div>
                </main>

            </div>
        );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
</script>

</body>
</html>
